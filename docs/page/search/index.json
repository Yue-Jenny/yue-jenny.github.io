[{"content":"Prerequisites é–‹å§‹å‰ï¼Œéœ€è¦å…ˆç¢ºä¿æœ‰ä»¥ä¸‹çš„å…ˆå‚™çŸ¥è­˜\nkubernetes Argo CD ä»‹ç´¹ ä»¥ GitOps ç‚ºå®—æ—¨çš„ kubernetes æŒçºŒéƒ¨å±¬ (continuous delivery) å·¥å…· é—œæ–¼ GitOps å¯ä»¥åƒè€ƒæ–‡ç«  GitOps Getting Started with Argo CD on Docker Desktop è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥é–‹å§‹å§! ğŸ’ª\nå»ºç«‹ namespace kubectl create namespace argocd å®‰è£ Argo CD çš„ kubernetes resources éœ€è¦å®‰è£çš„ resources éƒ½å¯«åœ¨ install.yaml å…§ï¼Œåˆ©ç”¨ kubectl apply æŒ‡ä»¤é€²è¡Œå®‰è£\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml ç¢ºèª Argo CD çš„ pod çš„é‹è¡Œç‹€æ…‹ç‚º running -n è¡¨ç¤ºæŒ‡å®š namespace ç‚º argocdï¼Œæ²’è¨­å®šå°±æ˜¯ default namespace\nkubectl get pod -n argocd pod é‹è¡Œç‹€æ…‹\nå–å¾— Argo CD åˆå§‹ admin çš„å¯†ç¢¼ ç™»å…¥ dashboard ä½¿ç”¨\nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d; echo å°‡ service argocd-server port forward åˆ°æœ¬åœ° å°‡ service argocd-server çš„ port 443 å°è‡³æœ¬åœ° port 8000\nkubectl port-forward svc/argocd-server -n argocd 8000:443 port forward æˆåŠŸ\nç™»å…¥ Argo CD dashboard ç¶²å€è¼¸å…¥ https://localhost:8000\næˆåŠŸç™»å…¥ Argo CD dashboard\né‡å° public git repository å»ºç«‹ä¸€çµ„ application å…ˆ fork ç¯„ä¾‹ repository - argocd-example-apps\nä¾ç…§å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿé€²è¡Œæ–°å¢ application\nStep 1 Step 2ï¼Œå¡«å®Œè³‡è¨Šï¼ŒæŒ‰ä¸‹ CREATEï¼Œèƒ½åœ¨ dashboard çœ‹åˆ° application\napp name: guestbook project: default sync policy: Manual Repository URL Revision: HEAD Path: guestbook Destination/Cluster: https://kubernetes.default.svc Namespace: default é‡å° private git repository å»ºç«‹ä¸€çµ„ application é¸ä¸€çµ„ private repo\nåˆ° Settings/Repositories\nä»¥ ssh-key æ–¹å¼èªè­‰ï¼Œä¹Ÿèƒ½é¸æ“‡ä»¥ Https çš„æ–¹å¼é©—è­‰\nå¯åƒè€ƒArgo CD Private Repositories Credential è¨­å®š è¨­å®šå®Œæˆæœƒé¡¯ç¤º Successful å»ºç«‹ application\nStep 1 Step 2\nä¾ç…§å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿå¡«å…¥è³‡æ–™ æˆåŠŸå»ºç«‹ä¸€çµ„ private application ğŸš€\nè§£é™¤å®‰è£ application åŸ·è¡Œ DELETE æŒ‰éˆ•\nè§£é™¤å®‰è£ Argo CD âš ï¸ è§£é™¤å®‰è£ Argo CD å‰ä¸€å®šè¦å…ˆè§£é™¤å®‰è£ application\nkubectl -n argocd delete -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml åƒè€ƒè³‡æ–™ Argo CD Argo CD getting started åƒè€ƒæ–‡ä»¶ kubernetes kubectl port-forward Argo CD Private Repositories Credential è¨­å®š ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-04T04:39:13.628Z","permalink":"https://yue-jenny.github.io/post/2023/01/argocd-on-docker-desktop/","title":"ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD"},{"content":"OpenID Connect (OIDC) ä»‹ç´¹ å‰è¨€ OIDC å…¨åç‚º OpenID Connectï¼Œæ˜¯ä¸€ç¨®å¯ä»¥ access AWS resourcesï¼Œä½†ä¸éœ€è¦å­˜å– AWS credentials ç•¶ä½œ long-lived GitHub secrets çš„é©—è­‰æ–¹å¼ã€‚ å®˜æ–¹å»ºè­°çš„é©—è­‰æ–¹å¼ã€‚ OIDC å„ªé» - å¾ˆå¥½çš„å®‰å…¨å¯¦è¸ (good security practices) No cloud secrets ä¸éœ€è¦ä»¥ cloud credentials ç•¶ä½œ long-lived GitHub secrets åœ¨ cloud provider è¨­å®šå¥½ OIDC trustï¼Œgithub workflows å°±å¯ä»¥åˆ©ç”¨ OIDC å¾ cloud provider å–å¾—ä¸€çµ„ short-lived access token Authentication and authorization management é€é cloud provider çš„ authentication (authN) èˆ‡ authorization (authZ) å·¥å…·èƒ½å¤ æ§åˆ¶å–å¾— cloud resources èƒ½æ›´å°ç²’åº¦åœ°æ§åˆ¶ workflows å¦‚ä½•ä½¿ç”¨ credentials Rotating credentials cloud provider æä¾›ä¸€çµ„ short-lived access token çµ¦ä¸€å€‹ jobï¼Œä½¿ç”¨å®Œç•¢å¾Œæœƒè‡ªå‹•éæœŸã€‚ OIDC çš„é‹ä½œæ–¹å¼èˆ‡ä¿¡ä»»æ©Ÿåˆ¶ é‹ä½œæ–¹å¼ ä¸»è¦æ˜¯å…©å€‹è§’è‰²çš„äº’å‹•ï¼Œåˆ†åˆ¥ç‚º Cloud Provider èˆ‡ Github OIDC Provider äº’å‹•éç¨‹ : In your cloud provider, create an OIDC trust between your cloud role and your GitHub workflow(s) that need access to the cloud. Every time your job runs, GitHub\u0026rsquo;s OIDC Provider auto-generates an OIDC token. This token contains multiple claims to establish a security-hardened and verifiable identity about the specific workflow that is trying to authenticate. You could include a step or action in your job to request this token from GitHub\u0026rsquo;s OIDC provider, and present it to the cloud provider. Once the cloud provider successfully validates the claims presented in the token, it then provides a short-lived cloud access token that is available only for the duration of the job. å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ å®‰å…¨ - OIDC trust ç•¶è¨­å®š cloud èƒ½ä¿¡ä»» GitHub\u0026rsquo;s OIDC provider å¾Œï¼Œå¿…é ˆåŠ ä¸Šä¸€äº›æƒ…å¢ƒå»éæ¿¾æ‰ requestsï¼Œé¿å…æ²’æœ‰å–å¾—ä¿¡ä»»çš„ repositories or workflows å¯ä»¥é€é access token æ“ä½œä½ çš„ cloud resourcesã€‚ Configuring OpenID Connect in Amazon Web Services å‰è¨€ ç›®çš„æ˜¯ Use OpenID Connect within your workflows to authenticate with Amazon Web Services. å®˜æ–¹æ–‡ä»¶ IAM Role 1. Create a iam role å»ºç«‹ä¸€çµ„ iam roleï¼Œç”¨æ–¼ä¸Šå‚³ docker image åˆ° private ECR å»ºç«‹ iam role çš„æ™‚å€™ï¼Œæœƒéœ€è¦å¡«å…¥ä»¥ä¸‹è³‡è¨Š : provider URL : https://token.actions.githubusercontent.com Audience : sts.amazonaws.com 2. Permissions policies iam role ç¶å®šçš„ permissions policies æ˜¯ AmazonEC2ContainerRegistryPowerUser æ­¤æ”¿ç­–å…è¨±å§”è¨—äººè®€å–å’Œå¯«å…¥å„²å­˜åº«ï¼Œä»¥åŠè®€å–ç”Ÿå‘½é€±æœŸæ”¿ç­–ã€‚å§”è¨—äººä¸æœƒè¢«æˆäºˆåˆªé™¤å„²å­˜åº«æˆ–è®Šæ›´å¥—ç”¨è‡³å…¶ç”Ÿå‘½é€±æœŸæ”¿ç­–çš„è¨±å¯ã€‚ å¯ä¾æ“šéœ€æ±‚è¨­å®šä¸åŒçš„ permissons policiesï¼Œå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ 3. Add the GitHub OIDC provider to IAM Configure the role and trust in IAM.\nåˆ° iam role é é¢é»é¸ç·¨è¼¯ Trust relationships\nåƒè€ƒä»¥ä¸‹çš„æ–¹å¼å°‡ sub æ¬„ä½åŠ å…¥åˆ° Condition ä¸­\næ–¹å¼ä¸€ï¼Œä½¿ç”¨ StringLike\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Federated\u0026#34;: \u0026#34;arn:aws:iam::123456123456:oidc-provider/token.actions.githubusercontent.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRoleWithWebIdentity\u0026#34;, \u0026#34;Condition\u0026#34;: { \u0026#34;StringLike\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:sub\u0026#34;: \u0026#34;repo:octo-org/octo-repo:*\u0026#34; }, \u0026#34;StringEquals\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:aud\u0026#34;: \u0026#34;sts.amazonaws.com\u0026#34; } } } ] } æ–¹å¼äºŒï¼Œä½¿ç”¨ StringEquals\n\u0026#34;Condition\u0026#34;: { \u0026#34;StringEquals\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:aud\u0026#34;: \u0026#34;sts.amazonaws.com\u0026#34;, \u0026#34;token.actions.githubusercontent.com:sub\u0026#34;: \u0026#34;repo:octo-org/octo-repo:ref:refs/heads/octo-branch\u0026#34; } } å®˜æ–¹æ–‡ä»¶\nUpdating your GitHub Actions workflow ä¸Šè¿°æ˜¯ AWS ç›¸é—œè¨­å®šï¼Œæ­¤æ­¥é©Ÿæ˜¯èª¿æ•´ github workflowï¼Œåšå…©ä»¶äº‹æƒ… :\nAdding permissions settingsï¼Œæœ‰å…©ç¨®æ¬Šé™é¸æ“‡ï¼Œå¯ä¾ç…§è‡ªèº«æƒ…å¢ƒå»é¸æ“‡ã€‚\nfetch an OIDC token for a workflow, then the permission can be set at the workflow level.\npermissions: id-token: write # This is required for requesting the JWT contents: read # This is required for actions/checkout only need to fetch an OIDC token for a single job\npermissions: id-token: write # This is required for requesting the JWT Use the aws-actions/configure-aws-credentials action\næ­¤ action æœƒæ¥æ”¶ä¾†è‡ª GitHub OIDC provider çš„ JWTï¼Œä¸¦ä¸”å‘ AWS è«‹æ±‚ä¸€çµ„ access token - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: role-to-assume: arn:aws:iam::1234567890:role/example-role role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession aws-region: ${{env.AWS_DEFAULT_REGION}} åƒè€ƒè³‡æ–™ configuring-openid-connect-in-amazon-web-services about-security-hardening-with-openid-connect æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-29T14:32:24+08:00","permalink":"https://yue-jenny.github.io/post/how-to-use-oidc-to-auth-aws-services/","title":"åœ¨ Github workflow ä¸­ä½¿ç”¨ OpenID Connect (OIDC) å»èªè­‰ AWS æœå‹™"},{"content":"Github Workflow ä»‹ç´¹ å‰è¨€ ç‚ºäº†åˆ©ç”¨ Github Workflow å®Œæˆ CI/CDï¼Œåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†å¯«ï¼Œåˆ†åˆ¥æ˜¯\nGithub Workflow çš„åŸºæœ¬è¨­å®š Github Workflow ä¸­é€²è¡Œ CI ç™»å…¥ç™»å‡º AWS ECR èˆ‡ github container registry build \u0026amp; upload image æ›´æ–° helm value ä¸­çš„ image tagï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ åŸºæœ¬è¨­å®š action ç‚º push çš„æ™‚å€™ï¼Œæ‰€æœ‰ branch éƒ½æœƒé€²è¡Œ github workflow action ç‚º pull_request çš„æ™‚å€™ï¼Œåªæœ‰ main branch æœƒé€²è¡Œ github workflow types paths on: push: branches: [\u0026#34;*\u0026#34;] pull_request: branches: [\u0026#34;main\u0026#34;] types: - opened paths: - \u0026#34;**.js\u0026#34; env è¨­å®š è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š env: AWS_DEFAULT_REGION: ap-southeast-1 GIT_USER_NAME: jennyc permissions è¨­å®š è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š permissions: id-token: write # This is required for requesting the JWT contents: read # This is required for actions/checkout è‡ªå‹•åŒ–æ¸¬è©¦ CI checkout repository ä½¿ç”¨ actions/checkout@v3 é€²è¡Œ\n- name: Checkout repository uses: actions/checkout@v3 åŸ·è¡Œ npm install - name: Install dependencies run: npm install åŸ·è¡Œ npm test - name: Run tests run: npm run test Build multi-platform images ä¸¦ä¸Šå‚³è‡³ AWS ECR å‰è¨€ é€™éƒ¨åˆ†éœ€è¦å…ˆè¨­å®š AWS Credential æ‰èƒ½ä½¿ç”¨ AWS ECRï¼Œ\næ¥è‘— build multi-platform image ä¸¦ä¸”ä¸Šå‚³è‡³ AWS ECRã€‚\n1. è¨­å®š AWS Credential è¨­å®š AWS Credential\nä½¿ç”¨ GitHub\u0026rsquo;s OIDC provider æ–¹å¼å–å¾— short-lived credentials\nOpenID Connect (OIDC) è¨­å®šæ–¹å¼å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç«  workflow è¦æ€éº¼å¯«?\nenv.AWS_DEFAULT_REGION éœ€è¦ç‰¹åˆ¥è¨­å®šï¼Œèˆ‡ AWS ECR ç›¸åŒçš„ region role-to-assume å¡«å…¥ AWS role role-session-name é è¨­æ˜¯ GitHubActionsï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´åç¨± - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: role-to-assume: arn:aws:iam::1234567890:role/example-role role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession aws-region: ${{env.AWS_DEFAULT_REGION}} 2. ç™»å…¥ AWS private ECR æœ‰å…©ç¨®æ–¹å¼ Using access key id and secret access key to login\n- name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} aws-region: ap-southeast-1 Using OpenID Connect (OIDC) to login\nå®˜æ–¹æ¨è–¦ä½¿ç”¨æ­¤æ–¹å¼ - name: Login to Amazon ECR id: login-ecr uses: aws-actions/amazon-ecr-login@v1 3. ç™»å…¥ AWS public ECR å¯åƒè€ƒå®˜æ–¹èªªæ˜ 4. ç™»å‡º AWS ECR - name: Logout of Amazon ECR if: always() run: docker logout ${{ steps.login-ecr.outputs.registry }} 5. è¨­å®š short sha ç‚º image tag è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tagï¼ŒåŸå› å¯ä»¥åƒè€ƒ: 7 digits are the Git default for a short SHA é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ Chapter 7 of the Pro Git book å°‡ output å‡ºå»çš„åƒæ•¸å‘½åç‚º sha_short - name: Set short sha outputs id: vars run: echo \u0026#34;sha_short=$(git rev-parse --short HEAD)\u0026#34; \u0026gt;\u0026gt; $GITHUB_OUTPUT 6. Build multi-platform images ä¸¦ä¸Šå‚³ images åˆ° AWS ECR å»ºç«‹å¤šå¹³å° docker images çš„å®˜æ–¹æ–‡ä»¶ IMAGE_TAG æœƒå¾æ­¥é©Ÿ 5 å–å¾— output çš„è®Šæ•¸ sha_short --platform å¯æ¥ä¸Šéœ€è¦çš„ platform åƒè€ƒï¼Œä¾‹å¦‚ linux/amd64, linux/arm64 - name: Build, tag, and push docker image to Amazon ECR env: REGISTRY: ${{ steps.login-ecr.outputs.registry }} REPOSITORY: pet-app IMAGE_TAG: ${{ steps.vars.outputs.sha_short }} run: | docker run --rm --privileged multiarch/qemu-user-static --reset -p yes ( å®˜æ–¹å»ºè­°: docker run --privileged --rm tonistiigi/binfmt --install all ) docker buildx create --name mybuilder --driver docker-container --bootstrap docker buildx use mybuilder docker buildx inspect docker buildx build --platform linux/amd64,linux/arm64 -t $REGISTRY/$REPOSITORY:$IMAGE_TAG --push . ç‚ºä»€éº¼éœ€è¦ docker run --rm --privileged multiarch/qemu-user-static --reset -p yes ?\nå› ç‚ºé‡åˆ° Error: while loading /usr/local/sbin/node: No such file or directory å•é¡Œ å…ˆä½¿ç”¨æ–¹å¼ä¸€ : é€£æ¥æ–¹å¼ï¼Œçµæœé‚„æ˜¯æœ‰ç›¸åŒå•é¡Œ ln -s /usr/bin/node /usr/local/sbin/node å¾Œä¾†ä½¿ç”¨æ–¹å¼äºŒ ä½¿ç”¨ docker buildx æŒ‡ä»¤å‰å…ˆåŸ·è¡Œä»¥ä¸‹å‘½ä»¤\ndocker run --rm --privileged multiarch/qemu-user-static --reset -p yes è©³ç´°åŸå› çš„ Stack Overflow åŸå§‹æ–‡ç« åœ¨é€™é‚Šï¼Œä»¥ä¸‹æ˜¯ç¯€éŒ„éƒ¨åˆ†\n` When you ask the Linux kernel to run some executable file, it needs to know, how to load this specific file, and whether this file is compatible with current machine, or not. By default, the ELF binary compiled for, say, arm64v8 is rejected by the kernel, running on amd64 hardware.\nHowever, the binfmt_misc feature of the kernel allows you to tell it, how to handle the executables it cannot usually handle on its own - this includes the cases when the kernel does not know the binary format or considers it incompatible with current machine.\n`\ngithub issue\nå®˜æ–¹å»ºè­°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£æ±º QEMU binaries å•é¡Œï¼Œå®˜æ–¹æ–‡ä»¶\ndocker run --privileged --rm tonistiigi/binfmt --install all æ›´æ–° helm value çš„ image tag å‰è¨€ æ‡‰ç”¨æ˜¯ä»¥ terraform æ–¹å¼éƒ¨å±¬ï¼Œä¸¦æ­é…ä½¿ç”¨ helm chartsã€‚è€Œ docker image çš„ tag æ˜¯å¯«åœ¨ helm values å…§ã€‚\nç›®æ¨™æ˜¯æ›´æ–° helm values çš„ docker image tag å€¼ï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ã€‚\néœ€åšåˆ°å…©ä»¶äº‹æƒ…:\ncheckout ç§æœ‰ repository è¨­å®šèˆ‡æ›´æ–° image tag 1. å…ˆ checkout ç§æœ‰å­˜æ”¾ helm value çš„ repository éœ€è¦å…ˆè¨­å®š credential æ‰èƒ½ fetch private repositoryï¼Œæœ‰å…©ç¨®è¨­å®šçš„æ–¹å¼\nè¨­å®š deploy key\næ­¥é©Ÿå¦‚ä¸‹ï¼Œå¯åƒè€ƒé€™ç¯‡\nCreate a new SSH key pairÂ for your repository. Do not set a passphrase. Copy the contents of the public key (.pub file) to a new repositoryÂ deploy keyÂ and check the box to \u0026ldquo;Allow write access.\u0026rdquo; Add a secret to the repository containing the entire contents of the private key. As shown in the example below, configureÂ actions/checkoutÂ to use the deploy key you have created. workflow è¦æ€éº¼å¯«?\nssh-key å¡«å…¥ private key çš„ secrets åç¨± path è¨­å®š checkout çš„ repo æœƒå­˜åœ¨å“ªä¸€å€‹è³‡æ–™å¤¾å…§ - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}} uses: actions/checkout@v3 with: repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}} ssh-key: ${{ secrets.SSH_PRIVATE_KEY }} path: ${{env.TERRAFORM_REPOSITORY_NAME}} è¨­å®š Personal access token (PAT)\nå»ºç«‹ PAT çš„æ–¹å¼ï¼Œå®˜æ–¹æ–‡ä»¶\nå°‡å»ºç«‹å®Œæˆçš„ PAT è¨­å®šåˆ° repository çš„ secrets ä¸­ï¼Œè¨­å®šçš„ secrets åç¨±ç‚º GH_PATï¼Œå®˜æ–¹æ–‡ä»¶\nworkflow è¦æ€éº¼å¯«?\nrepository è¨­å®šç‚º owner/repository_name token å¡«å…¥ PAT çš„ secrets åç¨±ï¼Œé€™é‚Šæ˜¯å°‡ secrets åç¨±ç‚º GH_PAT çš„å…§å®¹è¨­å®šç‚º PAT - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}} uses: actions/checkout@v3 with: repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}} token: ${{ secrets.GH_PAT }} 2. è¨­å®š image tag è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tag 7 digits are the Git default for a short SHA é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ Chapter 7 of the Pro Git book - name: Set short sha outputs id: vars run: echo \u0026#34;sha_short=$(git rev-parse --short HEAD)\u0026#34; \u0026gt;\u0026gt; $GITHUB_OUTPUT 3. æ›´æ–° image tag ä»¥ yq çš„ github action å·¥å…·ä¿®æ”¹ yaml æª”å…§çš„ image tag å€¼ yq çš„å®˜æ–¹æ–‡ä»¶ yq çš„ github é€²è¡Œ git æ“ä½œï¼Œè¨­å®š user name, user emailã€commit ä»¥åŠ push tag å–ä¸Šä¸€å€‹æ­¥é©Ÿ output çš„åƒæ•¸ sha_short - name: Update image tag uses: mikefarah/yq@master with: cmd: yq -i \u0026#39;.pet_app_dashboard_site.image.tag = \u0026#34;${{ steps.vars.outputs.sha_short }}\u0026#34;\u0026#39; ./${{env.TERRAFORM_REPOSITORY_NAME}}/${{env.HELM_FILE_NAME}} - run: | cd ${{env.TERRAFORM_REPOSITORY_NAME}} git config user.name ${{env.GIT_USER_NAME}} git config user.email ${{env.GIT_USER_EMAIL}} git add ${{env.HELM_FILE_NAME}} git commit -m \u0026#34;update image tag to ${{ steps.vars.outputs.sha_short }}\u0026#34; git push origin main è‹¥è¦å°‡ docker image ä¸Šå‚³è‡³ github container registry è©²æ€éº¼åš? 1. ç™»å…¥èˆ‡ç™»å‡º github container registry éœ€è¦è¨­å®š env.REGISTRY ç‚º ghcr.io\nä¸éœ€è¦å¦å¤–è¨­å®š github.actor èˆ‡ GITHUB_TOKEN\n- name: Login to GitHub Container Registry uses: docker/login-action@v2 with: registry: ${{ env.REGISTRY }} username: ${{ github.actor }} password: ${{ secrets.GITHUB_TOKEN }} 2. Extract metadata - name: Extract metadata (tags, labels) for Docker id: meta uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38 with: images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }} 3. Build and push docker image labels çš„å€¼å¯ä»¥å¾æ­¥é©ŸäºŒå–å‡º outputs labels ä¾†ä½¿ç”¨ - name: Build and push Docker image uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc with: context: . push: true tags: ${{ env.REGISTRY }}/${{ env.REPO }}:${{ steps.vars.outputs.sha_short }} labels: ${{ steps.meta.outputs.labels }} åƒè€ƒè³‡æ–™ actions/checkout amazon-ecr-login docker/login-action docker-build-fails-for-arm-images yq çš„å®˜æ–¹æ–‡ä»¶ yq çš„ github Chapter 7 of the Pro Git book creating-a-personal-access-token creating-and-using-encrypted-secrets æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-10T18:33:05+08:00","permalink":"https://yue-jenny.github.io/post/github-workflow/","title":"å¦‚ä½•ä½¿ç”¨ Github Workflow å®Œæˆ CI/CD"},{"content":"å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ? è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥é–‹å§‹å§! ğŸ’ª\n1. Create a repository 2. Naming repository name å°‡ repository ä¾æ“šæ¨¡æ¿ username.github.io å‘½å âš ï¸ username æ˜¯å¸³æˆ¶åç¨± æŸ¥çœ‹è‡ªå·±çš„ URL å¯ä»¥æŸ¥å‡º usernameï¼Œä¾æ“šæ¨¡æ¿ https://github.com/YOUR_USERNAME å‘ˆç¾ æˆ‘å¸³æˆ¶åç¨±æ˜¯ Yue-Jennyï¼Œusername éœ€è¨­å®šç‚º yue-jenny 3. ä¸Šå‚³ä½ çš„éœæ…‹æª”æ¡ˆåˆ° github åƒè€ƒ\u0026quot;ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?\u0026quot;ï¼Œç”¨ hugo å»ºç«‹ä½ çš„éƒ¨è½æ ¼ç³»çµ±ï¼Œä¸¦å°‡ publishing directory çš„éœæ…‹æª”æ¡ˆä¸Šå‚³åˆ° github repository 4. è¨­å®š åˆ° repository çš„ Settings é ç±¤\n\u0026ldquo;Code and automation\u0026rdquo; å€å¡Šä¸­é»é¸ Pages\n\u0026ldquo;Source\u0026rdquo; é¸ Deploy from a branch\n\u0026ldquo;Branch\u0026rdquo; é¸ publishing çš„ä¾†æº\n\u0026ldquo;ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?\u0026rdquo; è¨­å®š publishing directory ç‚º docsï¼Œæ‰€ä»¥é¸ docs 5. æ‹œè¨ªä½ çš„æ–°ç¶²ç«™ ğŸ”¥ ç€è¦½å™¨è¼¸å…¥ URL username.github.io\nåƒè€ƒè³‡æ–™ github pages quickstart æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-10T18:25:43+08:00","permalink":"https://yue-jenny.github.io/post/host-static-file-on-github-pages/","title":"å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ?"},{"content":"ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ Hugo \u0026amp; Github pages å»ºç«‹ä¸€å€‹ blog ç³»çµ±? 1. å…§å®¹ä¿å­˜èˆ‡æ§ç®¡ âœ… æ–‡ç« å…§å®¹ä»¥ markdown èªæ³•æ’°å¯«èˆ‡ä¿å­˜ï¼Œç†Ÿæ‚‰ markdown èªæ³•å¾Œï¼Œæœƒç™¼ç¾å¾ˆæ–¹ä¾¿ ğŸ‘ æ¨è–¦ä½¿ç”¨ vscode ä½œç‚ºç·¨è¼¯å™¨ â˜ï¸ åŠ å…¥ extension å¯ç¢ºèª markdown å…§å®¹å‘ˆç¾ âœŒï¸ ç›´æ¥åŸ·è¡ŒæŒ‡ä»¤é‹è¡Œç¶²ç«™ âœ… å…§å®¹å¯å®šæœŸæ”¾ä¸Šé›²ç«¯ä¿å­˜å‚™ä»½ï¼Œä¸ç”¨æ“”å¿ƒè‹¥éƒ¨è½æ ¼ç³»çµ±ä¸‹ç·šå¾Œï¼Œæ–‡ç« ä¹Ÿè·Ÿè‘—æ¶ˆå¤±æˆ–è€…è©²å¦‚ä½•å‚™ä»½ âœ… ä¿®æ”¹å…§å®¹æ™‚ï¼Œä¸æ€•ç·šä¸Šéƒ¨è½æ ¼ç³»çµ±å‡ºç¾å•é¡Œï¼Œè¼¸å…¥åˆ°ä¸€åŠçš„å…§å®¹ç›´æ¥æ¶ˆå¤± ( æ›¾ç¶“æœ‰é¡ä¼¼çš„ç¶“é©—ï¼Œå…¨éƒ¨é‡ä¾† ğŸ˜“) 2. å¯é«˜åº¦å®¢è£½åŒ– âœ… å®¢è£½å­—é«”å¤§å°é¡è‰²ã€ä¸»é¡Œå¥—ä»¶ç­‰ UI çš„éƒ¨åˆ† âœ… è‡ªç”±æ±ºå®šè¦åŠ å…¥å“ªäº›åŠŸèƒ½ï¼Œå»ºç«‹æ“æœ‰è‡ªæˆ‘é¢¨æ ¼çš„éƒ¨è½æ ¼ç³»çµ± ğŸ’ª è©•è«–å€(æ”¯æ´ä¸åŒå¤šç¨®è»Ÿé«”) LikeCoin button Table of contents é é¦–èˆ‡é å°¾è¨­è¨ˆ \u0026hellip; etc Hugo \u0026amp; Github pages åŸºæœ¬çŸ¥è­˜ 1. Hugo ä»‹ç´¹ å¼•ç”¨è‡ªå®˜æ–¹æ–‡ä»¶èªªæ˜ Hugo is a fast and modern static site generator written in Go, and designed to make website creation fun again.\n2. Github pages ä»‹ç´¹ å¼•ç”¨è‡ªå®˜æ–¹æ–‡ä»¶èªªæ˜ You can use GitHub Pages to showcase some open source projects, host a blog, or even share your rÃ©sumÃ©. This guide will help get you started on creating your next website.\nGetting startï¼Œè®“æˆ‘å€‘é€²å…¥æ­£é¡Œå§! åŸºæœ¬åŠŸèƒ½ 1. Prerequisites\nInstall Hugoï¼Œå®‰è£èƒ½å¤  compile go language çš„å·¥å…·ï¼Œä¸åŒ OS å®‰è£ä¸åŒçš„æª”æ¡ˆ Install Gitï¼Œå¾ŒçºŒä¸‹è¼‰ theme ä½¿ç”¨ 2. Create a site\nhugo new site quickstart 3. åˆ° quickstart ç›®éŒ„ï¼Œä¸¦åŸ·è¡Œ initial git repository\ncd quickstart git init 4. clone ananke themeï¼Œä¸¦ä»¥ git submodule æ–¹å¼å­˜åœ¨\nè‹¥æƒ³äº†è§£ git submoduleï¼Œå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶\ngit submodule add https://github.com/theNewDynamic/gohugo-theme-ananke themes/ananke 5. è¨­å®š site configuration file\nåœ¨ config.toml åŠ å…¥é€™è¡Œ\ntheme = \u0026#39;ananke\u0026#39; 6. æœ¬åœ°å•Ÿå‹• hugo å°ˆæ¡ˆ\næœ¬åœ°å•Ÿå‹• hugo å°ˆæ¡ˆï¼Œ-p æ˜¯æŒ‡å®š port ç‚º 8080\næƒ³çŸ¥é“æ›´å¤š hugo å‘½ä»¤è¡Œå¯ä»¥é»é€™é‚Š\nhugo server -p 8080 ç€è¦½å™¨è¼¸å…¥ https://localhost:8080ï¼Œå¯ç¢ºèªé é¢å·²å‡ºç¾ (é€™æ™‚é‚„æ²’æœ‰æ–‡ç« å…§å®¹)\n7. é–‹å§‹å¯«æ–‡ç« \nå»ºç«‹ä¸€å€‹ markdown æª”æ¡ˆï¼Œmarkdown æª”æ¡ˆå…§çš„è¨­å®šçš„æ„ç¾©\ntitle - æ–‡ç« æ¨™é¡Œ date - å»ºç«‹æ­¤æ–‡ç« çš„æ™‚é–“ï¼Œæ–‡ç« æœƒè·Ÿè‘—æ™‚é–“æ’åº draft - æ˜¯å¦ç‚ºè‰ç¨¿ï¼Œproduction ç’°å¢ƒå»ºè­°åªé¡¯ç¤ºéè‰ç¨¿çš„æ–‡ç« ï¼Œå¯«å®Œæ–‡ç« å¯æ”¹ç‚º falseï¼Œå†åŸ·è¡Œ build æŒ‡ä»¤ï¼Œè®“ markdown è®Šæˆ html ç­‰éœæ…‹æª”æ¡ˆã€‚ hugo new content/post/oidc-aws/index.md 8. é‹è¡Œç¶²ç«™\nå¯«å®Œæ–‡ç« å…§å®¹å¾Œ âœï¸ï¼Œè¨­å®š markdown æª”æ¡ˆå…§çš„ draft ç‚º falseï¼Œè¡¨ç¤ºé draft æ¨¡å¼ï¼Œé‡åˆ·é é¢å¯çœ‹åˆ°æ–‡ç« \nè‹¥éœ€è¦åœ¨ draft æ¨¡å¼ä¸‹é¡¯ç¤ºæ–‡ç« ï¼Œéœ€èª¿æ•´å•Ÿå‹• server çš„å‘½ä»¤è¡Œ\n-Dè¡¨ç¤º --buildDraftsï¼ŒæœƒåŒ…å«è¨»è¨˜ç‚º draft çš„å…§å®¹ hugo server -D -p 8080 æˆåŠŸ ğŸš€ ğŸš€ ğŸš€ 9. host on github page\nè¨­å®š github pagesï¼Œè«‹åƒè€ƒ å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ åŸºæœ¬å®¢è£½åŒ–åŠŸèƒ½ hugo æä¾›ä¸€äº›å®¢è£½åŒ–åŠŸèƒ½ï¼Œä¾†çœ‹çœ‹æ‡‰è©²æ€éº¼åš?\nå¦‚ä½•è¨­å®š publish è³‡æ–™å¤¾? åœ¨ config.toml ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®šï¼Œèƒ½å°‡ publish è³‡æ–™å¤¾è¨­å®šç‚º docsï¼Œè€Œ Github pages èƒ½ host docs è³‡æ–™å¤¾å…§çš„éœæ…‹æª”æ¡ˆ\npublishDir = \u0026#34;docs\u0026#34; å¦‚ä½•æ›¿æ›æˆä¸åŒ theme? æˆ‘ä½¿ç”¨çš„ä¸»é¡Œæ˜¯ hugo-theme-stack ( å®˜æ–¹æ–‡ä»¶ )ï¼Œè©²å¦‚ä½•èª¿æ•´?\nclone hugo-theme-stack theme git submodule add https://github.com/CaiJimmy/hugo-theme-stack themes/hugo-theme-stack èª¿æ•´ config.toml çš„è¨­å®šå€¼ theme theme = \u0026#39;hugo-theme-stack\u0026#39; å¦‚ä½•å®¢è£½åŒ–æ–‡ç« ä¸­çš„ font family? èª¿æ•´ themes\\hugo-theme-stack\\layouts\\partials\\head\\custom.html ï¼Œå…§å®¹å¦‚ä¸‹\nä»¥ google fonts ä½œç‚ºå­—é«”ä¾†æºã€ä»¥ css2 ä½œç‚ºæ¨£å¼ä¾†æº \u0026lt;style\u0026gt; :root { --article-font-family: \u0026#34;Literata\u0026#34;, var(--base-font-family); } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; (function () { const customFont = document.createElement(\u0026#39;link\u0026#39;); customFont.href = \u0026#34;https://fonts.googleapis.com/css2?family=Literata:wght@400;700\u0026amp;display=swap\u0026#34;; customFont.type = \u0026#34;text/css\u0026#34;; customFont.rel = \u0026#34;stylesheet\u0026#34;; document.head.appendChild(customFont); }()); \u0026lt;/script\u0026gt; åƒè€ƒå®˜æ–¹æ–‡ä»¶\nå¦‚ä½•å®¢è£½åŒ–å»ºç«‹ index.md çš„æ¨¡æ¿? èª¿æ•´ archetypes\\default.md æœ‰å…¶ä»–æ›´é€²éšçš„ç”¨æ³•ï¼Œè«‹åƒè€ƒå®˜æ–¹æ–‡ä»¶ é€²éšå®¢è£½åŒ– â˜ï¸ å¦‚ä½•åœ¨ Hugo çš„æ–‡ç« ä¸­åŠ å…¥ LikeCoin button? LikeCoin æ˜¯å¼·èª¿å…§å®¹æœ‰åƒ¹çš„è€Œå‡ºç¾çš„è™›æ“¬è²¨å¹£ï¼Œå¯çµ¦ä½œè€…æ”¯æŒèˆ‡é¼“å‹µ å¯¦ä½œæ–¹å¼: è¨»å†Š Liker ID\nå»ºç«‹ themes\\hugo-theme-stack\\layouts\\partials\\likecoin.html\n\u0026lt;iframe class=\u0026#34;LikeCoin\u0026#34; height=\u0026#34;235\u0026#34; src=\u0026#34;https://button.like.co/in/embed/{{ .Site.Params.likerID }}/button?referrer={{ .Permalink }}\u0026#34; width=\u0026#34;100%\u0026#34; frameborder=0\u0026gt;\u0026lt;/iframe\u0026gt; åœ¨ config.toml ä¸­åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œä¸¦å°‡ [LikerID] æ›´æ”¹ç‚ºä½ çš„ Liker ID\n[Params] likerID = \u0026#34;YOUR_LIKERID\u0026#34; åœ¨æ–‡ç« çš„æ¨¡æ¿ä¸­åŠ å…¥ LikeCoin button\nå°‡ä»¥ä¸‹çš„ç¨‹å¼ç¢¼å¡«å…¥ themes\\hugo-theme-stack\\layouts\\partials\\article\\article.html ä¸­\n{{ partial \u0026#34;likecoin.html\u0026#34; . }} å®˜æ–¹æ–‡ä»¶ é€²éšå®¢è£½åŒ– âœŒï¸ å¦‚ä½•ä½¿ç”¨ Google Console Search åµæ¸¬ç¶²ç«™çš„æ”¶éŒ„æƒ…æ³? è—‰ç”±äº†è§£ç¶²ç«™æˆæ•ˆï¼Œä¸¦é‡å°å¼±é»é€²è¡Œå„ªåŒ–ï¼Œå¯å¢åŠ ç¶²ç«™çš„æ›å…‰ç‡ ğŸŒŸ é€²éšå®¢è£½åŒ– ğŸ‘Œ SEO æœå°‹å¼•æ“å„ªåŒ– google æœƒä¾æ“šç¶²é ç¶²å€å»ºç«‹ indexï¼Œæœå°‹çµæœæœƒå…ˆå‘ˆç¾æœ‰å»ºç«‹ index çš„ç¶²é  å› æ­¤ç‚ºäº†å¼·åŒ–ç¶²é çš„ SEOï¼Œå°‡ä½ å»ºç«‹ sitemap äº¤çµ¦ google ï¼Œè®“ google æœå°‹å¯å¿«é€Ÿæ‰¾åˆ°ä½ çš„ç¶²é  æ³¨æ„äº‹é … âš ï¸ åŸ·è¡Œå®Œ build æŒ‡ä»¤å¾Œï¼Œå»ºè­°ç¿’æ…£æª¢æŸ¥ docs è³‡æ–™å¤¾ ( æˆ–ä½ çš„ publish è³‡æ–™å¤¾ ) å…§çš„ html è®ŠåŒ–æ˜¯å¦ç¬¦åˆé æœŸ\nå¿ƒå¾— é€™æ‡‰è©²æ˜¯ç¬¬äºŒæ¬¡ä½¿ç”¨ framework æ–¹å¼å»ºç«‹éœæ…‹æ–‡ä»¶ç³»çµ±ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä½¿ç”¨ vuepress å”åŠ©å…¬å¸å»ºç«‹å…§éƒ¨æ–‡ä»¶ç³»çµ±ï¼Œé€™æ¬¡æ˜¯ä½¿ç”¨ hugoã€‚å‰è€…æ˜¯ä»¥ javascript ç‚ºç•¶ä½œé–‹ç™¼èªè¨€ï¼Œå¾Œè€…æ˜¯ä»¥ go ç‚ºé–‹ç™¼èªè¨€ã€‚å…©è€…éƒ½è »æ¨è–¦ã€‚ æœ€é‡è¦çš„æ˜¯äº†è§£è©²æ¡†æ¶æ˜¯å¦‚ä½•é‹è¡Œçš„ï¼Œåœ¨é«˜åº¦å®¢è£½åŒ–åŠŸèƒ½æˆ–è€…ä¿®æ”¹å•é¡Œçš„æ™‚ä¾¯æ‰ä¸æœƒçå­æ‘¸è±¡èˆ¬çš„äº‚è©¦ã€‚ hugo æœ‰ 64.5k ğŸŒŸ (æˆªæ­¢è‡³ 20230103)ï¼Œå¾ˆå¤šäººæŒçºŒè²¢ç»èˆ‡ç¶­è­· ğŸ™ ï¼Œå› æ­¤è»Ÿé«”å·¥ç¨‹å¸«å¾é ­åˆ°å°¾ä¾é å®˜æ–¹æ–‡ä»¶èˆ‡ google å®ŒæˆåŸºæœ¬å»ºç«‹ä¸é›£ã€‚ åƒè€ƒè³‡æ–™ github pages quickstart hugo documentation self host likecoin button css2 fifty of the most popular hugo themes / hugo ç†±é–€ä¸»é¡Œå¤§å…¬é–‹ Build and submit a sitemap to google ","date":"2022-12-10T18:22:43+08:00","permalink":"https://yue-jenny.github.io/post/build-with-hugo/","title":"ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?"}]