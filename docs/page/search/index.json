[{"content":"Replication And Sharding å‰è¨€ Replication ç›®çš„æ˜¯å»ºç«‹ä¸€å€‹é«˜å¯ç”¨çš„è³‡æ–™åº«æ¶æ§‹ å¯ä»¥é¸æ“‡åŒæ­¥æˆ–éåŒæ­¥çš„æ–¹å¼é€²è¡Œ main èˆ‡ replication è³‡æ–™åº«çš„åŒæ­¥æ–¹å¼ Sharding ç›®çš„æ˜¯ç‚ºäº†å»ºç«‹é«˜ååé‡çš„è³‡æ–™åº«æ¶æ§‹ é”æˆ sharding çš„ç­–ç•¥æœ‰ hashing strategy ä½¿ç”¨ä¸åŒ table (éœ€è¦ç¢ºèªè³‡æ–™å¤  unitform) å­˜å– åƒè€ƒè³‡æ–™ ğŸ‘ system experts ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-02-14T15:00:24+08:00","permalink":"https://yue-jenny.github.io/2023/02/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E5%8D%81-replication-and-sharding/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(å) Replication And Sharding"},{"content":"Peer-To-Peer Networks P2P network ä»‹ç´¹ å°ç­‰å¼ç¶²è·¯ï¼Œåˆç¨±å°ç­‰æŠ€è¡“ï¼Œä¾é ä½¿ç”¨è€…ç¾¤ï¼ˆpeersï¼‰äº¤æ›è³‡è¨Šçš„ç¶²éš›ç¶²è·¯é«”ç³» ç›®æ¨™å°±æ˜¯è®“æ‰€æœ‰çš„å®¢æˆ¶ç«¯éƒ½èƒ½æä¾›è³‡æºï¼ŒåŒ…æ‹¬é »å¯¬ï¼Œå„²å­˜ç©ºé–“å’Œè¨ˆç®—èƒ½åŠ›ã€‚å› æ­¤ï¼Œç•¶æœ‰ç¯€é»åŠ å…¥ä¸”å°ç³»çµ±è«‹æ±‚å¢å¤šï¼Œæ•´å€‹ç³»çµ±çš„å®¹é‡ä¹Ÿå¢å¤§ã€‚é€™æ˜¯å…·æœ‰ä¸€çµ„å›ºå®šä¼ºæœå™¨çš„Client-Serverçµæ§‹ä¸èƒ½å¯¦ç¾çš„ï¼Œå› ç‚ºåœ¨ä¸Šè¿°é€™ç¨®çµæ§‹ä¸­ï¼Œå®¢æˆ¶ç«¯çš„å¢åŠ æ„å‘³è‘—æ‰€æœ‰ä½¿ç”¨è€…æ›´æ…¢çš„è³‡æ–™å‚³è¼¸ã€‚ æ ¹æ“šä¸­å¤®åŒ–ç¨‹åº¦ï¼Œå¯ä»¥å€åˆ†ç‚ºä¸€èˆ¬å‹P2Pã€ç‰¹æ®Šå‹P2Pèˆ‡æ··åˆå‹P2Pï¼Œä½¿ç”¨ä¸€èˆ¬å‹P2PæŠ€è¡“çš„ç¶²è·¯ç³»çµ±æœ‰æ¯”ç‰¹å¹£ã€Gnutellaæˆ–è‡ªç”±ç¶²ç­‰ã€‚ å¥½è™• ä¸æœƒå› ç‚ºå–®é»æ•…éšœå°±å°è‡´æ•´é«”æœå‹™ç„¡æ³•é‹ä½œ ä¸æœƒè®“å–®é»é‡åˆ°æ•ˆèƒ½ç“¶é ¸ Gossip Protocol ç°¡ä»‹ åˆç¨±ä½œ epidemic protocolï¼Œæ˜¯ P2P network çš„æ ¸å¿ƒæŠ€è¡“ Gossip protocol çš„å¯¦éš›æ‡‰ç”¨å¦‚ Cassandra / Redis Cluster / Consul ç­‰é›†ç¾¤æ¶æ§‹ consul ç”¨æ–¼ç®¡ç† membership èˆ‡å‚³æ’­æ¶ˆæ¯ï¼Œæœ‰èˆˆè¶£å¯é»é€™é‚Š å»£åº¦å„ªå…ˆéæ­·(Breadth-First Search, BFS) å‡è¨­ A å¾—åˆ°æŸäº›è³‡è¨Šï¼Œæ›´æ–°äº†è‡ªèº«çš„è³‡è¨Šï¼ŒA éœ€è¦å°‡è³‡è¨Šå‘Šè¨´ Bã€C ç­‰ï¼Œç„¶å¾Œ Bã€C å‘Šè¨´å…¶ä»–çš„ Dã€Eã€Fã€Gï¼Œä¸€ç›´éæ­·ã€‚å¦‚æœç¯€é» B æ”¶åˆ° A çš„æ¶ˆæ¯ï¼Œç™¼ç¾è‡ªå·±æ—©å°±çŸ¥é“é€™å€‹æ¶ˆæ¯å°±ç›´æ¥å¿½ç•¥ï¼Œå¾è€Œå¯ä»¥é˜²æ­¢åœ–é‡è¤‡éæ­·ã€‚ åŸ·è¡Œéç¨‹ Gossip éç¨‹æ˜¯ç•°æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯èªªç™¼æ¶ˆæ¯çš„ç¯€é»ä¸æœƒé—œæ³¨å°æ–¹æ˜¯å¦æ”¶åˆ°ï¼Œå³ä¸ç­‰å¾…éŸ¿æ‡‰ï¼›ä¸ç®¡å°æ–¹æœ‰æ²’æœ‰æ”¶åˆ°ï¼Œå®ƒéƒ½æœƒæ¯éš”1 ç§’å‘å‘¨åœç¯€é»ç™¼æ¶ˆæ¯ é€šä¿¡æ¨¡å¼ Push: ç¯€é» A å°‡æ•¸æ“š (key,value,version) åŠå°æ‡‰çš„ç‰ˆæœ¬è™Ÿæ¨é€çµ¦ç¯€é» Bï¼Œç¯€é» B æ›´æ–° A ä¸­æ¯”è‡ªå·±æ–°çš„æ•¸æ“š Pull: A åƒ…å°‡æ•¸æ“š key, version æ¨é€çµ¦ Bï¼ŒB å°‡æœ¬åœ°æ¯” A æ–°çš„æ•¸æ“šï¼ˆKey, value, versionï¼‰æ¨é€çµ¦ Aï¼ŒA æ›´æ–°æœ¬åœ° å° A ä¾†èªªæ˜¯ pull Push/Pull: èˆ‡ Pull é¡ä¼¼ï¼Œæ­¥é©Ÿä¸Šå¤šä¸€æ­¥ï¼ŒA å†å°‡æœ¬åœ°æ¯” B æ–°çš„æ•¸æ“šæ¨é€çµ¦ Bï¼ŒB å‰‡æ›´æ–°æœ¬åœ° æ”¶æ–‚é€Ÿåº¦æœ€å¿«ï¼Œæ”¶æ–‚é€Ÿåº¦æ˜¯æŒ‡æ‰€æœ‰ç¯€é»çš„è³‡è¨Šé”åˆ°ä¸€è‡´çš„é€Ÿåº¦ å„ªé» æ“´å±•æ€§ (scalability) å…è¨±ä»»æ„ç¯€é»çš„å¢åŠ å’Œæ¸›å°‘ å®¹éŒ¯ (Fault tolerance) ä»»ä½•ç¯€é»çš„æ•…éšœå’Œé‡å•Ÿéƒ½ä¸æœƒå½±éŸ¿ Gossip æ¶ˆæ¯çš„å‚³æ’­ å»ä¸­å¿ƒåŒ– (decentralization) æ‰€æœ‰ç¯€é»éƒ½å¯ä»¥æ˜¯å°ç­‰çš„ï¼Œä»»ä½•ä¸€å€‹ç¯€é»ç„¡éœ€çŸ¥é“æ•´å€‹ç‹€æ³ï¼Œåªè¦ç¶²è·¯ç›¸é€šï¼Œä»»æ„ä¸€å€‹ç¯€é»å°±å¯ä»¥æŠŠæ¶ˆæ¯æ•£æ’­åˆ°å…¨ç¶² ä¸€è‡´æ€§æ”¶æ–‚ æ¶ˆæ¯æœƒä»¥ä¸€å‚³åã€åå‚³ç™¾ä¸€æ¨£çš„æŒ‡æ•¸ç´šé€Ÿåº¦åœ¨ç¶²è·¯ä¸­å¿«é€Ÿå‚³æ’­ï¼Œå› æ­¤ç³»çµ±ç‹€æ…‹çš„ä¸ä¸€è‡´å¯ä»¥åœ¨å¾ˆå¿«çš„æ™‚é–“å…§æ”¶æ–‚åˆ°ä¸€è‡´ ç°¡æ˜“å¯¦ç¾ ç¼ºé» latency ç¯€é»åªæœƒéš¨æ©Ÿå‘å°‘æ•¸å¹¾å€‹ç¯€é»ç™¼é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ€çµ‚æ˜¯é€šéå¤šå€‹è¼ªæ¬¡çš„æ•£æ’­è€Œåˆ°é”å…¨ç¶² æ¶ˆæ¯å†—é¤˜ ç¯€é»æœƒå®šæœŸéš¨æ©Ÿé¸æ“‡å‘¨åœç¯€é»ç™¼é€æ¶ˆæ¯ï¼Œè€Œæ”¶åˆ°æ¶ˆæ¯çš„ç¯€é»ä¹Ÿæœƒé‡è¤‡è©²æ­¥é©Ÿï¼Œå› æ­¤å°±ä¸å¯é¿å…çš„å­˜åœ¨æ¶ˆæ¯é‡è¤‡ç™¼é€çµ¦åŒä¸€ç¯€é»çš„æƒ…æ³ï¼Œé€ æˆäº†æ¶ˆæ¯çš„å†—é¤˜ï¼ŒåŒæ™‚ä¹Ÿå¢åŠ äº†æ”¶åˆ°æ¶ˆæ¯çš„ç¯€é»çš„è™•ç†å£“åŠ›ã€‚ ç”±æ–¼æ˜¯å®šæœŸç™¼é€ï¼Œå³ä½¿æ”¶åˆ°äº†æ¶ˆæ¯çš„ç¯€é»é‚„æœƒåè¤‡æ”¶åˆ°é‡è¤‡æ¶ˆæ¯ï¼ŒåŠ é‡äº†æ¶ˆæ¯çš„å†—é¤˜ã€‚ åƒè€ƒè³‡æ–™ ğŸ‘ å°ç­‰ç¶²è·¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ Day20|P2Pç¶²è·¯(1)ï¼šP2Pç¶²è·¯åŸºç¤çŸ¥è­˜ - iT é‚¦å¹«å¿™::ä¸€èµ·å¹«å¿™è§£æ±ºé›£é¡Œï¼Œæ‹¯æ•‘ IT äººçš„ä¸€å¤© Gossip Protocol ä»‹ç´¹ (ä¸Š) - å¾ Cassandra å…§éƒ¨å¯¦ä½œèªè­˜ Gossip Protocol çš„ä½¿ç”¨ P2P ç½‘ç»œæ ¸å¿ƒæŠ€æœ¯ï¼šGossip åè®® ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-02-10T09:58:46+08:00","permalink":"https://yue-jenny.github.io/2023/02/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%B9%9D-peer-to-peer-networks/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(ä¹) Peer-To-Peer Networks"},{"content":"Pulling And Streaming Prerequistites Client-Server Model client ç™¼ requestï¼Œserver æä¾›è³‡æ–™æˆ–æœå‹™çµ¦ client Socket æ˜¯ä¸€ç¨®ä¸€ç¨®ç¶²è·¯å‚³è¼¸å”å®šï¼Œå¯¦ç¾ client èˆ‡ server çš„é›™å‘æºé€šæ©Ÿåˆ¶ï¼Œä½¿ç”¨ TCP é€£ç·šï¼Œé€é HTTP 3-way handshake å»ºç«‹é€£ç·š ç›®çš„æ˜¯å¯ä»¥å³æ™‚åœ°è®“é›™æ–¹äº¤æ›è³‡è¨Šï¼Œæ‡‰ç”¨å ´æ™¯å¦‚èŠå¤©å®¤ å„ªé»æ˜¯è¼ƒå°‘é–‹éŠ·ã€å³æ™‚æ€§ã€äºŒé€²ä½æ”¯æ´ç­‰ Polling æ¯éš”å¤šå°‘å›ºå®šçš„æ™‚é–“å»æ›´æ–°è³‡æ–™ Streaming (Pushing) æŒçºŒèˆ‡ server ä¿æŒé€£ç·šï¼Œä¸¦éš¨æ™‚å–å¾—æœ€æ–°è³‡æ–™ åƒè€ƒè³‡æ–™ ğŸ‘ WebSocket - Web APIs | MDN Polling and Streaming - Concept \u0026amp; Scenarios - GeeksforGeeks ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-02-06T23:24:44+08:00","permalink":"https://yue-jenny.github.io/2023/02/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E5%85%AB-pulling-and-streaming/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(å…«) Pulling And Streaming"},{"content":"Configuration Static Configuration V.S Dynamic Configuration Static Configuration ä»¥ YAML æˆ– JSON ç‚ºä¸»çš„è¨­å®šæª”\nYAML: --- receipt: Oz-Ware Purchase Invoice date: 2012-08-06 customer: given: Dorothy family: Gale JSON { \u0026#34;streetAddress\u0026#34;: \u0026#34;21 2nd Street\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;New York\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;NY\u0026#34;, \u0026#34;postalCode\u0026#34;: \u0026#34;10021\u0026#34; } éœ€è¦è·Ÿ source code çµåˆ\néœ€è¦ re-deploy æ‡‰ç”¨æ‰èƒ½æ›´æ–°è¨­å®š\nDynamic Configuration UI ä»‹é¢å»æ§åˆ¶è¨­å®š éœ€è¦å»å¯¦ä½œæ­¤ feature åƒè€ƒè³‡æ–™ ğŸ‘ ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-02-04T10:30:09+08:00","permalink":"https://yue-jenny.github.io/2023/02/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%B8%83-configuration/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(ä¸ƒ) Configuration"},{"content":"Rate Limiting Prerequistites DDOS åˆ†æ•£å¼é˜»æ–·æœå‹™æ”»æ“Šï¼ˆdistributed denial-of-service attackï¼‰äº¦ç¨±æ´ªæ°´æ”»æ“Š DoS é˜»æ–·æœå‹™æ”»æ“Šï¼ˆè‹±èªï¼šdenial-of-service attackï¼‰ é é˜²æ–¹å¼æ˜¯ä½¿ç”¨ rate limit, å¯ä»¥é™åˆ¶ IP, ä½¿ç”¨è€…å¸³æˆ¶, å€åŸŸç­‰ç­‰ã€‚ Rate Limiting æ„æ€å°±æ˜¯é™æµ æ ¹æ“šç¶­åŸºç™¾ç§‘ï¼Œå®šç¾©æ˜¯ã€Œæ§åˆ¶è¨ˆç®—æ©Ÿç™¼é€æˆ–æ¥æ”¶çš„è«‹æ±‚ä¹‹é »ç‡ã€ Rate Limiting for Multiple Server use Redis to implement rate limiting for multiple servers Application Layer å¦‚ä½•å¯¦ç¾ Rate Limit å¯¦ç¾æ–¹å¼ åœ¨ Node.js è£¡ï¼Œæœ‰ä¸€å€‹ç”¨ä¾†åšé™æµçš„ express middleware å«åšÂ express-rate-limitï¼Œå¯çœ‹é€™ç¯‡ ç¼ºé» åœ¨ API server è£¡é¢è‡ªå·±ç”¨ middleware åšé™æµï¼Œé›–ç„¶é€™æ¨£åšæ„Ÿè¦ºå¾ˆæ–¹ä¾¿ï¼Œä½†ä¹Ÿæœƒè®“ API server ç„¡æ³•å®Œå…¨å°ˆæ³¨åœ¨æ¥­å‹™é‚è¼¯ä¸Š AWS WAF (Web Application Firewall) ç›®çš„æ˜¯ä¿è­·æ‚¨çš„ Web æ‡‰ç”¨ç¨‹å¼å…å—å¸¸è¦‹ Web å…¥ä¾µç¨‹å¼çš„å±å®³ é‹ä½œæ–¹å¼ é—œæ–¼ AWS WAF components Web ACLs\nç›®çš„æ˜¯ä¿è­· AWS resourcesï¼Œè—‰ç”±å»ºç«‹ä¸€çµ„ web ACL ä¸¦æ–°å¢ rules å»å®šç¾©ä¿è­·ç­–ç•¥ å±¬æ–¼ AWS WAF resource Rules\né¡§åæ€ç¾©ï¼Œå®šç¾©æª¢æŸ¥æ¨™æº– (inspection criteria)ï¼Œç•¶æœ‰ matching requestsï¼Œå¯ä»¥åšçš„äº‹æƒ…å¦‚å…è¨±é€šéã€è¨ˆç®—ä»–å€‘æˆ–è€…åŸ·è¡Œ CAPTCHA puzzles å»æª¢æŸ¥æ˜¯å¦ç‚ºæ©Ÿå™¨äºº ä¸å±¬æ–¼ AWS WAF resource Rule groups\nå¯ä»¥çµ„åˆè‡ªå·±çš„ rule groupsï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ web ACL ä¸­å®šç¾©è¦å‰‡ å±¬æ–¼ AWS WAF resource é—œæ–¼ Web ACL capacity units (WCU) ä½¿ç”¨ WCU ä¾†è¨ˆç®—èˆ‡æ§åˆ¶é‹è¡Œè¦å‰‡ã€è¦å‰‡çµ„å’Œ Web ACL æ‰€éœ€çš„æ“ä½œè³‡æº For example, a size constraint rule statement uses fewer WCUs than a statement that inspects against a regex pattern set. AWS WAF æœƒç®¡ç† Rule capacity, Rule group capacity, Web ACL capacityï¼Œè©³æƒ…å¯ä»¥åƒè€ƒé€™ç¯‡ é—œæ–¼ Resources that you can protect with AWS WAF ä½¿ç”¨ AWS WAF web ACL å»ä¿è­·å…¨çƒæˆ–å€åŸŸæ€§çš„ resource typesï¼Œåªéœ€è¦å°‡ web ACL é€£çµåˆ°ä½ æƒ³è¦ä¿è­·çš„ resources ä¸Šï¼Œå®˜æ–¹æä¾› Amazon CloudFront ä»¥åŠ Regional resources ç‰¹åˆ¥èªªæ˜ Note: Amazon CloudFront æ˜¯ä¸€é …å…§å®¹äº¤ä»˜ç¶²è·¯(CDN) æœå‹™ï¼Œå¯å”åŠ©æ‚¨ä»¥é«˜é€Ÿæ•ˆèƒ½ã€å®‰å…¨å’Œé–‹ç™¼äººå“¡æ˜“ç”¨æ€§å¿«é€Ÿã€å¯é åœ°åˆ†ç™¼éœæ…‹å’Œå‹•æ…‹å…§å®¹ã€‚ é™åˆ¶ ä¸€å€‹ web ACL å¯ä»¥é€£çµå¤šå€‹ AWS resourcesï¼Œä¸€å€‹ AWS resource åƒ…é€£çµä¸€å€‹ web ACL ä¸€å€‹ web ACL å¯ä»¥é€£çµå¤šå€‹ CloudFront distributionsï¼Œä¸”å·²é€£çµåˆ° CloudFront distribution çš„ web ACL ä¸èƒ½å†å»é€£çµå…¶ä»– AWS resource type ä½¿ç”¨æƒ…å¢ƒï¼Œèˆ‰ä¾‹ 3 é» ç¯©é¸ Web æµé‡ å»ºç«‹è¦å‰‡ä»¥æ ¹æ“šå„ç¨®æ¢ä»¶ç¯©é¸ Web è«‹æ±‚ï¼Œä¾‹å¦‚ IP åœ°å€ã€HTTP æ¨™é ­å’Œå…§æ–‡ï¼Œæˆ–è‡ªè¨‚ URIã€‚ é˜²æ­¢å¸³æˆ¶æ¥ç®¡è©é¨™ ç›£æ§æ‡‰ç”¨ç¨‹å¼çš„ç™»å…¥é é¢ï¼Œåµæ¸¬ä»¥ç›œç”¨æ†‘è­‰å°ä½¿ç”¨è€…å¸³æˆ¶é€²è¡Œçš„æœªç¶“æˆæ¬Šå­˜å–ã€‚ ä½¿ç”¨ API ç®¡ç† AWS WAF è‡ªå‹•å»ºç«‹å’Œç¶­è­·è¦å‰‡ï¼Œä¸¦å°‡é€™äº›è¦å‰‡ä½µå…¥é–‹ç™¼å’Œè¨­è¨ˆç¨‹åºä¸­ã€‚ æ¯”è¼ƒ AWS WAF, AWS Shield èˆ‡ AWS Firewall Manager AWS WAF monitor requests that are forwarded to your web applications and control access to your content. AWS Shield help protect against DDoS attacks. AWS Firewall Manager set up your firewall rules and apply the rules automatically across accounts and resources, even as new resources are added. åƒè€ƒè³‡æ–™ ğŸ‘ What are AWS WAF, AWS Shield, and AWS Firewall Manager? How AWS WAF works ä½å»¶é²å…§å®¹äº¤ä»˜ç¶²è·¯ (CDN) - Amazon CloudFront - Amazon Web Services express-rate-limit ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-02-02T10:55:49+08:00","permalink":"https://yue-jenny.github.io/2023/02/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E5%85%AD-rate-limiting/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(å…­) Rate Limiting"},{"content":"Logging And Monitoring å‰è¨€ Prerequistites Logging Monitoring Alerting Elastic Search, Logstash, Kibana (ELK) Elasticsearch çš„æ ¸å¿ƒæ˜¯æœç´¢å¼•æ“ã€æ¡é›†ç®¡é“Logstash å’Œå¯è¦–åŒ–å·¥å…·Kibanaã€‚\nElastic Search Introduce ä¸€å€‹å»ºç½®åœ¨ Apache Lucene ä¸Šçš„åˆ†æ•£å¼æœå°‹å’Œåˆ†æå¼•æ“ï¼Œæä¾› near real-time çš„æ•¸æ“šæœå°‹èˆ‡åˆ†æï¼Œèƒ½å¤ å„²å­˜è¤‡é›œçµæ§‹çš„æ•¸æ“š\næˆæ¬Šä¸æ˜¯é–‹æ”¾åŸå§‹ç¢¼ï¼Œä¹Ÿä¸å‘ä½¿ç”¨è€…æä¾›ç›¸åŒçš„è‡ªç”±ã€‚å› æ­¤å¼•é€²äº† OpenSearch å°ˆæ¡ˆï¼Œæ­¤å°ˆæ¡ˆæ˜¯ä¸€å€‹ç¤¾ç¾¤é©…å‹•å‹ ALv2 è¨±å¯çš„é–‹æ”¾åŸå§‹ç¢¼ Elasticsearch å’Œ Kibana åˆ†æ”¯\nåˆ—èˆ‰å¹¾é …æ‡‰ç”¨å ´æ™¯:\nç¶²ç«™æˆ–æ‡‰ç”¨çš„ search box å„²å­˜èˆ‡åˆ†æ logs, metrics ç­‰ structured æˆ– unstructured æ–‡å­—é€²è€Œæ‰¾å‡ºå®‰å…¨æ¼æ´ å°‡ Elasticsearch ä½œç‚ºå„²å­˜å¼•æ“å»è‡ªå‹•åŒ– workflows å°‡ Elasticsearch ä½œç‚º GIS å»æ•´åˆèˆ‡åˆ†æç©ºé–“è³‡æ–™ å°‡ Elasticsearch ä½œç‚ºç”Ÿç‰©è¨Šæ¯æœå°‹å·¥å…·å»å„²å­˜èˆ‡è™•ç†åŸºå› è³‡æ–™ ä»¥è³‡æ–™æµä¾†ç°¡æ˜“èªªæ˜ Elasticsearch 8.6(current) åšçš„äº‹æƒ… documents and indices\nå„²å­˜å·²åºåˆ—åŒ–ç‚º JSON æ–‡æª”çš„è¤‡é›œæ•¸æ“šçµæ§‹ æœ‰å¤šå€‹ Elasticsearch ç¯€é»æ™‚ï¼Œå­˜å„²çš„æ–‡æª”åˆ†ä½ˆåœ¨é›†ç¾¤ä¸­ï¼Œä¸¦ä¸”å¯ä»¥å¾ä»»ä½•ç¯€é»ç«‹å³è¨ªå• æ”¯æ´å¿«é€Ÿæœå°‹ï¼Œå› ç‚ºä½¿ç”¨äº† â€œinverted indexâ€ çš„æ•¸æ“šçµæ§‹ï¼Œæ¯ç¨®æ•¸æ“šéƒ½æœ‰å°ˆå±¬ä¸¦å„ªåŒ–éçš„çµæ§‹ï¼Œå¦‚ text fields are stored in inverted indices numeric and geo fields are stored in BKD trees æ”¯æ´ schema-lessï¼Œç•¶ä¸ç¢ºå®šå¦‚ä½•è™•ç†æ–‡æª”ä¸­çš„å­—æ®µæ™‚ä½¿ç”¨ï¼Œéœ€å•Ÿç”¨ â€œdynamic mappingâ€ search and analyze\næ”¯æ´ structured queries, full text queries ä»¥åŠçµåˆå…©ç¨®æœå°‹æ–¹å¼ é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿæœ‰æ”¯æ´é«˜æ€§èƒ½åœ°ç†ç©ºé–“èˆ‡æ•¸å€¼æ•¸æ“šæœå°‹ é€é Elasticsearchâ€™s comprehensive JSON-style query language (Query DSL) å¯ä»¥å»è¨ªå•é€™äº›æœå°‹åŠŸèƒ½ çµåˆ JDBC èˆ‡ ODBC drivers å¯ä»¥è®“ç¬¬ä¸‰æ–¹ applications æ›´åŠ å»£æ³›åœ°é€é SQL èˆ‡ Elasticsearch äº’å‹• scalabilty and resilience\nElasticsearch å¯æ ¹æ“šæ‚¨çš„éœ€æ±‚é€²è¡Œæ“´å±•ï¼Œä¸¦ä¸”çŸ¥é“å¦‚ä½•å¹³è¡¡å¤šç¯€é» cluster é‹ä½œæ–¹å¼ å°‡ shards åˆ†å¸ƒåˆ°å¤šå€‹ nodes ä¸Šï¼Œåˆ©ç”¨ç¢ºä¿å†—é¤˜ (redundancy) å¯ä»¥é”åˆ°é˜²æ­¢ hardware failures ä»¥åŠå¢åŠ  query capacity (è®€å–è«‹æ±‚çš„èƒ½åŠ›)ï¼Œç•¶ nodes æ•¸é‡å¢æ¸›ï¼ŒElasticsearch æœƒè‡ªå‹•é·ç§» shard ä»¥é‡æ–°å¹³è¡¡é›†ç¾¤ shard æœ‰å…©ç¨® types primaries: Each document in an index belongs to one primary shard. æ•¸é‡å›ºå®šã€‚ replicas: a copy of a primary shard. ç‚ºäº†å†—é¤˜ (redundancy)ï¼Œå¯ä»¥é”åˆ°é˜²æ­¢ hardware failures ä»¥åŠå¢åŠ  query capacity (è®€å–è«‹æ±‚çš„èƒ½åŠ›)ã€‚ æ•¸é‡å¯ä»¥æ›´æ”¹ã€‚ Logstash Introduce ä¸€ç¨®é–‹æ”¾åŸå§‹ç¢¼è³‡æ–™æ“·å–å·¥å…·ï¼Œå¯è®“æ‚¨å¾å„ç¨®ä¾†æºæ”¶é›†è³‡æ–™ã€è½‰æ›è³‡æ–™ä¸¦å°‡è³‡æ–™å‚³é€åˆ°æ‰€éœ€ç›®çš„åœ°ã€‚æ†‘è—‰é å…ˆå»ºç½®çš„ç¯©é¸æ¢ä»¶å’Œå° 200 å¤šå€‹å¤–æ›ç¨‹å¼çš„æ”¯æ´ï¼ŒLogstash å¯è®“ä½¿ç”¨è€…è¼•é¬†æ“·å–è³‡æ–™ï¼Œè€Œä¸ç®¡è³‡æ–™ä¾†æºæˆ–é¡å‹å¦‚ä½•ã€‚ æ¶æ§‹: ä¸€å€‹è¼¸å…¥ï¼Œä¸€å€‹è¼¸å‡ºï¼Œä¸­é–“æœ‰å€‹ç®¡é“ï¼ˆä¸æ˜¯å¿…é ˆçš„ï¼‰ï¼Œé€™å€‹ç®¡é“ç”¨ä¾†æ”¶é›†ã€è§£æå’Œè½‰æ›æ—¥èªŒçš„ã€‚ three stages: inputs â†’ filters â†’ outputs Inputs generate events, filters modify them, and outputs ship them elsewhere. ç°¡ä»‹ Inputs, Filters èˆ‡ Outputs Inputs å¦‚ file, syslog, redis or beat\nåƒè€ƒé€™ç¯‡ configure Filebeat to send log lines to Logstash Filters å¦‚ grok, mutate, drop, clone, geoip\ngrok: è§£æèˆ‡é‡çµ„æ–‡å­—ï¼ŒLogstash ä¸­ç”¨ä¾†è§£æéçµæ§‹æ€§çš„ log çš„æœ€å¥½æ–¹å¼ï¼Œå¯åƒè€ƒé€™ç¯‡ mutate: èƒ½å¤  rename, remove, replace, and modify fields in your events drop: å®Œæ•´å‰”é™¤ä¸€å€‹ event clone: è¤‡è£½ä¸€å€‹ event geoip: åŠ å…¥ä¸€äº›æ–°çš„è³‡è¨Šï¼Œå¦‚ IP åœ°å€ Outputs å¦‚ elasticsearch, file, graphite, statsd\nelasticsearch: æ”¾åœ¨é€™é‚Šçš„å„ªé»æ˜¯æ•ˆç‡ã€æ–¹ä¾¿ä¸”å®¹æ˜“æœå°‹çš„\nfile: å¯«å…¥æª”æ¡ˆå…§\ngraphite: ä¸€å€‹ open-source çš„å„²å­˜æ™‚åºè³‡æ–™èˆ‡ render graphs å·¥å…·\næ ¹æ“šå®˜æ–¹æ–‡ä»¶ä»‹ç´¹ Graphite does two things:\n1.Store numeric time-series data\n2.Render graphs of this data on demand\nstatsd:\nç”¨é€”æ˜¯ç›£æ§æ‡‰ç”¨ç¨‹å¼ï¼Œæ–¹å¼æ˜¯å°‡ metrics æ”¶é›†ã€å„²å­˜ä¸¦å»ºç«‹å°æ‡‰çš„è­¦å ±æ©Ÿåˆ¶ åŸç†æ˜¯ç›£è½ UDP (æˆ– TCP) çš„ç¨‹å¼ä¸¦æ”¶é›†æ•¸æ“šï¼Œå°‡æ•¸æ“šå‚³é€çµ¦å…¶ä»–æ‡‰ç”¨ç¨‹å¼ã€‚ é‡è¦æ¦‚å¿µ bucket: æ¯å€‹ stat æ“æœ‰è‡ªå·±çš„ bucket value: æ¯å€‹ stat æ“æœ‰ä¸€å€‹ valueï¼Œé€šå¸¸æ˜¯ integer type: æŒ‡å®š c (ç”¨æ–¼è¨ˆæ•¸å™¨)ã€g (ç”¨æ–¼æ¸¬é‡å„€)ã€ms (ç”¨æ–¼è¨ˆæ™‚å™¨)ã€h (ç”¨æ–¼é•·æ¢åœ–) æˆ– s (ç”¨æ–¼ set) å®˜æ–¹æ–‡ä»¶ Codecs plugins\nå¯åœ¨ input æˆ–è€… output æµç¨‹å»æ›´æ”¹æ•¸æ“šé¡¯ç¤ºçš„æ ¼å¼ codec-plugins æ•´åˆå¤šç¨® data source åƒè€ƒé€™ç¯‡ç¯„ä¾‹, conf æª”è¨­å®šå€¼æ‡‰å¦‚ä¸‹: input { twitter { consumer_key =\u0026gt; \u0026#34;enter_your_consumer_key_here\u0026#34; consumer_secret =\u0026gt; \u0026#34;enter_your_secret_here\u0026#34; keywords =\u0026gt; [\u0026#34;cloud\u0026#34;] oauth_token =\u0026gt; \u0026#34;enter_your_access_token_here\u0026#34; oauth_token_secret =\u0026gt; \u0026#34;enter_your_access_token_secret_here\u0026#34; } beats { port =\u0026gt; \u0026#34;5044\u0026#34; } } output { elasticsearch { hosts =\u0026gt; [\u0026#34;IP Address 1:port1\u0026#34;, \u0026#34;IP Address 2:port2\u0026#34;, \u0026#34;IP Address 3\u0026#34;] } file { path =\u0026gt; \u0026#34;/path/to/target/file\u0026#34; } } Kibana ä¸€ç¨®ç”¨æ–¼æª¢è¦–æ—¥èªŒå’Œäº‹ä»¶çš„è³‡æ–™è¦–è¦ºåŒ–å’Œæ¢ç´¢å·¥å…·ã€‚Kibana æä¾›æ˜“æ–¼ä½¿ç”¨çš„äº’å‹•å¼åœ–è¡¨ã€é å…ˆå»ºç½®çš„å½™ç¸½å’Œç¯©é¸æ¢ä»¶ä»¥åŠåœ°ç†ç©ºé–“æ”¯æ´ Introduce ä¸€ç¨®ç”¨æ–¼æª¢è¦–æ—¥èªŒå’Œäº‹ä»¶çš„è³‡æ–™è¦–è¦ºåŒ–å’Œæ¢ç´¢å·¥å…·ã€‚Kibana æä¾›æ˜“æ–¼ä½¿ç”¨çš„äº’å‹•å¼åœ–è¡¨ã€é å…ˆå»ºç½®çš„å½™ç¸½å’Œç¯©é¸æ¢ä»¶ä»¥åŠåœ°ç†ç©ºé–“æ”¯æ´ é€é kibana èƒ½åšåˆ°: é€éæœå°‹èˆ‡è§€å¯Ÿä½ çš„æ•¸æ“šé€²è€Œæ‰¾å‡ºå®‰å…¨æ¼æ´ åˆ†æèˆ‡è¦–è¦ºåŒ–ä½ çš„æ•¸æ“š ç®¡ç†æ•¸æ“šã€ç›£æ¸¬ Elastic Stack cluster å¥åº·ç¨‹åº¦èˆ‡æ¬Šé™æ§ç®¡ Kibana Query Language (KQL) only filters data, and has no role in aggregating, transforming, or sorting data filter documents where a value for a field exists, matches a given value, or is within a given range example filter for documents where the http.request.method is GET, use the following query:\nhttp.request.method: GET search for all documents for which http.response.bytes is less than 10000:\nhttp.response.bytes \u0026lt; 10000 filter documents where the http.request.method is not GET, use the following query:\n**NOT** http.request.method: GET find documents where a single value inside the user array contains a first name of â€œAliceâ€ and last name of â€œWhiteâ€, use the following:\nuser:{ first: \u0026#34;Alice\u0026#34; and last: \u0026#34;White\u0026#34; } Lucene query syntax regular expressions or fuzzy term matching Lucene syntax is not able to search nested objects or scripted fields. example find entries that have 4xx status codes and have an extension of php or html:\nstatus:[400 TO 499] AND (extension:php OR extension:html) Prometheus ä»‹ç´¹ open-source systems monitoring and alerting toolkit Cloud Native Computing Foundation (CNCF) in 2016 as the second hosted project NOTE: ç¬¬ä¸€å€‹è¢« CNCF hosted çš„ project æ˜¯ kubernetes collects and stores its metrics as time series data å„ªé» recording any purely numeric time series support for multi-dimensional data collection and querying Prometheus server is standalone, not depending on network storage or other remote services ç¼ºé» ä¸é©åˆéœ€è¦ 100% accuracy çš„æœå‹™ åŠŸèƒ½ a multi-dimensionalÂ data modelÂ with time series data identified by metric name and key/value pairs PromQL, aÂ flexible query languageÂ to leverage this dimensionality no reliance on distributed storage; single server nodes are autonomous time series collection happens via a pull model over HTTP pushing time seriesÂ is supported via an intermediary gateway targets are discovered via service discovery or static configuration multiple modes of graphing and dashboarding support metrics ä»‹ç´¹ metrics are numeric measurements Metrics play an important role in understanding why your application is working in a certain way. æ”¯æ´å››ç¨® metrics types, é€™ç¯‡æœ‰æ›´è©³ç´°çš„ä»‹ç´¹ Counter - only increase or reset\nGauge - ä½¿ç”¨æƒ…å¢ƒå¦‚è¨ˆç®— number of pods in a cluster, number of events in an queue\nHistogram - ä½¿ç”¨æƒ…å¢ƒå¯ä»¥æ˜¯ä»»ä½•éœ€è¦è¨ˆç®—çš„å€¼ï¼Œå¦‚ API requests æ‰€èŠ±è²»çš„æ™‚é–“ï¼ŒHistogram æœƒå°‡æ•¸æ“šå­˜åœ¨ buckets ä¸­ï¼Œæœƒå…ˆå®šç¾© buckets - lower or equal 0.3 , le 0.5, le 0.7, le 1, and le 1.2ï¼Œæ¥è‘—è¨ˆç®—å®Œæ¯æ¬¡ request æ‰€èŠ±è²»çš„æ™‚é–“å¾Œå¯ä»¥å°‡å°æ‡‰åˆ° bucket çš„ count åŠ ä¸€ï¼Œå¦‚ä¸‹åœ–\nSummary - Histogram çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ç‚ºæ›´ä¾¿å®œï¼Œä½†ä»˜å‡ºçš„ä»£åƒ¹æ˜¯ lose more dataï¼ŒåŸç†æ˜¯è¨ˆç®— metrics çš„å±¤ç´šæ˜¯ application levelï¼Œæ‰€ä»¥ç•¶åŒä¸€å€‹ process æœ‰è«¸å¤š instances çš„è©±æœƒç„¡æ³•è¨ˆç®—\nComponents the mainÂ Prometheus serverÂ which scrapes and stores time series data client librariesÂ for instrumenting application code aÂ push gatewayÂ for supporting short-lived jobs special-purposeÂ exportersÂ for services like HAProxy, StatsD, Graphite, etc. anÂ alertmanagerÂ to handle alerts various support tools Grafana ä»‹ç´¹ Grafana Labs é–‹ç™¼çš„ open-source å°ˆæ¡ˆä¹‹ä¸€ï¼Œé‚„æœ‰å…¶ä»–å°ˆæ¡ˆï¼Œå¦‚ Grafana Loki (Like Prometheus, but for logs!), Grafana k6 (load testing tool)â€¦ query, visualize, alert on, and explore your metrics, logs, and traces wherever they are stored. åŠŸèƒ½ Explore metrics, logs, and traces ä»¥ RBAC ( Role-based access Control ) ä¾†æ±ºå®šèª°èƒ½å¤  explore é€™äº›æ•¸æ“š åˆ©ç”¨ä»¥ä¸‹åŠŸèƒ½ä¾†æŸ¥è©¢åˆ°æ›´å¤šæ•¸æ“šè¶¨å‹¢èˆ‡ç´°ç¯€ï¼Œç´°ç¯€åƒè€ƒé€™ç¯‡ query management in explore logs integration in explore trace integration in explore inspector in explore: ç›®çš„æ˜¯ troubleshoot ä½ çš„ queriesï¼Œå¯ä»¥å°‡æ•¸æ“šå°å‡ºè‡³ csv æª”æ¡ˆï¼Œlogs å°å‡ºè‡³ txt æª”æ¡ˆ Alerts åƒè€ƒé€™ç¯‡å»å»ºç«‹ alert rulesï¼ŒåŒ…å«è¨­å®š threshold, interval, duration ã€Œ ç¼ºå°‘æ•¸æ“šã€ä¹Ÿèƒ½è¢«è¨­å®š alert è¡Œç‚º Annotations Hover over events to see the full event metadata and tags. åƒè€ƒé€™ç¯‡å¯é€²è¡Œ Add annotation, Add region annotation, Edit annotation, Delete annotation, Built-in query, Query by tag ç­‰åŠŸèƒ½ Grafana provides many ways to authenticate users é è¨­æ˜¯æä¾› password authenticationï¼Œå…¶ä»–è©³ç´°è«‹çœ‹é€™ç¯‡ åƒè€ƒè³‡æ–™ ğŸ‘ what is elk stack Elasticsearch Service Documentation what-is-elasticsearch How Logstash Works | Logstash Reference [8.6] | Elastic elasticsearch introduction kibana introduction Overview | Prometheus Grafana documentation | Grafana documentation ğŸ€ è‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ\n","date":"2023-01-26T12:16:48+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%BA%94-logging-and-monitoring/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(äº”) Logging And Monitoring"},{"content":"Kafka æœ€å…ˆæ˜¯ç”± LinkedIn å‰µç«‹çš„ä¸€æ¬¾åˆ†æ•£å¼è¨Šæ¯ç³»çµ± (distributed messaging system)ï¼Œç”± Scala å’Œ Java ç·¨å¯«çš„ open-source å°ˆæ¡ˆ å‰è¨€ Prerequistites Publish/Subscribe Pattern ğŸ“Œ åŠŸèƒ½ é«˜æ•ˆèƒ½ã€å®¹éŒ¯ä¸”å…·å¯æ“´å±•æ€§çš„å¹³å°\nç”¨æ–¼å»ºç½®å³æ™‚ä¸²æµè³‡æ–™ç®¡é“ï¼Œä¸¦ä»¥ pub/sub pattern ä¾†ç®¡ç†ç”Ÿç”¢è€…èˆ‡æ¶ˆè²»è€…çš„è³‡æ–™\nKafka Connect æ˜¯ Apache Kafka çš„é–‹æ”¾åŸå§‹ç¢¼å…ƒä»¶ï¼Œæ˜¯ä¸€å€‹ç”¨æ–¼å°‡ Apache Kafka èˆ‡å¤–éƒ¨ç³»çµ± (å¦‚è³‡æ–™åº«ã€æ©Ÿç¢¼å€¼å­˜æ”¾å€ã€æœå°‹ç´¢å¼•å’Œæª”æ¡ˆç³»çµ±) é€£æ¥çš„æ¶æ§‹ã€‚ ä¸²æµè³‡æ–™æ˜¯ä¸€ç¨®å°å‹è¨˜éŒ„æˆ–äº‹ä»¶ (è¨˜éŒ„æˆ–äº‹ä»¶é€šå¸¸ç‚ºå¹¾ KB å¤§å°çš„è¨˜éŒ„) çš„æŒçºŒä¸²æµï¼Œé€™é¡çš„è¨˜éŒ„å‰‡ç”±æ•¸åƒå°æ©Ÿå™¨ã€è£ç½®ã€ç¶²ç«™å’Œæ‡‰ç”¨ç¨‹å¼æ‰€ç”¢ç”Ÿã€‚ä¸²æµè³‡æ–™åŒ…å«å„å¼å„æ¨£çš„è³‡æ–™ï¼Œä¾‹å¦‚å®¢æˆ¶ä½¿ç”¨æ‚¨çš„è¡Œå‹•æˆ– Web æ‡‰ç”¨ç¨‹å¼ç”¢ç”Ÿçš„æ—¥èªŒæª”ã€é›»å­å•†å‹™æ¡è³¼ã€éŠæˆ²ä¸­çš„ç©å®¶æ´»å‹•ã€ä¾†è‡ªç¤¾äº¤ç¶²è·¯ è³‡æ–™å–ç”¨çš„é †åºä»¥ FIFO (First In First Out) ä½œç‚ºåŸå‰‡\nğŸ’«æœ€é‡è¦çš„è§€å¿µğŸ’« å¦‚ä½•é”åˆ°é«˜æ•ˆèƒ½ã€å®¹éŒ¯ä¸”å¯æ“´å±•çš„å‘¢?\npartition Partition æ˜¯æœ€å°çš„å­˜å„²å–®å…ƒ ä¸€å€‹ Partition å…§éƒ¨æ¶ˆæ¯æœ‰åºï¼Œä¸€å€‹ Topic è·¨ Partition æ˜¯ç„¡åºçš„ã€‚ ä¸€å€‹ Kafka clusterç”±å¤šå€‹ Brokerï¼ˆå°±æ˜¯ Serverï¼‰ æ§‹æˆï¼Œæ¯å€‹ Broker ä¸­å«æœ‰ cluster çš„éƒ¨åˆ†æ•¸æ“šã€‚\nPartition åˆ†ä½ˆåœ¨å¤šå€‹ Broker çš„è©±ï¼ŒConsumer çš„å¤šå€‹å¯¦ä¾‹å°±å¯ä»¥é€£æ¥ä¸åŒçš„ Broker å¥½è™• Topic å°±å¯ä»¥æ°´å¹³æ“´å±• æ”¯æŒæ›´å¤šçš„ Consumer ä¸€å€‹ Consumer å¯¦ä¾‹è² è²¬ä¸€å€‹ Partition æ•¸æ“šå†—é¤˜\nä¸€å€‹ Partition ç”Ÿæˆå¤šå€‹å‰¯æœ¬ï¼Œä¸¦ä¸”æŠŠå®ƒå€‘åˆ†æ•£åœ¨ä¸åŒçš„ Brokerã€‚ å¦‚æœä¸€å€‹ Broker æ•…éšœäº†ï¼ŒConsumer å¯ä»¥åœ¨å…¶ä»– Broker ä¸Šæ‰¾åˆ° Partition çš„å‰¯æœ¬ï¼Œç¹¼çºŒç²å–æ¶ˆæ¯ã€‚ å¯«å…¥ Partition çš„æ–¹å¼\nçµ¦ Kafka æ±ºå®š è‹¥æ²’æœ‰ key å‰‡ kafka ä»¥ round robin æ–¹å¼å°‡è¨Šæ¯å¯«å…¥ partitionï¼Œä½†é€™æ¨£å°±ä¸ä¿è­‰é †åºæ€§äº†ï¼Œè‹¥éœ€è¦æœ‰é †åºæ€§ï¼Œè«‹åƒè€ƒä¸‹é¢ä¸€å€‹æ–¹å¼ ä½¿ç”¨ Partition Key å¯«å…¥ç‰¹å®š Partition kafka ä¿è­‰ä½¿ç”¨ç›¸åŒçš„ key æœƒå°‡è¨Šæ¯æ”¾åˆ°åŒä¸€å€‹ partitionï¼Œä¸¦ä¸”ä¿è­‰é †åºæ€§ ( in order ) èˆ‰ä¾‹ï¼Œå¦‚æœç›¸åŒå®¢æˆ¶çš„è³‡è¨Šæœ‰åºåœ°å–å¾—ï¼Œè¡¨ç¤ºéœ€è¦æ”¾åœ¨åŒä¸€å€‹ partitionï¼Œå¯ä»¥ä½¿ç”¨ customer id ä½œç‚º partition keyï¼Œé€™æ¨£åŒä¸€å€‹ customer çš„è³‡æ–™éƒ½æœƒæ”¾åˆ°åŒä¸€å€‹ partition è®€å– partition consumer group å¤šå€‹ consumer çµ„åˆæˆä¸€å€‹ consumer groupï¼Œç›®çš„æ˜¯ç‚ºäº†æ°´å¹³æ“´å±•(scale out) consumer æ±ºå®š consumer group è¦å¾å“ªè£¡é–‹å§‹è®€å–è³‡æ–™çš„é—œéµæ˜¯ consumer offsets offsets æœƒè¢«å­˜åœ¨ topic name ä¸­ å¦‚æœ consumer è®€å–è³‡æ–™å®Œç•¢ï¼Œå‰‡æœƒ commit offsets apache zookeeper an open-source server which enables highly reliable distributed coordination é€šéå†—é¤˜æœå‹™å¯¦ç¾é«˜å¯ç”¨æ€§ åƒè€ƒè³‡æ–™ ğŸ‘ Apache KafkaÂ® 101: Partitioning ç´°èªª Kafka Partition åˆ†å€ Apache Kafka vs Confluent: Comparing Features \u0026amp; Capabilities å…¨å—ç®¡ Apache Kafka - Amazon MSK å¸¸è¦‹å•ç­”é›† - Amazon Web Services ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!âœ¨\n","date":"2023-01-20T13:38:08+08:00","permalink":"https://yue-jenny.github.io/2023/01/kafka-%E7%B0%A1%E4%BB%8B/","title":"Kafka ç°¡ä»‹"},{"content":"Publish/Subscribe Pattern Publish/Subscribe Pattern (Pub/Sub) ç°¡ä»‹ ä¸€ç¨®åŒ…å« publisherã€subscriber èˆ‡ broker çš„è¨Šæ¯æ¨¡å‹ publisher - å°‡è¨Šæ¯å‚³é€è‡³ç‰¹å®š topic(ä¹Ÿå¯èƒ½è¢«ç¨±å‘¼ç‚º channels)ï¼Œä¸éœ€è¦æ“”å¿ƒèª°éœ€è¦æ”¶åˆ°é€™ç­†æ¶ˆæ¯ subscriber - è¨‚é–±ç‰¹å®š topic å¾Œï¼Œå°‡æœƒæ”¶åˆ°ä¾†è‡ªæ­¤ topic çš„è¨Šæ¯ broker - è² è²¬å°‡ topic çš„è¨Šæ¯è½‰ç™¼çµ¦ subscriber é€šå¸¸æœ‰ä»¥ä¸‹çš„ä¿è­‰ï¼Œå¦‚ã€Œè‡³å°‘å‚³é€ä¸€æ¬¡ã€ã€ã€ŒæŒä¹…åŒ–ã€ã€ã€Œè¨Šæ¯çš„é †åºæ€§ã€ã€ã€Œè¨Šæ¯å¯é‡é€å¤šæ¬¡ã€ è‹¥ç›¸åŒè¨Šæ¯å¯é‡é€å¤šæ¬¡ï¼Œä¸æœƒå½±éŸ¿çµæœå°±æ˜¯ç¬¦åˆå†ªç­‰æ€§(idempotent)ï¼Œéœ€è¦ consumer å¦å¤–å¯¦ä½œ æœ‰å“ªäº› Pub/Sub æœå‹™? é€™é‚Šèˆ‰å¹¾å€‹æœå‹™ï¼Œå¾ŒçºŒå†å¯«ä¸€ç¯‡è¼ƒè©³ç´°æ–‡ç« ä¾†æ¯”è¼ƒä¹‹é–“å·®ç•°\nRabbitMQ æœ€å»£æ³›ä½¿ç”¨çš„ message brokerï¼Œç‰¹è‰²æ˜¯è¼•é‡ç´šè¼•é¬†éƒ¨å±¬ï¼Œä½†ä¹Ÿæœ‰æ”¯æ´ distributed ä»¥ç¬¦åˆ high-scale èˆ‡ high-availability çš„è¦æ±‚ é»æˆ‘çœ‹æ›´å¤šğŸ‘€ Apache Kafka æœ€å…ˆæ˜¯ç”± LinkedIn å‰µç«‹çš„ä¸€æ¬¾åˆ†æ•£å¼è¨Šæ¯ç³»çµ± (distributed messaging system)ï¼Œç”± Scala å’Œ Java ç·¨å¯«çš„ open-source å°ˆæ¡ˆï¼Œé»æˆ‘çœ‹æ›´å¤šğŸ‘€ åŸæœ¬çš„ Kafka åœ˜éšŠæœ‰å‡ºé›²ç«¯å—è¨—ç®¡ç‰ˆæœ¬çš„ Kafka - Confluent Cloud (Cloud Native Apache KafkaÂ®)ï¼Œé»æˆ‘çœ‹æ›´å¤šğŸ‘€ å¦å¤–ï¼ŒAWS ä¹Ÿæœ‰æ˜¯å‡ºè‡ªå·±çš„é›²ç«¯ç‰ˆæœ¬çš„ Kafka - Amazon MSKï¼Œé»æˆ‘çœ‹æ›´å¤š Cloud Pub/Sub Google å‰µç«‹çš„é›²ç«¯ Pub/Sub æœå‹™ï¼Œå¯ç”¨æ–¼ä¸²æµæœå‹™ã€éåŒæ­¥å¾®æœå‹™æ•´åˆã€‚é»æˆ‘çœ‹æ›´å¤šğŸ‘€ åƒè€ƒè³‡æ–™ ğŸ‘ system expert wiki - Kafka publisher-subscriber pattern ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!âœ¨\n","date":"2023-01-18T20:13:18+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E5%9B%9B-publish/subscribe-pattern/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(å››) Publish/Subscribe Pattern"},{"content":"MapReduce å‰è¨€ MapReduce æ˜¯ä¸€å€‹ Google æå‡ºçš„è»Ÿé«”æ¶æ§‹ï¼Œé©ç”¨æ–¼å¤§è¦æ¨¡è³‡æ–™çš„ä¸¦åˆ—é‹ç®—\nPrerequistites File System è³‡æ–™çš„å„²å­˜ç³»çµ± æœ‰è¨±å¤šä¸åŒå‹æ…‹ï¼Œä¾‹å¦‚ä»¥å‚ç›´çµæ§‹ç‚ºä¸»çš„ç›®éŒ„èˆ‡è³‡æ–™å¤¾ã€Object storage ç­‰ Distributed File System åˆ†æ•£å¼æª”æ¡ˆç³»çµ±ï¼Œé€éä¸€å¤§ç¾¤æ©Ÿå™¨(cluster)äº’ç›¸åˆä½œï¼Œå°å¤–è¡¨ç¾å¦‚åŒä¸€å€‹å·¨å¤§çš„ file systemï¼Œå°‡ data åˆ‡æˆç‰¹å®šå¤§å°çš„ chunks (å¦‚ 4 MB æˆ– 64 MB)ï¼Œæœƒé€é central control plane æœƒæ±ºå®šæ‡‰è©²å°‡ chunks å­˜åœ¨å“ªä¸€å€‹ nodeï¼Œå¾ŒçºŒæ‡‰è©²å»å“ªä¸€å€‹ node è®€å– chunks ä¸»è¦æ“ä½œæ–¹å¼æ˜¯é€éç¶²è·¯ä»¥å®šç¾©å¥½çš„é€šè¨Šå”å®šé€²è¡Œè³‡æ–™å­˜å– ç›®å‰ç¾æœ‰çš„ç”¢å“æœ‰ Google File System (GFS)ã€Hadoop Distributed File System (HDFS) Hadoop æ”¯æŒ MapReduce èˆ‡è³‡æ–™ç®¡ç·šçš„ open-source æ¡†æ¶ï¼Œæœ€é‡è¦çš„ä¸­å¤®çµ„ä»¶ç‚º Hadoop Distributed File System (HDFS) å„éšæ®µç°¡ä»‹ Map éšæ®µ è² è²¬ filtering å’Œ sorting ä¸¦ä¸”çµ„åˆå‡ºä¸€å€‹ key value pair çµæœ Reduce éšæ®µ è² è²¬è³‡æ–™æ•´åˆ ä»¥ wordcount ç‚ºä¾‹ï¼Œå¾ Map å‚³éä¾†çš„ key è‹¥ä¸€æ¨£ï¼Œè¡¨ç¤ºåŒä¸€å€‹å­—ï¼Œå› æ­¤æŠŠä¸€æ¨£çš„ key åšåŠ ç¸½ï¼Œå¯ä»¥å¾—å‡ºæœ€å¾Œçš„å‡ºç¸½ç­†æ•¸ å†ªç­‰æ€§(idempotency)ç‰¹æ€§ æ„ç¾©: ç•¶æ“ä½œå¤šæ¬¡ï¼Œçµæœæ‡‰å‘ˆç¾ä¸€è‡´ é€é pub/sub messaging system æ‡‰ç•¶æœ‰å†ªç­‰æ€§ï¼Œå› ç‚º pub/sub ç³»çµ±æœ¬èº«å…è¨±ç›¸åŒè¨Šæ¯è¢« consumer æ¥æ”¶å¤šæ¬¡ èˆ‰ä¾‹ï¼Œå¢åŠ è³‡æ–™åº«æŸæ¬„ä½çš„ integer valueï¼Œå°±ä¸æ˜¯ä¸€å€‹å…·æœ‰å†ªç­‰æ€§çš„æ“ä½œï¼Œå› ç‚ºä¿æŒæ¯æ¬¡å¢åŠ çš„æ“ä½œå¾Œéƒ½ä¸æœƒä¿æŒè·Ÿå‰ä¸€å€‹ç›¸åŒçš„æ•¸å€¼ å¦ä¸€èˆ‰ä¾‹ï¼Œå°‡æ¬„ä½å€¼è¨­å®šç‚º \u0026ldquo;DONE\u0026rdquo;ï¼Œå¤šæ¬¡é‡è¤‡æ­¤æ“ä½œï¼Œé‚„æ˜¯æœƒé¡¯ç¤ºç‚º \u0026ldquo;DONE\u0026rdquo;ï¼Œå› æ­¤è¨­å®šç‚º \u0026ldquo;DONE\u0026rdquo; æ˜¯ä¸€å€‹å†ªç­‰æ€§æ“ä½œ ç¯„ä¾‹ input è¦åšè¨ˆç®—çš„åŸå§‹è³‡æ–™ï¼Œå¯ä»¥æ˜¯ä¸€å †æ–‡å­—æ¸…å–®ç­‰ split æŠŠ input è³‡æ–™åšåˆ†æ•£è™•ç† ä»¥ hadoop ä¾†èªªï¼Œç•¶ MapReduce å·¥ä½œè¢«è¼¸å…¥çš„æ™‚å€™ï¼Œæœƒè¢«åˆ‡å‰²åˆ°å„å€‹ cluster è£¡é¢ç­‰å¾…åšè™•ç† ğŸ””map MapReduce çš„ map éšæ®µ æ¯ä¸€å€‹ç¯€é»æœ‰è‡ªå·±çš„ä¸€ä»½è³‡æ–™è¦åˆ†æï¼ŒæœƒæŠŠå°æ‡‰åˆ‡å‰²å‡ºä¾†çš„è³‡æ–™å»ºç«‹ key value çš„çµæœ key æ˜¯å­—æœ¬èº«ï¼Œvalue æ˜¯ 1 ä»£è¡¨æ‰¾åˆ°ä¸€ç­† combine åœ¨ map çš„æ©Ÿå™¨é€²è¡Œä»¥ä¸‹å‹•ä½œ å°‡ä¸€æ¨£çš„ key å…ˆåšä¸€æ¬¡åŠ ç¸½ï¼Œé¿å…å‚³é€å¤šæ¬¡å‡ºå»ï¼Œä¾‹å¦‚ combine å¾Œçš„çµæœå¯èƒ½æ˜¯ \u0026ldquo;A\u0026rdquo; æœ‰ 2 ç­†ã€\u0026ldquo;B\u0026rdquo; æœ‰ 1 ç­†ç­‰ shuffle \u0026amp; sort åœ¨é€²å…¥ reduce éšæ®µä¹‹å‰ï¼Œæœƒå…ˆè¢«åšä¸€å€‹æ’åºï¼Œå› æ­¤ç›¸é—œçš„ key æœƒæ”¾åœ¨ä¸€èµ· æ¯”å¦‚ç¬¬ä¸€æ‰¹è³‡æ–™çš„ \u0026ldquo;A\u0026rdquo; æœ‰ 2 ç­†ã€ç¬¬äºŒæ‰¹è³‡æ–™çš„ \u0026ldquo;A\u0026rdquo; æœ‰ 5 ç­†\u0026hellip;ç¬¬ä¸€æ‰¹è³‡æ–™çš„ \u0026ldquo;B\u0026rdquo; æœ‰ 1 ç­†ã€ç¬¬äºŒæ‰¹è³‡æ–™çš„ \u0026ldquo;B\u0026rdquo; æœ‰ 3 ç­† ğŸ””reduce æ­¤éšæ®µæœƒåšå¯¦éš›çš„åŠ ç¸½ï¼Œå› æ­¤æ¯ä¸€å€‹ key çš„ value æœƒè¢«åŠ ç¸½ output æœ€å¾Œå¾—åˆ°çš„çµæœ åƒè€ƒè³‡æ–™ ğŸ‘ system expert wiki MapReduce introduction-to-mapreduce ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!âœ¨\n","date":"2023-01-18T10:32:40+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%B8%89-mapreduce/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(ä¸‰) MapReduce"},{"content":"Cache å¿«å– å‰è¨€ å¿«å–å°æ–¼ç³»çµ±å±¤é¢ä¸Šç›¸ç•¶é‡è¦ï¼Œç”¨çš„å¥½ã€ç”¨çš„å·§ï¼Œæœ‰åŠ©æ–¼æ•´é«”ç³»çµ±çš„é †æš¢åº¦ã€‚\nå› æ­¤ç›®æ¨™æ˜¯äº†è§£ğŸ‘‰ç‚ºä»€éº¼ä½¿ç”¨ã€ğŸ‘‰ä½¿ç”¨ç­–ç•¥èˆ‡ğŸ‘‰ä½•æ™‚ä½¿ç”¨ã€‚\nPrerequistites cache æ„æ€æ˜¯å°‡ä¸€éƒ¨åˆ†çš„è³‡æ–™å„²å­˜èµ·ä¾†ï¼Œéœ€è¦ä½¿ç”¨çš„æ™‚å€™ï¼Œä¸éœ€è¦ç¶“éå¾Œç«¯æˆ–è€…è³‡æ–™åº«å†æ‹¿ä¸€æ¬¡ï¼Œå„ªå‹¢æ˜¯å–å¾—è³‡æ–™è¼ƒå¿« é€šå¸¸ä½¿ç”¨çš„æƒ…å¢ƒæ˜¯å°‡å¸¸ç”¨ä¸”ä¸ç¶“å¸¸ä¿®æ”¹çš„ response å„²å­˜ï¼Œä¸å¿…æ¯æ¬¡éƒ½å»è·Ÿå¾Œç«¯èˆ‡è³‡æ–™åº«è«‹æ±‚ cache hit éœ€è¦çš„è³‡æ–™èƒ½åœ¨å¿«å–ä¸­æ‰¾åˆ° ğŸ‰ cache miss éœ€è¦çš„è³‡æ–™ç„¡æ³•åœ¨å¿«å–ä¸­æ‰¾åˆ° ğŸˆš content delivery network (CDN) ä¸€ç¨®ç¬¬ä¸‰æ–¹æœå‹™ï¼Œæ‰®æ¼”çš„è§’è‰²å°±åƒå¿«å–ï¼Œç‚ºä»€éº¼å‘¢ ? è«‹å¾€ä¸‹çœ‹ è¶Šä¾†è¶Šå¤šæœå‹™çš„æ“šé»æ•£å¸ƒå…¨çƒğŸŒï¼Œè‹¥ server åªæœ‰åœ¨å¹¾å€‹åœ‹å®¶ï¼Œå…¶ä»–åœ‹å®¶çš„ä½¿ç”¨è€…å¯èƒ½æœƒé‡åˆ°ç¶²é è½‰å¾ˆä¹…ç­‰å•é¡ŒâŒ›ï¼Œä¸­é–“ç¶²è·¯å‚³è¼¸è€—æ™‚å¤ªé•·å°è‡´ latency é•·ï¼Œæ­¤æ™‚è‹¥æœ‰æ•£å¸ƒå…¨çƒçš„ CDN serverï¼Œè«‹æ±‚å°±èƒ½å…ˆå‚³é€åˆ° CDN server è™•ç†ï¼Œç¸®çŸ­ latency èˆ‰ä¾‹ä¸€äº› CDN å» å•†ï¼Œå¦‚ Cloudflare èˆ‡ Google cloud CDN 3 å€‹ä½¿ç”¨å¿«å–çš„ç›®çš„ åˆ©ç”¨å‰ç«¯å¿«å–ï¼Œæ¸›å°‘è«‹æ±‚åˆ°å¾Œç«¯ æ¸›å°‘å°è³‡æ–™åº«çš„è«‹æ±‚ï¼Œé™ä½è³‡æ–™åº«å£“åŠ› é¿å… long compute operationï¼Œå¢åŠ ç³»çµ±é€Ÿåº¦ å¿«å–æ›´æ–°æ©Ÿåˆ¶ write through cache åŒæ™‚æ›´æ–°è³‡æ–™åº«èˆ‡å¿«å–çš„è³‡æ–™ write back cache å…ˆæ›´æ–°å¿«å–ï¼Œå†ä»¥éåŒæ­¥çš„æ–¹å¼æ›´æ–°è³‡æ–™åº«çš„è³‡æ–™ å¿«å–æ›¿æ›æ©Ÿåˆ¶ Cache eviction policy Least Recently Used (LRU) ä¾ç…§æœ€è¿‘ä½¿ç”¨æ™‚é–“ä¾†æ’åº æ€è·¯: æœ€è¿‘ä½¿ç”¨æ™‚é–“æœ€æ¥è¿‘ï¼Œè¡¨ç¤ºè¿‘æœŸå…§ä½¿ç”¨åˆ°çš„å¯èƒ½æ€§ä¹Ÿè¶Šé«˜ å„ªå…ˆæ›¿æ›æ‰æœ€è¿‘ä½¿ç”¨æ™‚é–“è·é›¢ç•¶ä¸‹æœ€é çš„é‚£çµ„æ•¸æ“š Least Frequently Used (LFU) ä¾ç…§ä½¿ç”¨é »ç‡ä¾†æ’åº æ€è·¯: ä½¿ç”¨æ¬¡æ•¸è¶Šé«˜â¬†ï¸ï¼Œè¡¨ç¤ºè¿‘æœŸå…§ä½¿ç”¨åˆ°çš„å¯èƒ½æ€§ä¹Ÿè¶Šé«˜â¬†ï¸ å„ªå…ˆæ›¿æ›æ‰ä½¿ç”¨æ¬¡æ•¸æœ€ä½çš„é‚£çµ„æ•¸æ“š First in First out (FIFO) é¡§åæ€ç¾©ï¼Œå…ˆé€²å…ˆå‡º æ€è·¯: æœ€å…ˆé€²å»å¿«å–çš„è³‡æ–™ï¼Œè¶Šæ—©æœƒè¢«æ·˜æ±° åƒè€ƒè³‡æ–™ ğŸ‘ System expert ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!âœ¨\n","date":"2023-01-17T11:04:46+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%BA%8C-cache/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(äºŒ) Cache"},{"content":"Security And HTTPS å‰è¨€ é™¤äº†äº†è§£å‰/å¾Œç«¯èªè¨€èˆ‡æ¡†æ¶å¦‚ä½•ä½¿ç”¨å¤–ï¼Œä¹Ÿå¸Œæœ›èƒ½å° Http/Https çš„åŸç†èˆ‡å®‰å…¨æ©Ÿåˆ¶æœ‰æ‰€äº†è§£ã€‚\nPrerequistites IP Packet\né€é IP å‚³é€çš„æœ€å°æ•¸æ“šçš„å–®ä½ï¼Œé€šå¸¸æœƒåŒ…å« IP Header èˆ‡ payload IP Header åŒ…å«ä¾†æºèˆ‡ç›®çš„åœ°çš„ IP Address payload å°±æ˜¯ä½ è¦å‚³é€çš„è³‡æ–™ Man-In-The-Middle Attack (åˆç¨±å‘¼ç‚º MITM)\næ„æ€æ˜¯æ””æˆª client èˆ‡ server é–“å‚³é€çš„è¨Šæ¯ ğŸ’¬ è‹¥ client èˆ‡ server é–“å‚³é€è¨Šæ¯æœ‰é€éåŠ å¯†èˆ‡ Https å¯é˜²æ­¢è³‡æ–™è¢«ç«Šå– Symmetric Encryption (å°ç¨±åŠ å¯†)\nåŠ å¯†èˆ‡è§£å¯†è³‡æ–™éƒ½ä½¿ç”¨åŒä¸€æŠŠ key ğŸ”‘ ç¼ºé»æ˜¯å®‰å…¨æ€§æœƒæœ‰æ‰€ç–‘æ…®ï¼Œkey é€šå¸¸æœƒè¢«åˆ†äº«åˆ°ä¸€å€‹é»æˆ–å¤šå€‹é» å„ªé»æ˜¯é€Ÿåº¦æ¯”éå°ç¨±åŠ å¯†å¿« ğŸ‡ æœ€å»£æ³›ä½¿ç”¨çš„æ¼”ç®—æ³•æ˜¯ Advanced Ecryption Standard(AES) Asymmetric Encryption (éå°ç¨±åŠ å¯†)\nåŠ å¯†èˆ‡è§£å¯†è³‡æ–™æœƒåˆ©ç”¨åˆ°å…©æŠŠ key ğŸ”‘ğŸ”‘ï¼Œåˆ†åˆ¥ç‚º public key èˆ‡ private key public key è² è²¬åŠ å¯†è³‡æ–™ï¼Œåªèƒ½åˆ©ç”¨ç›¸å°æ‡‰çš„ private key è§£å¯†è³‡æ–™ æ‰€ä»¥ public key åˆ†äº«çµ¦éœ€è¦åŠ å¯†è³‡æ–™çš„ä¸€ç«¯ï¼Œè€Œ private key å‰‡éœ€è¦ å®‰å…¨åœ°ä¿å­˜ ãŠ™ï¸ é€Ÿåº¦æœƒæ¯”å°ç¨±åŠ å¯†æ…¢ ğŸ¢ Advanced Ecryption Standard(AES)\næœ€å»£æ³›ä½¿ç”¨çš„åŠ å¯†æ¨™æº– ä¸‰ç¨®å°ç¨±æ¼”ç®—æ³•åˆ†åˆ¥ç‚º AES-128ã€AES-192ã€AES-256 Transport Layer Security (TLS)\nåœ¨å‚³è¼¸å±¤çš„ä¸€ç¨®å”å®šï¼Œç›®çš„æ˜¯ç‚ºäº†ç¶²è·¯é€šè¨Šæ™‚çš„å®‰å…¨ï¼Œç¢ºä¿æ²’æœ‰ç¬¬ä¸‰æ–¹èƒ½ç«Šè½æˆ–è€…ç«Šå–ä»»ä½•è³‡è¨Š è¡ç”Ÿæ–¼å¦ä¸€ç¨®å®‰å…¨å”å®š Secure Socket Layer (SSL) SSL certificate\nç”± certificate authority (CA) é ’ç™¼çµ¦ server çš„æ•¸ä½æ†‘è­‰ å…§å®¹åŒ…å« server ç«¯çš„ public keyï¼Œå› ç‚ºåœ¨ TLS Handshake éç¨‹ä¸­æœƒä½¿ç”¨åˆ° ç›®çš„æ˜¯ç¢ºèª Http vs Https Http å…¨åç‚º HyperText Transfer Protocol ä¸€ç¨®å¸¸è¦‹çš„ç¶²è·¯é€šè¨Šå”è­° æµç¨‹æ˜¯ client é€å‡º http requestï¼Œè€Œ server é€å‡ºå›æ‡‰ Https å…¨åç‚º HyperText Transfer Protocol Secure é¡§åæ€ç¾©æ˜¯ç‚ºäº†å¯æ–¼ç¶²è·¯ä¸ŠğŸ”å®‰å…¨åœ°é€šè¨Šè€Œå‡ºç¾çš„ä¸€ç¨®ç¶²è·¯é€šè¨Šå”è­° ç‚ºäº†é”åˆ°ä¸Šè¿°è¦æ±‚ï¼Œå› æ­¤ server è¢«è¦æ±‚é ˆå…·å‚™ä»¥ä¸‹å…©é … é ˆç²å¾—å¯ä¿¡ä»»çš„æ†‘è­‰(SSL certificates) ä½¿ç”¨ Transport Layer Security (TLS) åŠ å¯† client èˆ‡ server ç«¯çš„æ•¸æ“šã€‚TLS å¦‚ä½•é‹ä½œï¼Œè«‹å¾€ä¸‹çœ‹ã€‚ TLS é€£æ¥æ˜¯é€é TLS Handshake ä¾†å•Ÿå‹• æµç¨‹ client é€å‡º client hello (éš¨æ©Ÿçš„ bytes) çµ¦ server server å›æ‡‰ server hello (ä¹Ÿæ˜¯éš¨æ©Ÿçš„ bytes) ä»¥åŠ SSL certificate client é©—è­‰ CA é ’ç™¼çš„æ†‘è­‰ï¼Œç¢ºèªæ†‘è­‰æ­£ç¢ºå±¬æ–¼æ­¤ server æ“æœ‰ client æ¥è‘—æœƒé€å‡ºä¸€çµ„ç”¨ public key åŠ å¯†çš„ premaster secret çµ¦ server client å’Œ server å°‡æœƒä½¿ç”¨ client hello, server helloèˆ‡ premaster secret ç”¢ç”Ÿå°ç¨±åŠ å¯†çš„ session keysï¼Œç”¨æ–¼å¾ŒçºŒçš„é€šè¨Šå…§å®¹çš„åŠ å¯†èˆ‡è§£å¯† ğŸ” TCP åˆ©ç”¨ Handshake æ–¹å¼ä¾†é€£æ¥èˆ‡æ–·é€£ TCP ä¸‰æ¬¡æ¡æ‰‹(å»ºç«‹é€£ç·š) æµç¨‹\nç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼š å®¢æˆ¶ç«¯å‚³é€è«‹æ±‚ SYN å ±æ–‡çµ¦æœå‹™ç«¯ï¼Œå‚³é€å®Œç•¢ä¹‹å¾Œï¼Œå®¢æˆ¶ç«¯è™•æ–¼ SYN_Send ç‹€æ…‹ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š æœå‹™ç«¯æ”¶åˆ°è«‹æ±‚å ±æ–‡ä¹‹å¾Œï¼Œå¦‚æœåŒæ„é€£ç·šï¼Œæœƒå›å‚³ SYN + ACK æ‡‰ç­”å ±æ–‡ï¼Œæœå‹™ç«¯ç‚ºSYN_Receiveç‹€æ…‹ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼š å®¢æˆ¶ç«¯æ¥æ”¶åˆ°æœå‹™ç«¯çš„ SYN + ACK ï¼Œç„¶å¾Œå‚³é€ç¢ºèªå ±æ–‡ä½œç‚ºæ‡‰ç­”ï¼Œå®¢æˆ¶ç«¯è½‰ç‚ºEstablishedç‹€æ…‹ ç‚ºä»€éº¼ä¸€å®šè¦ä¸‰æ¬¡?\nç‚ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„é€£æ¥è«‹æ±‚å ±æ–‡æ®µçªç„¶åˆå‚³é€åˆ°äº†æœå‹™ç«¯ï¼Œå› è€Œç”¢ç”ŸéŒ¯èª¤ TCP å››æ¬¡æ¡æ‰‹(çµæŸé€£ç·š) æµç¨‹ ç¬¬ä¸€æ¬¡åˆ†æ‰‹ å®¢æˆ¶ç«¯å‚³é€FIN=1å‘Šè¨´æœå‹™ç«¯ï¼Œå®¢æˆ¶ç«¯æ‰€æœ‰çš„è³‡æ–™å…¨éƒ¨ç™¼é€å®Œç•¢ï¼Œæœå‹™ç«¯å¯ä»¥é—œé–‰æ¥æ”¶äº†ã€‚ ç¬¬äºŒæ¬¡åˆ†æ‰‹ æœå‹™ç«¯æ¥æ”¶åˆ°å®¢æˆ¶ç«¯çš„é‡‹æ”¾è«‹æ±‚é€£ç·šä¹‹å¾Œï¼ŒçŸ¥é“å®¢æˆ¶ç«¯æ²’æœ‰è³‡æ–™å‚³é€çµ¦è‡ªå·±äº†ï¼Œç„¶å¾Œæœå‹™ç«¯å‚³é€ACK=1å‘Šè¨´å®¢æˆ¶ç«¯æ¥æ”¶åˆ°ä½ ç™¼çµ¦æˆ‘çš„è¨Šæ¯ ç¬¬ä¸‰æ¬¡åˆ†æ‰‹ å‘Šè¨´å®¢æˆ¶ç«¯ï¼Œæœå‹™ç«¯çš„æ‰€æœ‰è³‡æ–™å‚³é€å®Œç•¢ï¼Œå®¢æˆ¶ç«¯ä½ ä¹Ÿå¯ä»¥é—œé–‰æ¥æ”¶è³‡æ–™é€£ç·šäº†ã€‚ ç¬¬å››æ¬¡åˆ†æ‰‹ å®¢æˆ¶ç«¯æ¥æ”¶åˆ°äº†æœå‹™ç«¯å‚³é€å®Œç•¢çš„è¨Šæ¯ä¹‹å¾Œï¼Œå°±å‚³é€ACK=1ï¼Œå‘Šè¨´æœå‹™ç«¯ï¼Œå®¢æˆ¶ç«¯å·²ç¶“æ¥æ”¶åˆ°ä½ çš„è¨Šæ¯ åƒè€ƒè³‡æ–™ ğŸ‘ System expert what-happens-in-a-tls-handshake ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å¹«æˆ‘æ‹æ‹æ‰‹ğŸ‘ï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!âœ¨\n","date":"2023-01-16T12:35:00+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E5%9F%BA%E7%A4%8E%E7%AD%86%E8%A8%98%E4%B8%80-security-and-https/","title":"ç³»çµ±è¨­è¨ˆåŸºç¤ç­†è¨˜(ä¸€) Security And HTTPS"},{"content":"å¦‚ä½•è¨­è¨ˆèˆ‡å¯¦ä½œ Monorepo çš„ Github Workflow? å‰è¨€ æœ‰é‘‘æ–¼è¶Šä¾†è¶Šå¤šäººä½¿ç”¨ monorepoï¼Œæƒ³ç ”ç©¶ä¸€ä¸‹ï¼Œç•¶åªæœ‰é‡å°æŸå€‹ project æœ‰ç¨‹å¼ç¢¼çš„ç•°å‹•æ™‚ï¼Œå¦‚ä½•å¯¦è¸ CI/CD\nä»€éº¼æ˜¯ monorepo? é¡§åæ€ç¾©ï¼Œmono è¡¨ç¤ºä¸€å€‹ï¼Œrepo è¡¨ç¤º repositoryï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹ repository åŒ…å«å¤šå€‹ projectsï¼Œä¸¦ä¸”æ¸…æ¥šå®šç¾©å®ƒå€‘ä¹‹é–“çš„é—œä¿‚ ä¾‹å¦‚å‰å¾Œç«¯é–‹ç™¼ï¼Œå°‡å‰å¾Œç«¯çš„ç¨‹å¼éƒ½æ”¾åœ¨åŒä¸€å€‹ repositoryï¼Œå°±æ˜¯ monorepo çµæ§‹å¤§è‡´ä¸Šæœƒå‘ˆç¾å¦‚ä¸‹åœ–ï¼Œé€™æ¬¡èˆ‰ä¾‹æœ‰å…©å€‹ app åœ¨åŒä¸€å€‹ repository ä¸­ æƒ³çŸ¥é“å¿…ç”¨çš„åŸå› ã€å¥½è™•æˆ–æ¡å‘ç´€éŒ„ï¼Œå¯å…ˆåƒè€ƒ ğŸ‘‡ what-is-a-monorepo monorepo ä¹‹æˆ‘è¦‹ å¦‚ä½•è¨­è¨ˆ Github workflow? åƒè€ƒCreating separate monorepo CI/CD pipelines with GitHub Actionsï¼Œ\nä»¥ project ä¾†å€åˆ† workflows æª”æ¡ˆï¼Œæœ‰ db.yamlã€gateway.yaml ä»¥åŠworker.yamlï¼Œå¦‚ä¸‹åœ–\nç•¶ gateway application æœ‰ç¨‹å¼ç¢¼ç•°å‹•ï¼Œåªèƒ½åŸ·è¡Œ gateway.yamlï¼Œæ¸¬è©¦æˆ– build gateway image ç­‰\nå¯¦ä½œ Github Workflow YAML æª”æ¡ˆä¸­æ˜¯ä»¥ on å®šç¾©ï¼Œå“ªäº› events å¯ä»¥å» trigger ä¸€å€‹ workflowï¼Œå› æ­¤æˆ‘å€‘éœ€è¦åœ¨é€™é‚Šå‹•ä¸€äº›æ‰‹è…³ï¼Œè®“ä»–åªæœ‰åœ¨ç•°å‹•ç‰¹å®š application æ™‚æ‰æœƒåŸ·è¡Œ workflow\nåˆ©ç”¨ workflow syntax paths æŒ‡å®šç¯„åœï¼Œç•¶ pet app åº•ä¸‹çš„æª”æ¡ˆæœ‰ç•°å‹•ï¼ŒåŸ·è¡Œé€™å€‹ workflow\npaths: - \u0026#39;apps/pet/**\u0026#39; å¦‚æœæƒ³è¦å†åŠ å…¥æŒ‡å®šç’°å¢ƒå‘¢?æ¯”å¦‚æŒ‡å®š stage æˆ– mainï¼Œå¯ä»¥åˆ©ç”¨ branches çš„ workflow syntax\nbranches: [\u0026#39;stage\u0026#39;] çµåˆä»¥ä¸Šï¼Œæ•´å€‹çœ‹èµ·ä¾†æ‡‰è©²æœƒåƒé€™æ¨£ï¼ŒæŒ‡å®šåœ¨ stage çš„ pet app æœ‰ç¨‹å¼ç¢¼è®ŠåŒ–æ™‚ï¼ŒåŸ·è¡Œé€™å€‹ workflow\non: push: branches: [\u0026#39;stage\u0026#39;] paths: - \u0026#39;apps/pet/**\u0026#39; é‚£å¦‚æœæ˜¯ç”¨ pull request å‘¢?\non: push: branches: [\u0026#39;stage\u0026#39;] paths: - \u0026#39;apps/pet/**\u0026#39; pull_request: branches: [\u0026#39;stage\u0026#39;] æˆ‘å¦‚ä½•è¨­è¨ˆ? æ ¹æ“šå…©ç¨®ç’°å¢ƒ stage èˆ‡ mainï¼Œä»¥åŠå…©ç¨® appï¼Œç¸½å…±æœƒæœ‰ 4 çµ„ workflow yaml æª”æ¡ˆ stage-app1.yml stage-app2.yml main-app1.yml main-app1.yml æ³¨æ„äº‹é … â— \u0026ldquo;You must store workflow files in the .github/workflows directory of your repository.\u0026rdquo; Github Workflow åªæ”¯æ´ç¬¬ä¸€å±¤çš„ workflow yaml æª”æ¡ˆ ä¹Ÿå°±æ˜¯ï¼Œä»¥ä¸‹åœ–çš„çµæ§‹ä¾†æ”¾ workflow æª”æ¡ˆï¼ŒGithub æ˜¯ä¸æœƒåŸ·è¡Œçš„ä»»ä½• workflow çš„ å®˜æ–¹æ–‡ä»¶èªªæ˜ å¿ƒå¾— ç¶“éé€™æ¬¡ï¼Œé™¤äº†äº†è§£ monorepo å¤–ï¼Œå°æ–¼ Github Actions çš„ Workflow syntax æ›´å¤šçš„èªè­˜ã€‚\nåƒè€ƒè³‡æ–™ ğŸ‘ Creating separate monorepo CI/CD pipelines with GitHub Actions what-is-a-monorepo monorepo ä¹‹æˆ‘è¦‹ æ›´å¤š workflow syntax ä»‹ç´¹ ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-12T14:56:21+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/","title":"å¦‚ä½•è¨­è¨ˆèˆ‡å¯¦ä½œ Monorepo çš„ Github Workflow?"},{"content":"åœ¨ Argo CD ä¸­ä½¿ç”¨ Github App Credential ä½œç‚ºé©—è­‰æ–¹å¼ å‰è¨€ åœ¨å…ˆå‰æ–‡ç« ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD ä»¥åŠåœ¨ Argo CD å…§å»ºç«‹ App åµæ¸¬ repository ç‹€æ…‹ æœ‰æåˆ° private repository é©—è­‰çš„æ–¹å¼æœ‰ SSHã€Https ä»¥åŠ Github App Credential\næ­¤æ–‡ç« ä¾†ç­†è¨˜ä¸‹ï¼Œå¦‚ä½•åœ¨ Argo CD ä¸­ä½¿ç”¨ Github App Credential ä½œç‚ºé©—è­‰æ–¹å¼\nå¯¦ä½œ å»ºç«‹ Github App\næ­¥é©Ÿå¯åƒè€ƒ ğŸ‘‰ å®˜æ–¹æ–‡ä»¶\nå…¶ä¸­ï¼Œç‰¹åˆ¥éœ€è¦è¨­å®šçš„å€¼\nGithub App Name: ç‚ºä½ çš„ Github App å–åç¨±\nHomepage URL: ä½ çš„ web app URL\næˆ‘çš„ argo cd æ˜¯ä»¥ docker desktop å•Ÿå‹•ï¼Œä¸¦åˆ©ç”¨ port forward æ–¹å¼ï¼Œè®“æœ¬åœ°åˆ©ç”¨ localhost å¯é€£ç·š dashboardï¼Œå¯åƒè€ƒæˆ‘çš„æ–‡ç« ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD Callback URL: ç•¶ github èªè­‰å®Œç•¢å¾Œï¼Œè¦ redirect å›å»çš„ URL\nå»ºç«‹å®Œæˆ Github App å¾Œï¼Œé‚„æœ‰å…©ä»¶äº‹æƒ…è¦åšï¼ŒArgo CD è¨­å®šé€£ç·šæ™‚æœƒç”¨åˆ°\næŸ¥çœ‹ Github App Installation ID\nçœ‹ URL https://github.com/settings/installations/{Your Github App Installation ID}, å¯ç¢ºèª Github App Installation ID\nå»ºç«‹ private key\nåˆ° Settings / Developer settings / Github Apps / {your-github-app-name} çš„ General\nå°‡é é¢å¾€ä¸‹æ‹‰å¯ä»¥çœ‹è¦‹ Private keysï¼Œé» Generate a private key å»ºç«‹ä¸€çµ„ private key\nåˆ° Argo CD çš„ Repositories è¨­å®šé€£ç·šè³‡è¨Š\nå¦‚ä½•åˆ°é€™é ä¾†è¨­å®šï¼Œå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶\né€™é‚Šè¦å¡«å¯«èˆ‡è¨­å®šçš„è³‡è¨Šåˆ†æˆå…©éƒ¨åˆ†\nå…ˆé¸åˆ° VIA GITHUB APP\nä¾ç…§ä¸Šé¢çš„è¨Šæ¯å®Œæˆå¡«å¯«æ¡† 2çš„å…§å®¹\né» CONNECTï¼Œå®Œæˆ\né€£ç·šæˆåŠŸ\nå»ºç«‹ä¸€çµ„ NEW APP\nå¿ƒå¾— çœ‹åˆ°å®˜æ–¹æä¾›é©—è­‰ private repository çš„æ–¹å¼æœ‰ Github App Credentialï¼Œè®“æˆ‘ç›¸ç•¶å¥½å¥‡ï¼Œæ–¼æ˜¯å°±æœ‰äº†é€™ç¯‡æ–‡ç« ã€‚\nå¾ŒçºŒå†å¯«ä¸€ç¯‡æ–‡ç« ä¾†è¨˜éŒ„ Github App èˆ‡ OAuth Appå·®ç•°ã€‚\nåƒè€ƒè³‡æ–™ ğŸ‘ about-apps github-app-credential ğŸ€ ã€Œè¨˜éŒ„ã€æ˜¯ç‚ºäº†æœ‰æ„è­˜åœ°ã€æœ‰æ¢ç†åœ°çµ±æ•´æ‰€å­¸çš„å­¸ç¿’çŸ¥è­˜ã€‚\nğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-10T16:05:56+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E5%9C%A8-argo-cd-%E4%B8%AD%E4%BD%BF%E7%94%A8-github-app-credential-%E4%BD%9C%E7%82%BA%E9%A9%97%E8%AD%89%E6%96%B9%E5%BC%8F/","title":"åœ¨ Argo CD ä¸­ä½¿ç”¨ Github App Credential ä½œç‚ºé©—è­‰æ–¹å¼"},{"content":"Github çš„ OAuth App å¦‚ä½•å»ºç«‹ OAuth App? è«‹åƒè€ƒ Creating an OAuth App - GitHub Docs Authorizing OAuth Apps Authorization flow çš„åˆ†é¡ web application flow\nUsed to authorize users for standard OAuth apps that run in the browser. (TheÂ implicit grant typeÂ is not supported.) device flow\nUsed for headless apps, such as CLI tools. Web application flow ç°¡å–® 3 æ­¥é©Ÿå¯å®Œæˆ ğŸ‘Œ Users are redirected to request their GitHub identity\nUsers are redirected back to your site by GitHub\nYour app accesses the API with the user\u0026rsquo;s access token\nè®“æˆ‘å€‘ä¾†è©³ç´°èªªèªªå§! Request a user\u0026rsquo;s GitHub identity\nåˆ©ç”¨ redirect æ–¹å¼å–å¾—ä½¿ç”¨è€…çš„ GitHub identityï¼Œæ­¤æ™‚ç€è¦½å™¨æœƒè·³å‡ºç™»å…¥é é¢è®“ä½¿ç”¨è€…ç™»å…¥ï¼Œéœ€è¼¸å…¥å¸³å¯†\nğŸ“ŒRequest æ–¹å¼å¦‚ä¸‹\nRequired parameters client_id GET https://github.com/login/oauth/authorize Users are redirected back to your site by GitHubï¼Œæ¥è‘—è«‹æ±‚ access token\næ­¥é©Ÿä¸€è‹¥æˆåŠŸå®Œæˆé©—è­‰ï¼Œå‰‡é é¢æœƒè¢«è¿”å›è‡³ Appï¼Œæ¥è‘—è¦é€²è¡Œè«‹æ±‚ access token ğŸ“ŒRequest æ–¹å¼å¦‚ä¸‹ Required parameters client_id client_secret codeï¼Œå°±æ˜¯æ­¥é©Ÿä¸€æ‰€å¸¶çš„ state æ¬„ä½å€¼ POST https://github.com/login/oauth/access_token ğŸ“ŒResponse\næˆåŠŸçš„è©±ï¼Œä½ æœƒå–å¾—ä¸€çµ„ access token Accept: application/json { \u0026#34;access_token\u0026#34;:\u0026#34;gho_16C7e42F292c6912E7710c838347Ae178B4a\u0026#34;, \u0026#34;scope\u0026#34;:\u0026#34;repo,gist\u0026#34;, \u0026#34;token_type\u0026#34;:\u0026#34;bearer\u0026#34; } Use the access token to access the API\nåˆ©ç”¨æ­¥é©ŸäºŒçš„ access token å» access API ğŸ“Œé€™é‚Šæä¾›å…©å€‹ access API çš„ request æ–¹å¼ # æ–¹å¼ä¸€ Authorization: Bearer OAUTH-TOKEN GET https://api.github.com/user # æ–¹å¼äºŒ curl -H \u0026#34;Authorization: Bearer OAUTH-TOKEN\u0026#34; https://api.github.com/user Device flow ç›®çš„: authorize users for a headless app, such as a CLI tool or Git credential manager. ç°¡å–® 3 æ­¥é©Ÿå¯å®Œæˆ ğŸ‘Œ Your app requests device and user verification codes and gets the authorization URL where the user will enter the user verification code.\nThe app prompts the user to enter a user verification code atÂ https://github.com/login/device.\nThe app polls for the user authentication status. Once the user has authorized the device, the app will be able to make API calls with a new access token.\nè®“æˆ‘å€‘ä¾†è©³ç´°èªªèªªå§! Step 1: App requests the device and user verification codes from GitHub\nğŸ“ŒRequest\nRequired parameters client_id POST https://github.com/login/device/code ğŸ“ŒResponse\nâš ï¸è¨˜ä¸‹ä¾† user code \u0026amp; verification uriï¼Œæ­¥é©ŸäºŒé©—è­‰æ™‚æœƒä½¿ç”¨åˆ° âš ï¸è¨˜ä¸‹ä¾† device codeï¼Œæ­¥é©Ÿä¸‰é©—è­‰æ™‚æœƒä½¿ç”¨åˆ° interval æ„ç¾©æ˜¯ minimum polling intervalï¼Œå–®ä½ç‚ºç§’ã€‚ æ­¥é©Ÿä¸‰ app æœƒå» github poll (è¼ªè©¢) user æ˜¯å¦å·²é©—è­‰å®Œæˆæ­¤ device interval å³æŒ‡ poll çš„æœ€å°æ™‚é–“é–“éš”ã€‚ è‹¥åœ¨ interval å…§è«‹æ±‚è¶…é 1 æ¬¡ï¼Œå‰‡æœƒåˆ°é” rate limitï¼Œæœƒå¾—åˆ°ä¸€äº› error responseï¼Œæ›´è©³ç´°è«‹çœ‹ ğŸ‘‰ rate limits Accept: application/json { \u0026#34;device_code\u0026#34;: \u0026#34;3584d83530557fdd1f46af8289938c8ef79f9dc5\u0026#34;, \u0026#34;user_code\u0026#34;: \u0026#34;WDJB-MJHT\u0026#34;, \u0026#34;verification_uri\u0026#34;: \u0026#34;https://github.com/login/device\u0026#34;, \u0026#34;expires_in\u0026#34;: 900, \u0026#34;interval\u0026#34;: 5 } Step 2: Prompt the user to enter the user code in a browser\nğŸ“Œåˆ©ç”¨æ­¥é©Ÿä¸€å¾—åˆ° user code \u0026amp; verification uri (é€šå¸¸å°±æ˜¯ https://github.com/login/device ) ğŸ“Œåˆ° https://github.com/login/device è¼¸å…¥ user code Step 3: App polls GitHub to check if the user authorized the device\nğŸ“ŒRequest\nRequired parameters æ­¥é©Ÿä¸€å¾—åˆ°çš„ device code client id æŒ‡å®šçš„ grant type âš ï¸æ³¨æ„: ç™¼é€è¼ªè©¢è«‹æ±‚ï¼Œè«‹æ±‚é–“éš”å¿…é ˆå¤§æ–¼æœ€å°è¼ªè©¢æ™‚é–“é–“éš”ï¼Œå¦å‰‡æœƒå¾—åˆ° error responseï¼Œæ›´è©³ç´°è«‹çœ‹ ğŸ‘‰ rate limits POST https://github.com/login/oauth/access_token ğŸ“ŒResponse\næˆåŠŸå–å¾— access token Accept: application/json { \u0026#34;access_token\u0026#34;: \u0026#34;gho_16C7e42F292c6912E7710c838347Ae178B4a\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;scope\u0026#34;: \u0026#34;repo,gist\u0026#34; } Rate limits âš ï¸ç•¶é”åˆ° rate limitsï¼Œæœƒå¾—åˆ° slow_down çš„ error response ğŸ“Œæ›´å¤š error response è«‹åƒè€ƒå®˜æ–¹æ–‡ä»¶ ğŸ“… çºŒé›†(äºŒ)æœƒä»‹ç´¹ Non-Web application flowã€Creating multiple tokens for OAuth Apps ä»¥åŠ Directing users to review their access åƒè€ƒè³‡æ–™ ğŸ‘ OAuth Apps - GitHub Docs error-codes-for-the-device-flow web-application-flow - GitHub Docs Device flow - GitHub Docs Creating an OAuth App - GitHub Docs ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-07T18:10:13+08:00","permalink":"https://yue-jenny.github.io/2023/01/github-%E7%9A%84-oauth-app-%E4%BB%8B%E7%B4%B9-%E4%B8%80/","title":"Github çš„ Oauth App ä»‹ç´¹ (ä¸€)"},{"content":"å¦‚ä½•åœ¨ Hugo ä¸­åŠ å…¥è©•è«–ç³»çµ± Gitalk å‰è¨€ ç‚ºäº†åœ¨éƒ¨è½æ ¼å¢åŠ äº’å‹•ç³»çµ±ï¼Œé¸æ“‡ä»¥ gitalk ä½œç‚º comment ç³»çµ±\nå¯¦ä½œ å»ºç«‹ Github OAuth App ä¸¦å–å¾— client id \u0026amp; client secret (å¾ˆé‡è¦ï¼Œå¾ŒçºŒæœƒç”¨åˆ°)\nä½œæ³•å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ å°‡è³‡è¨Šå¡«å…¥ themes\\hugo-theme-stack\\config.yaml\nclientID: æ­¥é©Ÿä¸€å–å¾—çš„ client id clientSecret: æ­¥é©Ÿä¸€å–å¾—çš„ client secret gitalk: owner: yue-jenny -\u0026gt; ä½ çš„ account name admin: yue-jenny -\u0026gt; ä½ çš„ account name repo: yue-jenny.github.io -\u0026gt; ä½ çš„ repo name clientID: 123 -\u0026gt; æ­¥é©Ÿä¸€å–å¾—çš„ client id clientSecret: 456 -\u0026gt; æ­¥é©Ÿä¸€å–å¾—çš„ client secret ä¸Šè¿°æ­¥é©Ÿå®Œæˆå¾Œï¼Œéœ€è¦ admin (é€šå¸¸å°±æ˜¯ä½œè€…) å…ˆ initial commentã€‚\ninitial å®Œæˆå¾Œï¼Œé é¢æœƒé€™æ¨£å‘ˆç¾ã€‚\nfinish-initial-comment åˆ° Github å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ç¯‡æ–‡ç« éƒ½æœƒé–‹ä¸€å€‹ issue ç´€éŒ„ï¼Œå°±åƒé€™æ¨£ã€‚å¦‚æœæœ‰ç•™è¨€ï¼Œæœƒåœ¨ issue å…§å¤šä¸€å€‹å›æ‡‰ã€‚\ngithub-issue-with-comment é—œæ–¼ Github Oauth App æƒ³çŸ¥é“æ›´å¤šï¼Œå¯åƒè€ƒ ğŸ‘‰ é€™ç¯‡æ–‡ç« Github çš„ Oauth App ä»‹ç´¹ (ä¸€) åƒè€ƒè³‡æ–™ ğŸ‘ creating-an-oauth-app ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-06T18:10:13+08:00","permalink":"https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E5%9C%A8-hugo-%E4%B8%AD%E5%8A%A0%E5%85%A5%E8%A9%95%E8%AB%96%E7%B3%BB%E7%B5%B1-gitalk/","title":"å¦‚ä½•åœ¨ Hugo ä¸­åŠ å…¥è©•è«–ç³»çµ± Gitalk"},{"content":"Argo CD æ˜¯ä»€éº¼? å‰è¨€ é€™éƒ¨åˆ†æœƒåˆ†äº« Argo CD çš„ä¸­å¿ƒæ€æƒ³ã€æ¶æ§‹èˆ‡åŠŸèƒ½ã€‚\nArgo CD çŸ¥è­˜é‡å¾ˆé¾å¤§ï¼Œé™„ä¸Šå…¶ä»–åƒè€ƒè³‡æ–™çµ¦æœ‰èˆˆè¶£çš„äººåƒè€ƒ\ngetting started guide user oriented documentation Developer oriented documentation the upgrade guide How it works? ğŸ”© GitOps pattern Argo CD follows the GitOps pattern of using Git repositories as the source of truth for defining the desired application state.\nArgo CD éµå¾ª GitOps æ¨¡å¼ï¼Œå³ä»¥ Git repositories ä½œç‚ºå”¯ä¸€è­˜åˆ¥ application ç‹€æ…‹çš„ä¾†æº kubernetes controller Argo CD ä½œç‚º kubernetes controllerï¼ŒæŒçºŒåµæ¸¬é‹è¡Œä¸­çš„ applicationï¼Œä¸¦æ¯”è¼ƒç¾åœ¨ç‹€æ…‹èˆ‡ç›®æ¨™ç‹€æ…‹\nArgo CD çš„ kubernetes manifest å¯ç”¨ä»¥ä¸‹å¹¾ç¨®æ–¹å¼å»ºç«‹:\nkustomize applications helm charts jsonnet files Plain directory of YAML/json manifests Any custom config management tool configured as a config management plugin architecture Argo CD architecture æ¶æ§‹åœ– Components\nAPI Server\nå¯ä»¥è¢« Web UI, CLI, ä»¥åŠ CI/CD systems ä»‹æ¥çš„ gRPC/REST server å®ƒæœ‰å¹¾é …è²¬ä»» æ‡‰ç”¨ç®¡ç†èˆ‡ç‹€æ…‹å›å ± è™•ç† application çš„æ“ä½œï¼Œå¦‚ sync, rollback, å…¶ä»–ä½¿ç”¨è€…å®šç¾©çš„å‹•ä½œ ç®¡ç† credentialï¼Œå¦‚ K8s secrets ç®¡ç†é©—è­‰èˆ‡æ¬Šé™ åŸ·è¡Œ RBAC Git webhook äº‹ä»¶çš„å‚¾è½è€…/å‚³é€è€… Repository Server\nç®¡ç†æœ¬åœ° Git repository çš„å¿«å– (Cache) ç•¶æœ‰æ–°å¢ä»¥ä¸‹åƒæ•¸ï¼Œéœ€å»ºç«‹ Kubernetes manifests repository URL revision (commit, tag, branch) application path template specific settings: parameters, helm values.yaml Application Controller\nå±¬æ–¼ Kubernetes controller ğŸ‘‰ æ›´å¤šé—œæ–¼ Kubernetes controller æŒçºŒåµæ¸¬é‹è¡Œä¸­çš„ applicationï¼Œä¸¦æ¯”è¼ƒç¾åœ¨ç‹€æ…‹èˆ‡ç›®æ¨™ç‹€æ…‹ï¼Œè‹¥åµæ¸¬åˆ° OutOfSync å‰‡æœƒé¸æ“‡æ€§æ¡å–æ­£ç¢ºå‹•ä½œ æ­¤å…ƒä»¶è² è²¬ç‚ºç”Ÿå‘½é€±æœŸäº‹ä»¶(PreSync, Sync, PostSync)å»èª¿ç”¨ä½¿ç”¨è€…å®šç¾©çš„ hooks Features æ”¯æ´çš„åŠŸèƒ½ç¹å¤šï¼Œåˆ—å‡ºä¸€éƒ¨åˆ†ã€‚æ¯ä¸€ç‰ˆæˆ–è€…æœƒæœ‰äº›ä¸åŒï¼Œå»ºè­°å¯åƒè€ƒ ğŸ”” å®˜æ–¹æ–‡ä»¶ ğŸ”” è‡ªå‹•éƒ¨å±¬åˆ°ç‰¹æ€§ç›®æ¨™ç’°å¢ƒ æ”¯æ´å¤šç¨® templating å·¥å…· (Kustomize, Helm, Jsonnet, plain-YAML) èƒ½ç®¡ç†å¤šç¨® clusters SSO æ•´åˆ (OIDC, OAuth2, LDAP, SAML 2.0, GitHub, GitLab, Microsoft, LinkedIn) å¤šç§Ÿæˆ¶èˆ‡ RBAC æ”¿ç­– \u0026hellip;ç­‰ å¿ƒå¾— ğŸ’­ Argo CD åœ¨ March 26, 2020 è¢« CNCF åˆ—å…¥ï¼ŒCNCF çš„å°ˆæ¡ˆå€‘æ•´åˆç¨‹åº¦è¶Šä¾†è¶Šé«˜ï¼Œç›¸ä¿¡æœªä¾†çš„å¤šæ•¸å…¬å¸çš„ CICDã€ç›£æ§ã€Logã€è§’è‰²æ¬Šé™æ§ç®¡ã€è³‡æ–™åº«ç­‰æœƒä»¥ CNCF å°ˆæ¡ˆç‚ºä¸»ã€‚\nè‹¥æƒ³çŸ¥é“å¦‚ä½•åœ¨ docker desktop å»ºç«‹ Argo CDï¼Œè«‹åƒè€ƒæ–‡ç«  ğŸ‘‰ ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD\nåƒè€ƒè³‡æ–™ ğŸ‘ Argo CD Argo CD Components Kubernetes Controllers ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-05T10:56:11+08:00","permalink":"https://yue-jenny.github.io/2023/01/argo-cd-%E6%98%AF%E4%BB%80%E9%BA%BC/","title":"Argo CD æ˜¯ä»€éº¼?"},{"content":"Prerequisites é–‹å§‹å‰ï¼Œéœ€è¦å…ˆç¢ºä¿æœ‰ä»¥ä¸‹çš„å…ˆå‚™çŸ¥è­˜\nkubernetes Argo CD ä»‹ç´¹ ä»¥ GitOps æ¨¡å¼ç‚ºå®—æ—¨çš„æŒçºŒéƒ¨å±¬ (continuous delivery) å·¥å…· é—œæ–¼ GitOps å¯ä»¥åƒè€ƒæ–‡ç«  GitOps Getting Started with Argo CD on Docker Desktop è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥é–‹å§‹å§! ğŸ’ª\nå»ºç«‹ namespace kubectl create namespace argocd å®‰è£ Argo CD çš„ kubernetes resources éœ€è¦å®‰è£çš„ resources éƒ½å¯«åœ¨ install.yaml å…§ï¼Œåˆ©ç”¨ kubectl apply æŒ‡ä»¤é€²è¡Œå®‰è£\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml ç¢ºèª Argo CD çš„ pod çš„é‹è¡Œç‹€æ…‹ç‚º running -n è¡¨ç¤ºæŒ‡å®š namespace ç‚º argocdï¼Œæ²’è¨­å®šå°±æ˜¯ default namespace\nkubectl get pod -n argocd pod é‹è¡Œç‹€æ…‹\nå–å¾— Argo CD åˆå§‹ admin çš„å¯†ç¢¼ ç™»å…¥ dashboard ä½¿ç”¨\nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d; echo å°‡ service argocd-server port forward åˆ°æœ¬åœ° å°‡ service argocd-server çš„ port 443 å°è‡³æœ¬åœ° port 8000\nkubectl port-forward svc/argocd-server -n argocd 8000:443 port forward æˆåŠŸ\nç™»å…¥ Argo CD dashboard ç¶²å€è¼¸å…¥ https://localhost:8000\næˆåŠŸç™»å…¥ Argo CD dashboard\né‡å° public git repository å»ºç«‹ä¸€çµ„ application å…ˆ fork ç¯„ä¾‹ repository - argocd-example-apps\nä¾ç…§å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿé€²è¡Œæ–°å¢ application\nStep 1 Step 2ï¼Œå¡«å®Œè³‡è¨Šï¼ŒæŒ‰ä¸‹ CREATEï¼Œèƒ½åœ¨ dashboard çœ‹åˆ° application\napp name: guestbook project: default sync policy: Manual Repository URL Revision: HEAD Path: guestbook Destination/Cluster: https://kubernetes.default.svc Namespace: default é‡å° private git repository å»ºç«‹ä¸€çµ„ application é¸ä¸€çµ„ private repo\nåˆ° Settings/Repositories\nä»¥ ssh-key æ–¹å¼èªè­‰ï¼Œä¹Ÿèƒ½é¸æ“‡ä»¥ Httpsæˆ–è€… Github App çš„æ–¹å¼é©—è­‰\nå¯åƒè€ƒArgo CD Private Repositories Credential è¨­å®š å¯åƒè€ƒæˆ‘çš„æ–‡ç« ä½¿ç”¨ Github App Credential èªè­‰ è¨­å®šå®Œæˆæœƒé¡¯ç¤º Successful å»ºç«‹ application\nStep 1 Step 2\nä¾ç…§å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿå¡«å…¥è³‡æ–™ æˆåŠŸå»ºç«‹ä¸€çµ„ private application ğŸš€\nè§£é™¤å®‰è£ application åŸ·è¡Œ DELETE æŒ‰éˆ•\nè§£é™¤å®‰è£ Argo CD âš ï¸ è§£é™¤å®‰è£ Argo CD å‰ä¸€å®šè¦å…ˆè§£é™¤å®‰è£ application\nkubectl -n argocd delete -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml é‡éçš„å•é¡Œ åƒè€ƒè³‡æ–™ Argo CD Argo CD getting started åƒè€ƒæ–‡ä»¶ kubernetes kubectl port-forward Argo CD Private Repositories Credential è¨­å®š ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨\n","date":"2023-01-04T04:39:13.628Z","permalink":"https://yue-jenny.github.io/2023/01/%E4%BD%BF%E7%94%A8-docker-desktop-%E9%81%8B%E8%A1%8C-argo-cd-%E4%BB%A5%E5%8F%8A%E5%9C%A8-argo-cd-%E5%85%A7%E5%BB%BA%E7%AB%8B-app-%E5%81%B5%E6%B8%AC-repository-%E7%8B%80%E6%85%8B/","title":"ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD ä»¥åŠåœ¨ Argo CD å…§å»ºç«‹ App åµæ¸¬ repository ç‹€æ…‹"},{"content":"OpenID Connect (OIDC) ä»‹ç´¹ å‰è¨€ OIDC å…¨åç‚º OpenID Connectï¼Œæ˜¯ä¸€ç¨®å¯ä»¥ access AWS resourcesï¼Œä½†ä¸éœ€è¦å­˜å– AWS credentials ç•¶ä½œ long-lived GitHub secrets çš„é©—è­‰æ–¹å¼ã€‚ å®˜æ–¹å»ºè­°çš„é©—è­‰æ–¹å¼ã€‚ OIDC å„ªé» - å¾ˆå¥½çš„å®‰å…¨å¯¦è¸ (good security practices) No cloud secrets ä¸éœ€è¦ä»¥ cloud credentials ç•¶ä½œ long-lived GitHub secrets åœ¨ cloud provider è¨­å®šå¥½ OIDC trustï¼Œgithub workflows å°±å¯ä»¥åˆ©ç”¨ OIDC å¾ cloud provider å–å¾—ä¸€çµ„ short-lived access token Authentication and authorization management é€é cloud provider çš„ authentication (authN) èˆ‡ authorization (authZ) å·¥å…·èƒ½å¤ æ§åˆ¶å–å¾— cloud resources èƒ½æ›´å°ç²’åº¦åœ°æ§åˆ¶ workflows å¦‚ä½•ä½¿ç”¨ credentials Rotating credentials cloud provider æä¾›ä¸€çµ„ short-lived access token çµ¦ä¸€å€‹ jobï¼Œä½¿ç”¨å®Œç•¢å¾Œæœƒè‡ªå‹•éæœŸã€‚ OIDC çš„é‹ä½œæ–¹å¼èˆ‡ä¿¡ä»»æ©Ÿåˆ¶ é‹ä½œæ–¹å¼ ä¸»è¦æ˜¯å…©å€‹è§’è‰²çš„äº’å‹•ï¼Œåˆ†åˆ¥ç‚º Cloud Provider èˆ‡ Github OIDC Provider äº’å‹•éç¨‹ : In your cloud provider, create an OIDC trust between your cloud role and your GitHub workflow(s) that need access to the cloud. Every time your job runs, GitHub\u0026rsquo;s OIDC Provider auto-generates an OIDC token. This token contains multiple claims to establish a security-hardened and verifiable identity about the specific workflow that is trying to authenticate. You could include a step or action in your job to request this token from GitHub\u0026rsquo;s OIDC provider, and present it to the cloud provider. Once the cloud provider successfully validates the claims presented in the token, it then provides a short-lived cloud access token that is available only for the duration of the job. å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ å®‰å…¨ - OIDC trust ç•¶è¨­å®š cloud èƒ½ä¿¡ä»» GitHub\u0026rsquo;s OIDC provider å¾Œï¼Œå¿…é ˆåŠ ä¸Šä¸€äº›æƒ…å¢ƒå»éæ¿¾æ‰ requestsï¼Œé¿å…æ²’æœ‰å–å¾—ä¿¡ä»»çš„ repositories or workflows å¯ä»¥é€é access token æ“ä½œä½ çš„ cloud resourcesã€‚ Configuring OpenID Connect in Amazon Web Services å‰è¨€ ç›®çš„æ˜¯ Use OpenID Connect within your workflows to authenticate with Amazon Web Services. å®˜æ–¹æ–‡ä»¶ IAM Role 1. Create a iam role å»ºç«‹ä¸€çµ„ iam roleï¼Œç”¨æ–¼ä¸Šå‚³ docker image åˆ° private ECR å»ºç«‹ iam role çš„æ™‚å€™ï¼Œæœƒéœ€è¦å¡«å…¥ä»¥ä¸‹è³‡è¨Š : provider URL : https://token.actions.githubusercontent.com Audience : sts.amazonaws.com 2. Permissions policies iam role ç¶å®šçš„ permissions policies æ˜¯ AmazonEC2ContainerRegistryPowerUser æ­¤æ”¿ç­–å…è¨±å§”è¨—äººè®€å–å’Œå¯«å…¥å„²å­˜åº«ï¼Œä»¥åŠè®€å–ç”Ÿå‘½é€±æœŸæ”¿ç­–ã€‚å§”è¨—äººä¸æœƒè¢«æˆäºˆåˆªé™¤å„²å­˜åº«æˆ–è®Šæ›´å¥—ç”¨è‡³å…¶ç”Ÿå‘½é€±æœŸæ”¿ç­–çš„è¨±å¯ã€‚ å¯ä¾æ“šéœ€æ±‚è¨­å®šä¸åŒçš„ permissons policiesï¼Œå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ 3. Add the GitHub OIDC provider to IAM Configure the role and trust in IAM.\nåˆ° iam role é é¢é»é¸ç·¨è¼¯ Trust relationships\nåƒè€ƒä»¥ä¸‹çš„æ–¹å¼å°‡ sub æ¬„ä½åŠ å…¥åˆ° Condition ä¸­\næ–¹å¼ä¸€ï¼Œä½¿ç”¨ StringLike\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Principal\u0026#34;: { \u0026#34;Federated\u0026#34;: \u0026#34;arn:aws:iam::123456123456:oidc-provider/token.actions.githubusercontent.com\u0026#34; }, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRoleWithWebIdentity\u0026#34;, \u0026#34;Condition\u0026#34;: { \u0026#34;StringLike\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:sub\u0026#34;: \u0026#34;repo:octo-org/octo-repo:*\u0026#34; }, \u0026#34;StringEquals\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:aud\u0026#34;: \u0026#34;sts.amazonaws.com\u0026#34; } } } ] } æ–¹å¼äºŒï¼Œä½¿ç”¨ StringEquals\n\u0026#34;Condition\u0026#34;: { \u0026#34;StringEquals\u0026#34;: { \u0026#34;token.actions.githubusercontent.com:aud\u0026#34;: \u0026#34;sts.amazonaws.com\u0026#34;, \u0026#34;token.actions.githubusercontent.com:sub\u0026#34;: \u0026#34;repo:octo-org/octo-repo:ref:refs/heads/octo-branch\u0026#34; } } å®˜æ–¹æ–‡ä»¶\nUpdating your GitHub Actions workflow ä¸Šè¿°æ˜¯ AWS ç›¸é—œè¨­å®šï¼Œæ­¤æ­¥é©Ÿæ˜¯èª¿æ•´ github workflowï¼Œåšå…©ä»¶äº‹æƒ… :\nAdding permissions settingsï¼Œæœ‰å…©ç¨®æ¬Šé™é¸æ“‡ï¼Œå¯ä¾ç…§è‡ªèº«æƒ…å¢ƒå»é¸æ“‡ã€‚\nfetch an OIDC token for a workflow, then the permission can be set at the workflow level.\npermissions: id-token: write # This is required for requesting the JWT contents: read # This is required for actions/checkout only need to fetch an OIDC token for a single job\npermissions: id-token: write # This is required for requesting the JWT Use the aws-actions/configure-aws-credentials action\næ­¤ action æœƒæ¥æ”¶ä¾†è‡ª GitHub OIDC provider çš„ JWTï¼Œä¸¦ä¸”å‘ AWS è«‹æ±‚ä¸€çµ„ access token - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: role-to-assume: arn:aws:iam::1234567890:role/example-role role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession aws-region: ${{env.AWS_DEFAULT_REGION}} åƒè€ƒè³‡æ–™ configuring-openid-connect-in-amazon-web-services about-security-hardening-with-openid-connect æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-29T14:32:24+08:00","permalink":"https://yue-jenny.github.io/2022/12/%E5%9C%A8-github-workflow-%E4%B8%AD%E4%BD%BF%E7%94%A8-openid-connect-oidc-%E5%8E%BB%E8%AA%8D%E8%AD%89-aws-%E6%9C%8D%E5%8B%99/","title":"åœ¨ Github workflow ä¸­ä½¿ç”¨ OpenID Connect (OIDC) å»èªè­‰ AWS æœå‹™"},{"content":"Github Workflow ä»‹ç´¹ å‰è¨€ ç‚ºäº†åˆ©ç”¨ Github Workflow å®Œæˆ CI/CDï¼Œåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†å¯«ï¼Œåˆ†åˆ¥æ˜¯\nGithub Workflow çš„åŸºæœ¬è¨­å®š Github Workflow ä¸­é€²è¡Œ CI ç™»å…¥ç™»å‡º AWS ECR èˆ‡ github container registry build \u0026amp; upload image æ›´æ–° helm value ä¸­çš„ image tagï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ åŸºæœ¬è¨­å®š action ç‚º push çš„æ™‚å€™ï¼Œæ‰€æœ‰ branch éƒ½æœƒé€²è¡Œ github workflow action ç‚º pull_request çš„æ™‚å€™ï¼Œåªæœ‰ main branch æœƒé€²è¡Œ github workflow types paths on: push: branches: [\u0026#34;*\u0026#34;] pull_request: branches: [\u0026#34;main\u0026#34;] types: - opened paths: - \u0026#34;**.js\u0026#34; env è¨­å®š è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š env: AWS_DEFAULT_REGION: ap-southeast-1 GIT_USER_NAME: jennyc permissions è¨­å®š è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š permissions: id-token: write # This is required for requesting the JWT contents: read # This is required for actions/checkout è‡ªå‹•åŒ–æ¸¬è©¦ CI checkout repository ä½¿ç”¨ actions/checkout@v3 é€²è¡Œ\n- name: Checkout repository uses: actions/checkout@v3 åŸ·è¡Œ npm install - name: Install dependencies run: npm install åŸ·è¡Œ npm test - name: Run tests run: npm run test Build multi-platform images ä¸¦ä¸Šå‚³è‡³ AWS ECR å‰è¨€ é€™éƒ¨åˆ†éœ€è¦å…ˆè¨­å®š AWS Credential æ‰èƒ½ä½¿ç”¨ AWS ECRï¼Œ\næ¥è‘— build multi-platform image ä¸¦ä¸”ä¸Šå‚³è‡³ AWS ECRã€‚\n1. è¨­å®š AWS Credential è¨­å®š AWS Credential\nä½¿ç”¨ GitHub\u0026rsquo;s OIDC provider æ–¹å¼å–å¾— short-lived credentials\nOpenID Connect (OIDC) è¨­å®šæ–¹å¼å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç«  workflow è¦æ€éº¼å¯«?\nenv.AWS_DEFAULT_REGION éœ€è¦ç‰¹åˆ¥è¨­å®šï¼Œèˆ‡ AWS ECR ç›¸åŒçš„ region role-to-assume å¡«å…¥ AWS role role-session-name é è¨­æ˜¯ GitHubActionsï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´åç¨± - name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: role-to-assume: arn:aws:iam::1234567890:role/example-role role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession aws-region: ${{env.AWS_DEFAULT_REGION}} 2. ç™»å…¥ AWS private ECR æœ‰å…©ç¨®æ–¹å¼ Using access key id and secret access key to login\n- name: Configure AWS credentials uses: aws-actions/configure-aws-credentials@v1 with: aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} aws-region: ap-southeast-1 Using OpenID Connect (OIDC) to login\nå®˜æ–¹æ¨è–¦ä½¿ç”¨æ­¤æ–¹å¼ - name: Login to Amazon ECR id: login-ecr uses: aws-actions/amazon-ecr-login@v1 3. ç™»å…¥ AWS public ECR å¯åƒè€ƒå®˜æ–¹èªªæ˜ 4. ç™»å‡º AWS ECR - name: Logout of Amazon ECR if: always() run: docker logout ${{ steps.login-ecr.outputs.registry }} 5. è¨­å®š short sha ç‚º image tag è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tagï¼ŒåŸå› å¯ä»¥åƒè€ƒ: 7 digits are the Git default for a short SHA é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ Chapter 7 of the Pro Git book å°‡ output å‡ºå»çš„åƒæ•¸å‘½åç‚º sha_short - name: Set short sha outputs id: vars run: echo \u0026#34;sha_short=$(git rev-parse --short HEAD)\u0026#34; \u0026gt;\u0026gt; $GITHUB_OUTPUT 6. Build multi-platform images ä¸¦ä¸Šå‚³ images åˆ° AWS ECR å»ºç«‹å¤šå¹³å° docker images çš„å®˜æ–¹æ–‡ä»¶ IMAGE_TAG æœƒå¾æ­¥é©Ÿ 5 å–å¾— output çš„è®Šæ•¸ sha_short --platform å¯æ¥ä¸Šéœ€è¦çš„ platform åƒè€ƒï¼Œä¾‹å¦‚ linux/amd64, linux/arm64 - name: Build, tag, and push docker image to Amazon ECR env: REGISTRY: ${{ steps.login-ecr.outputs.registry }} REPOSITORY: pet-app IMAGE_TAG: ${{ steps.vars.outputs.sha_short }} run: | docker run --rm --privileged multiarch/qemu-user-static --reset -p yes ( å®˜æ–¹å»ºè­°: docker run --privileged --rm tonistiigi/binfmt --install all ) docker buildx create --name mybuilder --driver docker-container --bootstrap docker buildx use mybuilder docker buildx inspect docker buildx build --platform linux/amd64,linux/arm64 -t $REGISTRY/$REPOSITORY:$IMAGE_TAG --push . ç‚ºä»€éº¼éœ€è¦ docker run --rm --privileged multiarch/qemu-user-static --reset -p yes ?\nå› ç‚ºé‡åˆ° Error: while loading /usr/local/sbin/node: No such file or directory å•é¡Œ å…ˆä½¿ç”¨æ–¹å¼ä¸€ : é€£æ¥æ–¹å¼ï¼Œçµæœé‚„æ˜¯æœ‰ç›¸åŒå•é¡Œ ln -s /usr/bin/node /usr/local/sbin/node å¾Œä¾†ä½¿ç”¨æ–¹å¼äºŒ ä½¿ç”¨ docker buildx æŒ‡ä»¤å‰å…ˆåŸ·è¡Œä»¥ä¸‹å‘½ä»¤\ndocker run --rm --privileged multiarch/qemu-user-static --reset -p yes è©³ç´°åŸå› çš„ Stack Overflow åŸå§‹æ–‡ç« åœ¨é€™é‚Šï¼Œä»¥ä¸‹æ˜¯ç¯€éŒ„éƒ¨åˆ†\n` When you ask the Linux kernel to run some executable file, it needs to know, how to load this specific file, and whether this file is compatible with current machine, or not. By default, the ELF binary compiled for, say, arm64v8 is rejected by the kernel, running on amd64 hardware.\nHowever, the binfmt_misc feature of the kernel allows you to tell it, how to handle the executables it cannot usually handle on its own - this includes the cases when the kernel does not know the binary format or considers it incompatible with current machine.\n`\ngithub issue\nå®˜æ–¹å»ºè­°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£æ±º QEMU binaries å•é¡Œï¼Œå®˜æ–¹æ–‡ä»¶\ndocker run --privileged --rm tonistiigi/binfmt --install all æ›´æ–° helm value çš„ image tag å‰è¨€ æ‡‰ç”¨æ˜¯ä»¥ terraform æ–¹å¼éƒ¨å±¬ï¼Œä¸¦æ­é…ä½¿ç”¨ helm chartsã€‚è€Œ docker image çš„ tag æ˜¯å¯«åœ¨ helm values å…§ã€‚\nç›®æ¨™æ˜¯æ›´æ–° helm values çš„ docker image tag å€¼ï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ã€‚\néœ€åšåˆ°å…©ä»¶äº‹æƒ…:\ncheckout ç§æœ‰ repository è¨­å®šèˆ‡æ›´æ–° image tag 1. å…ˆ checkout ç§æœ‰å­˜æ”¾ helm value çš„ repository éœ€è¦å…ˆè¨­å®š credential æ‰èƒ½ fetch private repositoryï¼Œæœ‰å…©ç¨®è¨­å®šçš„æ–¹å¼\nè¨­å®š deploy key\næ­¥é©Ÿå¦‚ä¸‹ï¼Œå¯åƒè€ƒé€™ç¯‡\nCreate a new SSH key pairÂ for your repository. Do not set a passphrase. Copy the contents of the public key (.pub file) to a new repositoryÂ deploy keyÂ and check the box to \u0026ldquo;Allow write access.\u0026rdquo; Add a secret to the repository containing the entire contents of the private key. As shown in the example below, configureÂ actions/checkoutÂ to use the deploy key you have created. workflow è¦æ€éº¼å¯«?\nssh-key å¡«å…¥ private key çš„ secrets åç¨± path è¨­å®š checkout çš„ repo æœƒå­˜åœ¨å“ªä¸€å€‹è³‡æ–™å¤¾å…§ - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}} uses: actions/checkout@v3 with: repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}} ssh-key: ${{ secrets.SSH_PRIVATE_KEY }} path: ${{env.TERRAFORM_REPOSITORY_NAME}} è¨­å®š Personal access token (PAT)\nå»ºç«‹ PAT çš„æ–¹å¼ï¼Œå®˜æ–¹æ–‡ä»¶\nå°‡å»ºç«‹å®Œæˆçš„ PAT è¨­å®šåˆ° repository çš„ secrets ä¸­ï¼Œè¨­å®šçš„ secrets åç¨±ç‚º GH_PATï¼Œå®˜æ–¹æ–‡ä»¶\nworkflow è¦æ€éº¼å¯«?\nrepository è¨­å®šç‚º owner/repository_name token å¡«å…¥ PAT çš„ secrets åç¨±ï¼Œé€™é‚Šæ˜¯å°‡ secrets åç¨±ç‚º GH_PAT çš„å…§å®¹è¨­å®šç‚º PAT - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}} uses: actions/checkout@v3 with: repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}} token: ${{ secrets.GH_PAT }} 2. è¨­å®š image tag è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tag 7 digits are the Git default for a short SHA é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ Chapter 7 of the Pro Git book - name: Set short sha outputs id: vars run: echo \u0026#34;sha_short=$(git rev-parse --short HEAD)\u0026#34; \u0026gt;\u0026gt; $GITHUB_OUTPUT 3. æ›´æ–° image tag ä»¥ yq çš„ github action å·¥å…·ä¿®æ”¹ yaml æª”å…§çš„ image tag å€¼ yq çš„å®˜æ–¹æ–‡ä»¶ yq çš„ github é€²è¡Œ git æ“ä½œï¼Œè¨­å®š user name, user emailã€commit ä»¥åŠ push tag å–ä¸Šä¸€å€‹æ­¥é©Ÿ output çš„åƒæ•¸ sha_short - name: Update image tag uses: mikefarah/yq@master with: cmd: yq -i \u0026#39;.pet_app_dashboard_site.image.tag = \u0026#34;${{ steps.vars.outputs.sha_short }}\u0026#34;\u0026#39; ./${{env.TERRAFORM_REPOSITORY_NAME}}/${{env.HELM_FILE_NAME}} - run: | cd ${{env.TERRAFORM_REPOSITORY_NAME}} git config user.name ${{env.GIT_USER_NAME}} git config user.email ${{env.GIT_USER_EMAIL}} git add ${{env.HELM_FILE_NAME}} git commit -m \u0026#34;update image tag to ${{ steps.vars.outputs.sha_short }}\u0026#34; git push origin main è‹¥è¦å°‡ docker image ä¸Šå‚³è‡³ github container registry è©²æ€éº¼åš? 1. ç™»å…¥èˆ‡ç™»å‡º github container registry éœ€è¦è¨­å®š env.REGISTRY ç‚º ghcr.io\nä¸éœ€è¦å¦å¤–è¨­å®š github.actor èˆ‡ GITHUB_TOKEN\n- name: Login to GitHub Container Registry uses: docker/login-action@v2 with: registry: ${{ env.REGISTRY }} username: ${{ github.actor }} password: ${{ secrets.GITHUB_TOKEN }} 2. Extract metadata - name: Extract metadata (tags, labels) for Docker id: meta uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38 with: images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }} 3. Build and push docker image labels çš„å€¼å¯ä»¥å¾æ­¥é©ŸäºŒå–å‡º outputs labels ä¾†ä½¿ç”¨ - name: Build and push Docker image uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc with: context: . push: true tags: ${{ env.REGISTRY }}/${{ env.REPO }}:${{ steps.vars.outputs.sha_short }} labels: ${{ steps.meta.outputs.labels }} åƒè€ƒè³‡æ–™ actions/checkout amazon-ecr-login docker/login-action docker-build-fails-for-arm-images yq çš„å®˜æ–¹æ–‡ä»¶ yq çš„ github Chapter 7 of the Pro Git book creating-a-personal-access-token creating-and-using-encrypted-secrets æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-10T18:33:05+08:00","permalink":"https://yue-jenny.github.io/2022/12/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-github-workflow-%E5%AE%8C%E6%88%90-ci/cd/","title":"å¦‚ä½•ä½¿ç”¨ Github Workflow å®Œæˆ CI/CD"},{"content":"å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ? è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥é–‹å§‹å§! ğŸ’ª\n1. Create a repository 2. Naming repository name å°‡ repository ä¾æ“šæ¨¡æ¿ username.github.io å‘½å âš ï¸ username æ˜¯å¸³æˆ¶åç¨± æŸ¥çœ‹è‡ªå·±çš„ URL å¯ä»¥æŸ¥å‡º usernameï¼Œä¾æ“šæ¨¡æ¿ https://github.com/YOUR_USERNAME å‘ˆç¾ æˆ‘å¸³æˆ¶åç¨±æ˜¯ Yue-Jennyï¼Œusername éœ€è¨­å®šç‚º yue-jenny 3. ä¸Šå‚³ä½ çš„éœæ…‹æª”æ¡ˆåˆ° github åƒè€ƒ\u0026quot;ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?\u0026quot;ï¼Œç”¨ hugo å»ºç«‹ä½ çš„éƒ¨è½æ ¼ç³»çµ±ï¼Œä¸¦å°‡ publishing directory çš„éœæ…‹æª”æ¡ˆä¸Šå‚³åˆ° github repository 4. è¨­å®š åˆ° repository çš„ Settings é ç±¤\n\u0026ldquo;Code and automation\u0026rdquo; å€å¡Šä¸­é»é¸ Pages\n\u0026ldquo;Source\u0026rdquo; é¸ Deploy from a branch\n\u0026ldquo;Branch\u0026rdquo; é¸ publishing çš„ä¾†æº\n\u0026ldquo;ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?\u0026rdquo; è¨­å®š publishing directory ç‚º docsï¼Œæ‰€ä»¥é¸ docs 5. æ‹œè¨ªä½ çš„æ–°ç¶²ç«™ ğŸ”¥ ç€è¦½å™¨è¼¸å…¥ URL username.github.io\nåƒè€ƒè³‡æ–™ github pages quickstart æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!\n","date":"2022-12-10T18:25:43+08:00","permalink":"https://yue-jenny.github.io/2022/12/%E5%A6%82%E4%BD%95%E7%94%A8-github-pages-host-%E9%9D%9C%E6%85%8B%E6%AA%94%E6%A1%88/","title":"å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ?"},{"content":"ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ Hugo \u0026amp; Github pages å»ºç«‹ä¸€å€‹ blog ç³»çµ±? 1. å…§å®¹ä¿å­˜èˆ‡æ§ç®¡ âœ… æ–‡ç« å…§å®¹ä»¥ markdown èªæ³•æ’°å¯«èˆ‡ä¿å­˜ï¼Œç†Ÿæ‚‰ markdown èªæ³•å¾Œï¼Œæœƒç™¼ç¾å¾ˆæ–¹ä¾¿ ğŸ‘ æ¨è–¦ä½¿ç”¨ vscode ä½œç‚ºç·¨è¼¯å™¨ â˜ï¸ åŠ å…¥ extension å¯ç¢ºèª markdown å…§å®¹å‘ˆç¾ âœŒï¸ ç›´æ¥åŸ·è¡ŒæŒ‡ä»¤é‹è¡Œç¶²ç«™ âœ… å…§å®¹å¯å®šæœŸæ”¾ä¸Šé›²ç«¯ä¿å­˜å‚™ä»½ï¼Œä¸ç”¨æ“”å¿ƒè‹¥éƒ¨è½æ ¼ç³»çµ±ä¸‹ç·šå¾Œï¼Œæ–‡ç« ä¹Ÿè·Ÿè‘—æ¶ˆå¤±æˆ–è€…è©²å¦‚ä½•å‚™ä»½ âœ… ä¿®æ”¹å…§å®¹æ™‚ï¼Œä¸æ€•ç·šä¸Šéƒ¨è½æ ¼ç³»çµ±å‡ºç¾å•é¡Œï¼Œè¼¸å…¥åˆ°ä¸€åŠçš„å…§å®¹ç›´æ¥æ¶ˆå¤± ( æ›¾ç¶“æœ‰é¡ä¼¼çš„ç¶“é©—ï¼Œå…¨éƒ¨é‡ä¾† ğŸ˜“) 2. å¯é«˜åº¦å®¢è£½åŒ– âœ… å®¢è£½å­—é«”å¤§å°é¡è‰²ã€ä¸»é¡Œå¥—ä»¶ç­‰ UI çš„éƒ¨åˆ† âœ… è‡ªç”±æ±ºå®šè¦åŠ å…¥å“ªäº›åŠŸèƒ½ï¼Œå»ºç«‹æ“æœ‰è‡ªæˆ‘é¢¨æ ¼çš„éƒ¨è½æ ¼ç³»çµ± ğŸ’ª è©•è«–å€(æ”¯æ´ä¸åŒå¤šç¨®è»Ÿé«”) LikeCoin button Table of contents é é¦–èˆ‡é å°¾è¨­è¨ˆ \u0026hellip; etc Hugo \u0026amp; Github pages åŸºæœ¬çŸ¥è­˜ 1. Hugo ä»‹ç´¹ å¼•ç”¨è‡ªå®˜æ–¹æ–‡ä»¶èªªæ˜ Hugo is a fast and modern static site generator written in Go, and designed to make website creation fun again.\n2. Github pages ä»‹ç´¹ å¼•ç”¨è‡ªå®˜æ–¹æ–‡ä»¶èªªæ˜ You can use GitHub Pages to showcase some open source projects, host a blog, or even share your rÃ©sumÃ©. This guide will help get you started on creating your next website.\nGetting startï¼Œè®“æˆ‘å€‘é€²å…¥æ­£é¡Œå§! åŸºæœ¬åŠŸèƒ½ 1. Prerequisites\nInstall Hugoï¼Œå®‰è£èƒ½å¤  compile go language çš„å·¥å…·ï¼Œä¸åŒ OS å®‰è£ä¸åŒçš„æª”æ¡ˆ Install Gitï¼Œå¾ŒçºŒä¸‹è¼‰ theme ä½¿ç”¨ 2. Create a site\nhugo new site quickstart 3. åˆ° quickstart ç›®éŒ„ï¼Œä¸¦åŸ·è¡Œ initial git repository\ncd quickstart git init 4. clone ananke themeï¼Œä¸¦ä»¥ git submodule æ–¹å¼å­˜åœ¨\nè‹¥æƒ³äº†è§£ git submoduleï¼Œå¯åƒè€ƒå®˜æ–¹æ–‡ä»¶\ngit submodule add https://github.com/theNewDynamic/gohugo-theme-ananke themes/ananke 5. è¨­å®š site configuration file\nåœ¨ config.toml åŠ å…¥é€™è¡Œ\ntheme = \u0026#39;ananke\u0026#39; 6. æœ¬åœ°å•Ÿå‹• hugo å°ˆæ¡ˆ\næœ¬åœ°å•Ÿå‹• hugo å°ˆæ¡ˆï¼Œ-p æ˜¯æŒ‡å®š port ç‚º 8080\næƒ³çŸ¥é“æ›´å¤š hugo å‘½ä»¤è¡Œå¯ä»¥é»é€™é‚Š\nhugo server -p 8080 ç€è¦½å™¨è¼¸å…¥ https://localhost:8080ï¼Œå¯ç¢ºèªé é¢å·²å‡ºç¾ (é€™æ™‚é‚„æ²’æœ‰æ–‡ç« å…§å®¹)\n7. é–‹å§‹å¯«æ–‡ç« \nå»ºç«‹ä¸€å€‹ markdown æª”æ¡ˆï¼Œmarkdown æª”æ¡ˆå…§çš„è¨­å®šçš„æ„ç¾©\ntitle - æ–‡ç« æ¨™é¡Œ date - å»ºç«‹æ­¤æ–‡ç« çš„æ™‚é–“ï¼Œæ–‡ç« æœƒè·Ÿè‘—æ™‚é–“æ’åº draft - æ˜¯å¦ç‚ºè‰ç¨¿ï¼Œproduction ç’°å¢ƒå»ºè­°åªé¡¯ç¤ºéè‰ç¨¿çš„æ–‡ç« ï¼Œå¯«å®Œæ–‡ç« å¯æ”¹ç‚º falseï¼Œå†åŸ·è¡Œ build æŒ‡ä»¤ï¼Œè®“ markdown è®Šæˆ html ç­‰éœæ…‹æª”æ¡ˆã€‚ hugo new content/post/oidc-aws/index.md 8. é‹è¡Œç¶²ç«™\nå¯«å®Œæ–‡ç« å…§å®¹å¾Œ âœï¸ï¼Œè¨­å®š markdown æª”æ¡ˆå…§çš„ draft ç‚º falseï¼Œè¡¨ç¤ºé draft æ¨¡å¼ï¼Œé‡åˆ·é é¢å¯çœ‹åˆ°æ–‡ç« \nè‹¥éœ€è¦åœ¨ draft æ¨¡å¼ä¸‹é¡¯ç¤ºæ–‡ç« ï¼Œéœ€èª¿æ•´å•Ÿå‹• server çš„å‘½ä»¤è¡Œ\n-Dè¡¨ç¤º --buildDraftsï¼ŒæœƒåŒ…å«è¨»è¨˜ç‚º draft çš„å…§å®¹ hugo server -D -p 8080 æˆåŠŸ ğŸš€ ğŸš€ ğŸš€ 9. host on github page\nè¨­å®š github pagesï¼Œè«‹åƒè€ƒ å¦‚ä½•ç”¨ github pages host éœæ…‹æª”æ¡ˆ åŸºæœ¬å®¢è£½åŒ–åŠŸèƒ½ hugo æä¾›ä¸€äº›å®¢è£½åŒ–åŠŸèƒ½ï¼Œä¾†çœ‹çœ‹æ‡‰è©²æ€éº¼åš?\nå¦‚ä½•è¨­å®š publish è³‡æ–™å¤¾? åœ¨ config.toml ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®šï¼Œèƒ½å°‡ publish è³‡æ–™å¤¾è¨­å®šç‚º docsï¼Œè€Œ Github pages èƒ½ host docs è³‡æ–™å¤¾å…§çš„éœæ…‹æª”æ¡ˆ\npublishDir = \u0026#34;docs\u0026#34; å¦‚ä½•æ›¿æ›æˆä¸åŒ theme? æˆ‘ä½¿ç”¨çš„ä¸»é¡Œæ˜¯ hugo-theme-stack ( å®˜æ–¹æ–‡ä»¶ )ï¼Œè©²å¦‚ä½•èª¿æ•´?\nclone hugo-theme-stack theme git submodule add https://github.com/CaiJimmy/hugo-theme-stack themes/hugo-theme-stack èª¿æ•´ config.toml çš„è¨­å®šå€¼ theme theme = \u0026#39;hugo-theme-stack\u0026#39; å¦‚ä½•å®¢è£½åŒ–æ–‡ç« ä¸­çš„ font family? èª¿æ•´ themes\\hugo-theme-stack\\layouts\\partials\\head\\custom.html ï¼Œå…§å®¹å¦‚ä¸‹\nä»¥ google fonts ä½œç‚ºå­—é«”ä¾†æºã€ä»¥ css2 ä½œç‚ºæ¨£å¼ä¾†æº \u0026lt;style\u0026gt; :root { --article-font-family: \u0026#34;Literata\u0026#34;, var(--base-font-family); } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; (function () { const customFont = document.createElement(\u0026#39;link\u0026#39;); customFont.href = \u0026#34;https://fonts.googleapis.com/css2?family=Literata:wght@400;700\u0026amp;display=swap\u0026#34;; customFont.type = \u0026#34;text/css\u0026#34;; customFont.rel = \u0026#34;stylesheet\u0026#34;; document.head.appendChild(customFont); }()); \u0026lt;/script\u0026gt; åƒè€ƒå®˜æ–¹æ–‡ä»¶\nå¦‚ä½•å®¢è£½åŒ–å»ºç«‹ index.md çš„æ¨¡æ¿? èª¿æ•´ archetypes\\default.md æœ‰å…¶ä»–æ›´é€²éšçš„ç”¨æ³•ï¼Œè«‹åƒè€ƒå®˜æ–¹æ–‡ä»¶ é€²éšå®¢è£½åŒ– â˜ï¸ å¦‚ä½•åœ¨ Hugo çš„æ–‡ç« ä¸­åŠ å…¥ LikeCoin button? LikeCoin æ˜¯å¼·èª¿å…§å®¹æœ‰åƒ¹çš„è€Œå‡ºç¾çš„è™›æ“¬è²¨å¹£ï¼Œå¯çµ¦ä½œè€…æ”¯æŒèˆ‡é¼“å‹µ å¯¦ä½œæ–¹å¼: è¨»å†Š Liker ID\nå»ºç«‹ themes\\hugo-theme-stack\\layouts\\partials\\likecoin.html\n\u0026lt;iframe class=\u0026#34;LikeCoin\u0026#34; height=\u0026#34;235\u0026#34; src=\u0026#34;https://button.like.co/in/embed/{{ .Site.Params.likerID }}/button?referrer={{ .Permalink }}\u0026#34; width=\u0026#34;100%\u0026#34; frameborder=0\u0026gt;\u0026lt;/iframe\u0026gt; åœ¨ config.toml ä¸­åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œä¸¦å°‡ [LikerID] æ›´æ”¹ç‚ºä½ çš„ Liker ID\n[Params] likerID = \u0026#34;YOUR_LIKERID\u0026#34; åœ¨æ–‡ç« çš„æ¨¡æ¿ä¸­åŠ å…¥ LikeCoin button\nå°‡ä»¥ä¸‹çš„ç¨‹å¼ç¢¼å¡«å…¥ themes\\hugo-theme-stack\\layouts\\partials\\article\\article.html ä¸­\n{{ partial \u0026#34;likecoin.html\u0026#34; . }} å®˜æ–¹æ–‡ä»¶ é€²éšå®¢è£½åŒ– âœŒï¸ å¦‚ä½•ä½¿ç”¨ Google Console Search åµæ¸¬ç¶²ç«™çš„æ”¶éŒ„æƒ…æ³? è—‰ç”±äº†è§£ç¶²ç«™æˆæ•ˆï¼Œä¸¦é‡å°å¼±é»é€²è¡Œå„ªåŒ–ï¼Œå¯å¢åŠ ç¶²ç«™çš„æ›å…‰ç‡ ğŸŒŸ é€²éšå®¢è£½åŒ– ğŸ‘Œ SEO æœå°‹å¼•æ“å„ªåŒ– google æœƒä¾æ“šç¶²é ç¶²å€å»ºç«‹ indexï¼Œæœå°‹çµæœæœƒå…ˆå‘ˆç¾æœ‰å»ºç«‹ index çš„ç¶²é  å› æ­¤ç‚ºäº†å¼·åŒ–ç¶²é çš„ SEOï¼Œå°‡ä½ å»ºç«‹ sitemap äº¤çµ¦ google ï¼Œè®“ google æœå°‹å¯å¿«é€Ÿæ‰¾åˆ°ä½ çš„ç¶²é  æ³¨æ„äº‹é … âš ï¸ åŸ·è¡Œå®Œ build æŒ‡ä»¤å¾Œï¼Œå»ºè­°ç¿’æ…£æª¢æŸ¥ docs è³‡æ–™å¤¾ ( æˆ–ä½ çš„ publish è³‡æ–™å¤¾ ) å…§çš„ html è®ŠåŒ–æ˜¯å¦ç¬¦åˆé æœŸ\nå¿ƒå¾— é€™æ‡‰è©²æ˜¯ç¬¬äºŒæ¬¡ä½¿ç”¨ framework æ–¹å¼å»ºç«‹éœæ…‹æ–‡ä»¶ç³»çµ±ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä½¿ç”¨ vuepress å”åŠ©å…¬å¸å»ºç«‹å…§éƒ¨æ–‡ä»¶ç³»çµ±ï¼Œé€™æ¬¡æ˜¯ä½¿ç”¨ hugoã€‚å‰è€…æ˜¯ä»¥ javascript ç‚ºç•¶ä½œé–‹ç™¼èªè¨€ï¼Œå¾Œè€…æ˜¯ä»¥ go ç‚ºé–‹ç™¼èªè¨€ã€‚å…©è€…éƒ½è »æ¨è–¦ã€‚ æœ€é‡è¦çš„æ˜¯äº†è§£è©²æ¡†æ¶æ˜¯å¦‚ä½•é‹è¡Œçš„ï¼Œåœ¨é«˜åº¦å®¢è£½åŒ–åŠŸèƒ½æˆ–è€…ä¿®æ”¹å•é¡Œçš„æ™‚ä¾¯æ‰ä¸æœƒçå­æ‘¸è±¡èˆ¬çš„äº‚è©¦ã€‚ hugo æœ‰ 64.5k ğŸŒŸ (æˆªæ­¢è‡³ 20230103)ï¼Œå¾ˆå¤šäººæŒçºŒè²¢ç»èˆ‡ç¶­è­· ğŸ™ ï¼Œå› æ­¤è»Ÿé«”å·¥ç¨‹å¸«å¾é ­åˆ°å°¾ä¾é å®˜æ–¹æ–‡ä»¶èˆ‡ google å®ŒæˆåŸºæœ¬å»ºç«‹ä¸é›£ã€‚ åƒè€ƒè³‡æ–™ github pages quickstart hugo documentation self host likecoin button css2 fifty of the most popular hugo themes / hugo ç†±é–€ä¸»é¡Œå¤§å…¬é–‹ Build and submit a sitemap to google ","date":"2022-12-10T18:22:43+08:00","permalink":"https://yue-jenny.github.io/2022/12/%E7%82%BA%E4%BB%80%E9%BA%BC%E6%88%91%E6%B1%BA%E5%AE%9A%E4%BD%BF%E7%94%A8-hugo-%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8B-blog-%E7%B3%BB%E7%B5%B1-%E4%BB%A5%E5%8F%8A%E6%88%91%E8%A9%B2%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B/","title":"ç‚ºä»€éº¼æˆ‘æ±ºå®šä½¿ç”¨ hugo å»ºç«‹ä¸€å€‹ blog ç³»çµ± ğŸ“™ï¼Œä»¥åŠæˆ‘è©²å¦‚ä½•å»ºç«‹?"}]