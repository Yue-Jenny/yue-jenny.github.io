<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>CI/CD on Jenny blog</title>
        <link>https://yue-jenny.github.io/tags/ci/cd/</link>
        <description>Recent content in CI/CD on Jenny blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language><atom:link href="https://yue-jenny.github.io/tags/ci/cd/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>ä½¿ç”¨ Docker Desktop é‹è¡Œ Argo CD</title>
        <link>https://yue-jenny.github.io/post/argocd-on-docker-desktop/</link>
        <pubDate>Wed, 04 Jan 2023 04:39:13 +0000</pubDate>
        
        <guid>https://yue-jenny.github.io/post/argocd-on-docker-desktop/</guid>
        <description>&lt;h2 id=&#34;prerequisites&#34;&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;é–‹å§‹å‰ï¼Œéœ€è¦å…ˆç¢ºä¿æœ‰ä»¥ä¸‹çš„å…ˆå‚™çŸ¥è­˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://kubernetes.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;argo-cd-ä»‹ç´¹&#34;&gt;Argo CD ä»‹ç´¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ GitOps ç‚ºå®—æ—¨çš„ kubernetes æŒçºŒéƒ¨å±¬ (continuous delivery) å·¥å…·
&lt;ul&gt;
&lt;li&gt;é—œæ–¼ GitOps å¯ä»¥åƒè€ƒæ–‡ç«  &lt;a class=&#34;link&#34; href=&#34;../what-is-gitops/&#34; &gt;GitOps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;getting-started-with-argo-cd-on-docker-desktop&#34;&gt;Getting Started with Argo CD on Docker Desktop&lt;/h2&gt;
&lt;p&gt;è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥é–‹å§‹å§! ğŸ’ª&lt;/p&gt;
&lt;h3 id=&#34;å»ºç«‹-namespace&#34;&gt;å»ºç«‹ namespace&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SHELL&#34; data-lang=&#34;SHELL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl create namespace argocd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å®‰è£-argo-cd-çš„-kubernetes-resources&#34;&gt;å®‰è£ Argo CD çš„ kubernetes resources&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦å®‰è£çš„ resources éƒ½å¯«åœ¨ install.yaml å…§ï¼Œåˆ©ç”¨ &lt;code&gt;kubectl apply&lt;/code&gt; æŒ‡ä»¤é€²è¡Œå®‰è£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SHELL&#34; data-lang=&#34;SHELL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¢ºèª-argo-cd-çš„-pod-çš„é‹è¡Œç‹€æ…‹ç‚º-running&#34;&gt;ç¢ºèª Argo CD çš„ pod çš„é‹è¡Œç‹€æ…‹ç‚º running&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;-n&lt;/code&gt; è¡¨ç¤ºæŒ‡å®š namespace ç‚º argocdï¼Œæ²’è¨­å®šå°±æ˜¯ default namespace&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SHELL&#34; data-lang=&#34;SHELL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl get pod -n argocd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pod é‹è¡Œç‹€æ…‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/get-pod-n-argocd.jpg&#34;
	width=&#34;850&#34;
	height=&#34;189&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/get-pod-n-argocd_hue72648a3aa0105e4010abdc11108abb9_48197_480x0_resize_q75_box.jpg 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/get-pod-n-argocd_hue72648a3aa0105e4010abdc11108abb9_48197_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;argocd ç›¸é—œçš„ pod éƒ½å·²æ˜¯ running ç‹€æ…‹&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;449&#34;
		data-flex-basis=&#34;1079px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å–å¾—-argo-cd-åˆå§‹-admin-çš„å¯†ç¢¼&#34;&gt;å–å¾— Argo CD åˆå§‹ admin çš„å¯†ç¢¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç™»å…¥ dashboard ä½¿ç”¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SHELL&#34; data-lang=&#34;SHELL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{.data.password}&amp;#34;&lt;/span&gt; | base64 -d; echo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å°‡-service-argocd-server-port-forward-åˆ°æœ¬åœ°&#34;&gt;å°‡ service argocd-server port forward åˆ°æœ¬åœ°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°‡ service argocd-server çš„ port 443 å°è‡³&lt;strong&gt;æœ¬åœ° port 8000&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SHELL&#34; data-lang=&#34;SHELL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl port-forward svc/argocd-server -n argocd 8000:443
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;port forward æˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/port-forward.jpg&#34;
	width=&#34;748&#34;
	height=&#34;339&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/port-forward_huabd24b4c8f56be51fa0779e4ac514db3_51986_480x0_resize_q75_box.jpg 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/port-forward_huabd24b4c8f56be51fa0779e4ac514db3_51986_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;port forward æˆåŠŸ&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;220&#34;
		data-flex-basis=&#34;529px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç™»å…¥-argo-cd-dashboard&#34;&gt;ç™»å…¥ Argo CD dashboard&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¶²å€è¼¸å…¥ &lt;a class=&#34;link&#34; href=&#34;https://localhost:8000&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;https://localhost:8000&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆåŠŸç™»å…¥ Argo CD dashboard&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/argocd-dashboard-clean.png&#34;
	width=&#34;1071&#34;
	height=&#34;638&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/argocd-dashboard-clean_hubf35350a067953686ac0ffaa070558e3_60462_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/argocd-dashboard-clean_hubf35350a067953686ac0ffaa070558e3_60462_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;æˆåŠŸç™»å…¥ Argo CD dashboard&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;167&#34;
		data-flex-basis=&#34;402px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡å°-public-git-repository-å»ºç«‹ä¸€çµ„-application&#34;&gt;é‡å° public git repository å»ºç«‹ä¸€çµ„ application&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å…ˆ fork &lt;a class=&#34;link&#34; href=&#34;https://github.com/argoproj/argocd-example-apps&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç¯„ä¾‹ repository - argocd-example-apps&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾ç…§&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-ui&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿ&lt;/a&gt;é€²è¡Œæ–°å¢ application&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Step 1
&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app.png&#34;
	width=&#34;638&#34;
	height=&#34;158&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app_hu49baf9f48e5f3f774443692722b5a225_19254_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app_hu49baf9f48e5f3f774443692722b5a225_19254_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;NEW APP&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;403&#34;
		data-flex-basis=&#34;969px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Step 2ï¼Œå¡«å®Œè³‡è¨Šï¼ŒæŒ‰ä¸‹ &lt;code&gt;CREATE&lt;/code&gt;ï¼Œèƒ½åœ¨ dashboard çœ‹åˆ° application&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;app name: guestbook&lt;/li&gt;
&lt;li&gt;project: default&lt;/li&gt;
&lt;li&gt;sync policy: Manual&lt;/li&gt;
&lt;li&gt;Repository URL&lt;/li&gt;
&lt;li&gt;Revision: HEAD&lt;/li&gt;
&lt;li&gt;Path: guestbook&lt;/li&gt;
&lt;li&gt;Destination/Cluster: &lt;code&gt;https://kubernetes.default.svc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Namespace: default&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡å°-private-git-repository-å»ºç«‹ä¸€çµ„-application&#34;&gt;é‡å° private git repository å»ºç«‹ä¸€çµ„ application&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¸ä¸€çµ„ private repo&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ° &lt;code&gt;Settings/Repositories&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/setting-private-repo.png&#34;
	width=&#34;814&#34;
	height=&#34;353&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/setting-private-repo_hu78a555d7bb85e8a49707de97e637f012_33877_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/setting-private-repo_hu78a555d7bb85e8a49707de97e637f012_33877_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Settings/Repositories&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;230&#34;
		data-flex-basis=&#34;553px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»¥ &lt;code&gt;ssh-key&lt;/code&gt; æ–¹å¼èªè­‰ï¼Œä¹Ÿèƒ½é¸æ“‡ä»¥ &lt;code&gt;Https&lt;/code&gt; çš„æ–¹å¼é©—è­‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/user-guide/private-repositories/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Argo CD Private Repositories Credential è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®šå®Œæˆæœƒé¡¯ç¤º &lt;code&gt;Successful&lt;/code&gt;
&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/ssh-key-auth.png&#34;
	width=&#34;1060&#34;
	height=&#34;210&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/ssh-key-auth_huabe8ed2476538e932deefecd450f8e3f_14786_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/ssh-key-auth_huabe8ed2476538e932deefecd450f8e3f_14786_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;ä»¥ ssh-key æ–¹å¼èªè­‰&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;504&#34;
		data-flex-basis=&#34;1211px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹ application&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Step 1
&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app.png&#34;
	width=&#34;638&#34;
	height=&#34;158&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app_hu49baf9f48e5f3f774443692722b5a225_19254_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/new-app_hu49baf9f48e5f3f774443692722b5a225_19254_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;NEW APP&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;403&#34;
		data-flex-basis=&#34;969px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Step 2&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¾ç…§&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-ui&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶æŒ‡ç¤ºæ­¥é©Ÿ&lt;/a&gt;å¡«å…¥è³‡æ–™
&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/add-info-and-create.png&#34;
	width=&#34;1021&#34;
	height=&#34;815&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/add-info-and-create_hu338b5f90a6ef44a979a415c69ad0440f_40531_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/add-info-and-create_hu338b5f90a6ef44a979a415c69ad0440f_40531_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;å¡«å…¥è³‡æ–™ä¸¦ CREATE&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;125&#34;
		data-flex-basis=&#34;300px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆåŠŸå»ºç«‹ä¸€çµ„ private application ğŸš€&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/enter-argocd-dshaboard-successfully.jpg&#34;
	width=&#34;1023&#34;
	height=&#34;581&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/enter-argocd-dshaboard-successfully_hu2f9e0fec8e3eb44dc7df0f48b6ca8d80_56232_480x0_resize_q75_box.jpg 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/enter-argocd-dshaboard-successfully_hu2f9e0fec8e3eb44dc7df0f48b6ca8d80_56232_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;æˆåŠŸå»ºç«‹ä¸€çµ„ application&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;422px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§£é™¤å®‰è£-application&#34;&gt;è§£é™¤å®‰è£ application&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸ·è¡Œ &lt;code&gt;DELETE&lt;/code&gt; æŒ‰éˆ•&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/delete-app.png&#34;
	width=&#34;531&#34;
	height=&#34;328&#34;
	srcset=&#34;https://yue-jenny.github.io/post/argocd-on-docker-desktop/delete-app_hu66f4bb314802a66182a28a7e0c029fae_30154_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/post/argocd-on-docker-desktop/delete-app_hu66f4bb314802a66182a28a7e0c029fae_30154_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;DELETE æŒ‰éˆ•&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;161&#34;
		data-flex-basis=&#34;388px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§£é™¤å®‰è£-argo-cd&#34;&gt;è§£é™¤å®‰è£ Argo CD&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;âš ï¸ è§£é™¤å®‰è£ Argo CD å‰&lt;strong&gt;ä¸€å®šè¦å…ˆè§£é™¤å®‰è£ application&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl -n argocd delete -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åƒè€ƒè³‡æ–™&#34;&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Argo CD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/getting_started/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Argo CD getting started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://collabnix.com/getting-started-with-argocd-on-docker-desktop/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åƒè€ƒæ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://kubernetes.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;kubectl port-forward&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://argo-cd.readthedocs.io/en/stable/user-guide/private-repositories/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Argo CD Private Repositories Credential è¨­å®š&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨&lt;/strong&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¦‚ä½•ä½¿ç”¨ Github Workflow å®Œæˆ CI/CD</title>
        <link>https://yue-jenny.github.io/post/github-workflow/</link>
        <pubDate>Sat, 10 Dec 2022 18:33:05 +0800</pubDate>
        
        <guid>https://yue-jenny.github.io/post/github-workflow/</guid>
        <description>&lt;h2 id=&#34;github-workflow-ä»‹ç´¹&#34;&gt;Github Workflow ä»‹ç´¹&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;ç‚ºäº†åˆ©ç”¨ Github Workflow å®Œæˆ CI/CDï¼Œåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†å¯«ï¼Œåˆ†åˆ¥æ˜¯&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Github Workflow çš„åŸºæœ¬è¨­å®š&lt;/li&gt;
&lt;li&gt;Github Workflow ä¸­é€²è¡Œ CI&lt;/li&gt;
&lt;li&gt;ç™»å…¥ç™»å‡º AWS ECR èˆ‡ github container registry&lt;/li&gt;
&lt;li&gt;build &amp;amp; upload image&lt;/li&gt;
&lt;li&gt;æ›´æ–° helm value ä¸­çš„ image tagï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸºæœ¬è¨­å®š&#34;&gt;åŸºæœ¬è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;action ç‚º &lt;code&gt;push&lt;/code&gt; çš„æ™‚å€™ï¼Œ&lt;code&gt;æ‰€æœ‰ branch&lt;/code&gt; éƒ½æœƒé€²è¡Œ github workflow&lt;/li&gt;
&lt;li&gt;action ç‚º &lt;code&gt;pull_request&lt;/code&gt; çš„æ™‚å€™ï¼Œåªæœ‰ &lt;code&gt;main branch&lt;/code&gt; æœƒé€²è¡Œ github workflow&lt;/li&gt;
&lt;li&gt;types&lt;/li&gt;
&lt;li&gt;paths&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;on:
  push:
    branches: [&amp;#34;*&amp;#34;]
  pull_request:
    branches: [&amp;#34;main&amp;#34;]
    types:
      - opened
    paths:
      - &amp;#34;**.js&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;env-è¨­å®š&#34;&gt;env è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;env:
  AWS_DEFAULT_REGION: ap-southeast-1
  GIT_USER_NAME: jennyc
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;permissions-è¨­å®š&#34;&gt;permissions è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;è‡ªå‹•åŒ–æ¸¬è©¦-ci&#34;&gt;è‡ªå‹•åŒ–æ¸¬è©¦ CI&lt;/h2&gt;
&lt;h3 id=&#34;checkout-repository&#34;&gt;checkout repository&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;actions/checkout@v3&lt;/code&gt; é€²è¡Œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Checkout repository
  uses: actions/checkout@v3
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŸ·è¡Œ-npm-install&#34;&gt;åŸ·è¡Œ npm install&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Install dependencies
  run: npm install
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åŸ·è¡Œ-npm-test&#34;&gt;åŸ·è¡Œ npm test&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Run tests
  run: npm run test
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;build-multi-platform-images-ä¸¦ä¸Šå‚³è‡³-aws-ecr&#34;&gt;Build multi-platform images ä¸¦ä¸Šå‚³è‡³ AWS ECR&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€-1&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;é€™éƒ¨åˆ†éœ€è¦å…ˆè¨­å®š AWS Credential æ‰èƒ½ä½¿ç”¨ AWS ECRï¼Œ&lt;br&gt;
æ¥è‘— build multi-platform image ä¸¦ä¸”ä¸Šå‚³è‡³ AWS ECRã€‚&lt;/p&gt;
&lt;h3 id=&#34;1-è¨­å®š-aws-credential&#34;&gt;1. è¨­å®š AWS Credential&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š AWS Credential&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ GitHub&amp;rsquo;s OIDC provider æ–¹å¼å–å¾— short-lived credentials&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenID Connect (OIDC) è¨­å®šæ–¹å¼å¯ä»¥&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åƒè€ƒå®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡&lt;a class=&#34;link&#34; href=&#34;../how-to-use-oidc-to-auth-aws-services/&#34; &gt;æ–‡ç« &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;env.AWS_DEFAULT_REGION&lt;/code&gt; éœ€è¦ç‰¹åˆ¥è¨­å®šï¼Œèˆ‡ AWS ECR ç›¸åŒçš„ region&lt;/li&gt;
&lt;li&gt;&lt;code&gt;role-to-assume&lt;/code&gt; å¡«å…¥ AWS role&lt;/li&gt;
&lt;li&gt;&lt;code&gt;role-session-name&lt;/code&gt; é è¨­æ˜¯ GitHubActionsï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´åç¨±&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Configure AWS credentials
    uses: aws-actions/configure-aws-credentials@v1
    with:
        role-to-assume: arn:aws:iam::1234567890:role/example-role
        role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession 
        aws-region: ${{env.AWS_DEFAULT_REGION}}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-ç™»å…¥-aws-private-ecr&#34;&gt;2. ç™»å…¥ AWS private ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰å…©ç¨®æ–¹å¼
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Using &lt;code&gt;access key id&lt;/code&gt; and &lt;code&gt;secret access key&lt;/code&gt; to login&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Configure AWS credentials
    uses: aws-actions/configure-aws-credentials@v1
    with:
      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      aws-region: ap-southeast-1
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Using &lt;code&gt;OpenID Connect (OIDC)&lt;/code&gt; to login&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æ¨è–¦ä½¿ç”¨æ­¤æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Login to Amazon ECR
    id: login-ecr
    uses: aws-actions/amazon-ecr-login@v1
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-ç™»å…¥-aws-public-ecr&#34;&gt;3. ç™»å…¥ AWS public ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¯åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://github.com/aws-actions/amazon-ecr-login#login-to-amazon-ecr-public-then-package-and-push-a-helm-chart&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹èªªæ˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-ç™»å‡º-aws-ecr&#34;&gt;4. ç™»å‡º AWS ECR&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Logout of Amazon ECR
  if: always()
  run: docker logout ${{ steps.login-ecr.outputs.registry }}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;5-è¨­å®š-short-sha-ç‚º-image-tag&#34;&gt;5. è¨­å®š short sha ç‚º image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tagï¼ŒåŸå› å¯ä»¥åƒè€ƒ:
&lt;ul&gt;
&lt;li&gt;7 digits are the Git default for a short SHA&lt;/li&gt;
&lt;li&gt;é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ &lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°‡ output å‡ºå»çš„åƒæ•¸å‘½åç‚º &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Set short sha outputs
        id: vars
        run: echo &amp;#34;sha_short=$(git rev-parse --short HEAD)&amp;#34; &amp;gt;&amp;gt; $GITHUB_OUTPUT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;6-build-multi-platform-images-ä¸¦ä¸Šå‚³-images-åˆ°-aws-ecr&#34;&gt;6. Build multi-platform images ä¸¦ä¸Šå‚³ images åˆ° AWS ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å»ºç«‹å¤šå¹³å° docker images çš„&lt;a class=&#34;link&#34; href=&#34;https://docs.docker.com/build/building/multi-platform/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IMAGE_TAG&lt;/code&gt; æœƒå¾&lt;a class=&#34;link&#34; href=&#34;./#5-%e8%a8%ad%e5%ae%9a-short-sha-%e7%82%ba-image-tag&#34; &gt;æ­¥é©Ÿ 5&lt;/a&gt; å–å¾— output çš„è®Šæ•¸ &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--platform&lt;/code&gt; å¯æ¥ä¸Šéœ€è¦çš„ platform åƒè€ƒï¼Œä¾‹å¦‚ linux/amd64, linux/arm64&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Build, tag, and push docker image to Amazon ECR
    env:
        REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        REPOSITORY: pet-app
        IMAGE_TAG: ${{ steps.vars.outputs.sha_short }}
    run: |
        docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
        ( å®˜æ–¹å»ºè­°: docker run --privileged --rm tonistiigi/binfmt --install all )
        docker buildx create --name mybuilder --driver docker-container --bootstrap
        docker buildx use mybuilder
        docker buildx inspect
        docker buildx build --platform linux/amd64,linux/arm64 -t $REGISTRY/$REPOSITORY:$IMAGE_TAG --push .
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‚ºä»€éº¼éœ€è¦ &lt;code&gt;docker run --rm --privileged multiarch/qemu-user-static --reset -p yes&lt;/code&gt;&lt;/strong&gt; ?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºé‡åˆ° &lt;code&gt;Error: while loading /usr/local/sbin/node: No such file or directory&lt;/code&gt; å•é¡Œ
&lt;ul&gt;
&lt;li&gt;å…ˆä½¿ç”¨æ–¹å¼ä¸€ : &lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/wmg13178599398/article/details/127605036&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€£æ¥æ–¹å¼&lt;/a&gt;ï¼Œçµæœé‚„æ˜¯æœ‰ç›¸åŒå•é¡Œ
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  ln -s /usr/bin/node /usr/local/sbin/node
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å¾Œä¾†ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/72167570/docker-buildx-nodejs-fail&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ–¹å¼äºŒ&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ docker buildx æŒ‡ä»¤å‰&lt;strong&gt;å…ˆåŸ·è¡Œä»¥ä¸‹å‘½ä»¤&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/57178788/docker-build-fails-for-arm-images/57183566#57183566&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è©³ç´°åŸå› çš„ Stack Overflow åŸå§‹æ–‡ç« åœ¨é€™é‚Šï¼Œä»¥ä¸‹æ˜¯ç¯€éŒ„éƒ¨åˆ†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;`
When you ask the Linux kernel to run some executable file, it needs to know, how to load this specific file, and whether this file is compatible with current machine, or not. By default, the ELF binary compiled for, say, arm64v8 is rejected by the kernel, running on amd64 hardware.&lt;/p&gt;
&lt;p&gt;However, the binfmt_misc feature of the kernel allows you to tell it, how to handle the executables it cannot usually handle on its own - this includes the cases when the kernel does not know the binary format or considers it incompatible with current machine.&lt;br&gt;
`&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/docker/buildx/issues/495&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;github issue&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹å»ºè­°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£æ±º QEMU binaries å•é¡Œï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://docs.docker.com/build/building/multi-platform/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  docker run --privileged --rm tonistiigi/binfmt --install all
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;æ›´æ–°-helm-value-çš„-image-tag&#34;&gt;æ›´æ–° helm value çš„ image tag&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€-2&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;æ‡‰ç”¨æ˜¯ä»¥ terraform æ–¹å¼éƒ¨å±¬ï¼Œä¸¦æ­é…ä½¿ç”¨ helm chartsã€‚è€Œ docker image çš„ tag æ˜¯å¯«åœ¨ helm values å…§ã€‚&lt;br&gt;
ç›®æ¨™æ˜¯æ›´æ–° helm values çš„ docker image tag å€¼ï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ã€‚&lt;/p&gt;
&lt;p&gt;éœ€åšåˆ°å…©ä»¶äº‹æƒ…:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;checkout ç§æœ‰ repository&lt;/li&gt;
&lt;li&gt;è¨­å®šèˆ‡æ›´æ–° image tag&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;1-å…ˆ-checkout-ç§æœ‰å­˜æ”¾-helm-value-çš„-repository&#34;&gt;1. å…ˆ checkout ç§æœ‰å­˜æ”¾ helm value çš„ repository&lt;/h3&gt;
&lt;p&gt;éœ€è¦å…ˆè¨­å®š credential æ‰èƒ½ fetch private repositoryï¼Œæœ‰å…©ç¨®è¨­å®šçš„æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š deploy key&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ­¥é©Ÿå¦‚ä¸‹ï¼Œå¯åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/60222741/github-actions-and-git-clone-issue&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Create a new SSH key pair&lt;/a&gt;Â for your repository. Do not set a passphrase.&lt;/li&gt;
&lt;li&gt;Copy the contents of the public key (.pub file) to a new repositoryÂ &lt;a class=&#34;link&#34; href=&#34;https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;deploy key&lt;/a&gt;Â and check the box to &amp;ldquo;Allow write access.&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Add a secret to the repository containing the entire contents of the private key.&lt;/li&gt;
&lt;li&gt;As shown in the example below, configureÂ &lt;code&gt;actions/checkout&lt;/code&gt;Â to use the deploy key you have created.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ssh-key å¡«å…¥ private key çš„ secrets åç¨±&lt;/li&gt;
&lt;li&gt;path è¨­å®š checkout çš„ repo æœƒå­˜åœ¨å“ªä¸€å€‹è³‡æ–™å¤¾å…§&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}}
    uses: actions/checkout@v3
    with:
      repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}}
      ssh-key: ${{ secrets.SSH_PRIVATE_KEY }}
      path: ${{env.TERRAFORM_REPOSITORY_NAME}}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š Personal access token (PAT)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹ PAT çš„æ–¹å¼ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°‡å»ºç«‹å®Œæˆçš„ PAT è¨­å®šåˆ° repository çš„ secrets ä¸­ï¼Œè¨­å®šçš„ secrets åç¨±ç‚º GH_PATï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;repository è¨­å®šç‚º &lt;code&gt;owner/repository_name&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;token å¡«å…¥ PAT çš„ secrets åç¨±ï¼Œé€™é‚Šæ˜¯å°‡ secrets åç¨±ç‚º GH_PAT çš„å…§å®¹è¨­å®šç‚º PAT&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}}
    uses: actions/checkout@v3
    with:
        repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}}
        token: ${{ secrets.GH_PAT }}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-è¨­å®š-image-tag&#34;&gt;2. è¨­å®š image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tag
&lt;ul&gt;
&lt;li&gt;7 digits are the Git default for a short SHA&lt;/li&gt;
&lt;li&gt;é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ &lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Set short sha outputs
        id: vars
        run: echo &amp;#34;sha_short=$(git rev-parse --short HEAD)&amp;#34; &amp;gt;&amp;gt; $GITHUB_OUTPUT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;3-æ›´æ–°-image-tag&#34;&gt;3. æ›´æ–° image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ yq çš„ github action å·¥å…·ä¿®æ”¹ yaml æª”å…§çš„ image tag å€¼
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://mikefarah.gitbook.io/yq/v/v3.x/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mikefarah/yq&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„ github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€²è¡Œ git æ“ä½œï¼Œè¨­å®š user name, user emailã€commit ä»¥åŠ push&lt;/li&gt;
&lt;li&gt;tag å–ä¸Šä¸€å€‹æ­¥é©Ÿ output çš„åƒæ•¸ &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Update image tag
        uses: mikefarah/yq@master
        with:
          cmd: yq -i &amp;#39;.pet_app_dashboard_site.image.tag = &amp;#34;${{ steps.vars.outputs.sha_short }}&amp;#34;&amp;#39; ./${{env.TERRAFORM_REPOSITORY_NAME}}/${{env.HELM_FILE_NAME}}
      - run: |
          cd ${{env.TERRAFORM_REPOSITORY_NAME}}
          git config user.name ${{env.GIT_USER_NAME}}
          git config user.email ${{env.GIT_USER_EMAIL}}
          git add ${{env.HELM_FILE_NAME}}
          git commit -m &amp;#34;update image tag to ${{ steps.vars.outputs.sha_short }}&amp;#34;
          git push origin main
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;è‹¥è¦å°‡-docker-image-ä¸Šå‚³è‡³-github-container-registry-è©²æ€éº¼åš&#34;&gt;è‹¥è¦å°‡ docker image ä¸Šå‚³è‡³ github container registry è©²æ€éº¼åš?&lt;/h2&gt;
&lt;h3 id=&#34;1-ç™»å…¥èˆ‡ç™»å‡º-github-container-registry&#34;&gt;1. ç™»å…¥èˆ‡ç™»å‡º github container registry&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦è¨­å®š env.REGISTRY ç‚º ghcr.io&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸éœ€è¦å¦å¤–è¨­å®š github.actor èˆ‡ &lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/security-guides/automatic-token-authentication&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GITHUB_TOKEN&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    - name: Login to GitHub Container Registry
      uses: docker/login-action@v2
      with:
      registry: ${{ env.REGISTRY }}
      username: ${{ github.actor }}
      password: ${{ secrets.GITHUB_TOKEN }}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-extract-metadata&#34;&gt;2. Extract metadata&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;3-build-and-push-docker-image&#34;&gt;3. Build and push docker image&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;labels çš„å€¼å¯ä»¥å¾æ­¥é©ŸäºŒå–å‡º outputs labels ä¾†ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Build and push Docker image
        uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
        with:
          context: .
          push: true
          tags: ${{ env.REGISTRY }}/${{ env.REPO }}:${{ steps.vars.outputs.sha_short }}
          labels: ${{ steps.meta.outputs.labels }}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;åƒè€ƒè³‡æ–™&#34;&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/actions/checkout&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;actions/checkout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/aws-actions/amazon-ecr-login&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;amazon-ecr-login&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/docker/login-action&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;docker/login-action&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/57178788/docker-build-fails-for-arm-images/57183566#57183566&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;docker-build-fails-for-arm-images&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://mikefarah.gitbook.io/yq/v/v3.x/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mikefarah/yq&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„ github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;creating-a-personal-access-token&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;creating-and-using-encrypted-secrets&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!&lt;/strong&gt;&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
