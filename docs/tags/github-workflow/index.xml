<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Github Workflow on Jenny blog</title>
        <link>https://yue-jenny.github.io/tags/github-workflow/</link>
        <description>Recent content in Github Workflow on Jenny blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 12 Jan 2023 14:56:21 +0800</lastBuildDate><atom:link href="https://yue-jenny.github.io/tags/github-workflow/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>å¦‚ä½•è¨­è¨ˆèˆ‡å¯¦ä½œ Monorepo çš„ Github Workflow?</title>
        <link>https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/</link>
        <pubDate>Thu, 12 Jan 2023 14:56:21 +0800</pubDate>
        
        <guid>https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/</guid>
        <description>&lt;h2 id=&#34;å¦‚ä½•è¨­è¨ˆèˆ‡å¯¦ä½œ-monorepo-çš„-github-workflow&#34;&gt;å¦‚ä½•è¨­è¨ˆèˆ‡å¯¦ä½œ Monorepo çš„ Github Workflow?&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;æœ‰é‘‘æ–¼è¶Šä¾†è¶Šå¤šäººä½¿ç”¨ monorepoï¼Œæƒ³ç ”ç©¶ä¸€ä¸‹ï¼Œç•¶åªæœ‰é‡å°æŸå€‹ project æœ‰ç¨‹å¼ç¢¼çš„ç•°å‹•æ™‚ï¼Œå¦‚ä½•å¯¦è¸ CI/CD&lt;/p&gt;
&lt;h3 id=&#34;ä»€éº¼æ˜¯-monorepo&#34;&gt;ä»€éº¼æ˜¯ monorepo?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é¡§åæ€ç¾©ï¼Œmono è¡¨ç¤ºä¸€å€‹ï¼Œrepo è¡¨ç¤º repositoryï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;ä¸€å€‹ repository åŒ…å«å¤šå€‹ projects&lt;/strong&gt;ï¼Œä¸¦ä¸”æ¸…æ¥šå®šç¾©å®ƒå€‘ä¹‹é–“çš„é—œä¿‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚å‰å¾Œç«¯é–‹ç™¼ï¼Œå°‡å‰å¾Œç«¯çš„ç¨‹å¼éƒ½æ”¾åœ¨åŒä¸€å€‹ repositoryï¼Œå°±æ˜¯ &lt;code&gt;monorepo&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;çµæ§‹å¤§è‡´ä¸Šæœƒå‘ˆç¾å¦‚ä¸‹åœ–ï¼Œé€™æ¬¡èˆ‰ä¾‹æœ‰å…©å€‹ app åœ¨åŒä¸€å€‹ repository ä¸­
&lt;ul&gt;
&lt;li&gt;&lt;img src=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/monorepo-apps.jpg&#34;
	width=&#34;373&#34;
	height=&#34;250&#34;
	srcset=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/monorepo-apps_hucdc1b9450550e74ad13d597903be3338_16536_480x0_resize_q75_box.jpg 480w, https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/monorepo-apps_hucdc1b9450550e74ad13d597903be3338_16536_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;apps&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;358px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æƒ³çŸ¥é“å¿…ç”¨çš„åŸå› ã€å¥½è™•æˆ–æ¡å‘ç´€éŒ„ï¼Œå¯å…ˆåƒè€ƒ ğŸ‘‡
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://monorepo.tools/#what-is-a-monorepo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;what-is-a-monorepo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.errorbaker.tw/posts/cwc329/monorepo/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;monorepo ä¹‹æˆ‘è¦‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¦‚ä½•è¨­è¨ˆ-github-workflow&#34;&gt;å¦‚ä½•è¨­è¨ˆ Github workflow?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.logrocket.com/creating-separate-monorepo-ci-cd-pipelines-github-actions/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Creating separate monorepo CI/CD pipelines with GitHub Actions&lt;/a&gt;ï¼Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»¥ project ä¾†å€åˆ† workflows æª”æ¡ˆï¼Œæœ‰ db.yamlã€gateway.yaml ä»¥åŠworker.yamlï¼Œå¦‚ä¸‹åœ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç•¶ gateway application æœ‰ç¨‹å¼ç¢¼ç•°å‹•ï¼Œåªèƒ½åŸ·è¡Œ gateway.yamlï¼Œæ¸¬è©¦æˆ– build gateway image ç­‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/structure.png&#34;
	width=&#34;730&#34;
	height=&#34;477&#34;
	srcset=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/structure_hu572f924bb4941d326d5972d19c2d9ffb_167082_480x0_resize_box_3.png 480w, https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/structure_hu572f924bb4941d326d5972d19c2d9ffb_167082_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;ref: https://blog.logrocket.com/creating-separate-monorepo-ci-cd-pipelines-github-actions/&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;153&#34;
		data-flex-basis=&#34;367px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¯¦ä½œ&#34;&gt;å¯¦ä½œ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Github Workflow YAML æª”æ¡ˆä¸­æ˜¯ä»¥ &lt;code&gt;on&lt;/code&gt; å®šç¾©ï¼Œå“ªäº› events å¯ä»¥å» trigger ä¸€å€‹ workflowï¼Œå› æ­¤æˆ‘å€‘éœ€è¦åœ¨é€™é‚Šå‹•ä¸€äº›æ‰‹è…³ï¼Œè®“ä»–åªæœ‰åœ¨ç•°å‹•ç‰¹å®š application æ™‚æ‰æœƒåŸ·è¡Œ workflow&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨ workflow syntax &lt;code&gt;paths&lt;/code&gt; æŒ‡å®šç¯„åœï¼Œç•¶ pet app åº•ä¸‹çš„æª”æ¡ˆæœ‰ç•°å‹•ï¼ŒåŸ·è¡Œé€™å€‹ workflow&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  paths:
    - &amp;#39;apps/pet/**&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæƒ³è¦å†åŠ å…¥æŒ‡å®šç’°å¢ƒå‘¢?æ¯”å¦‚æŒ‡å®š &lt;code&gt;stage&lt;/code&gt; æˆ– &lt;code&gt;main&lt;/code&gt;ï¼Œå¯ä»¥åˆ©ç”¨ branches çš„ workflow syntax&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  branches: [&amp;#39;stage&amp;#39;]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµåˆä»¥ä¸Šï¼Œæ•´å€‹çœ‹èµ·ä¾†æ‡‰è©²æœƒåƒé€™æ¨£ï¼ŒæŒ‡å®šåœ¨ &lt;code&gt;stage&lt;/code&gt; çš„ pet app æœ‰ç¨‹å¼ç¢¼è®ŠåŒ–æ™‚ï¼ŒåŸ·è¡Œé€™å€‹ workflow&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  on:
      push:
          branches: [&amp;#39;stage&amp;#39;]
          paths:
              - &amp;#39;apps/pet/**&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‚£å¦‚æœæ˜¯ç”¨ &lt;code&gt;pull request&lt;/code&gt; å‘¢?&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  on:
      push:
          branches: [&amp;#39;stage&amp;#39;]
          paths:
              - &amp;#39;apps/pet/**&amp;#39;
      pull_request:
          branches: [&amp;#39;stage&amp;#39;]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æˆ‘å¦‚ä½•è¨­è¨ˆ&#34;&gt;æˆ‘å¦‚ä½•è¨­è¨ˆ?&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ“š&lt;code&gt;å…©ç¨®ç’°å¢ƒ stage èˆ‡ main&lt;/code&gt;ï¼Œä»¥åŠ&lt;code&gt;å…©ç¨® app&lt;/code&gt;ï¼Œç¸½å…±æœƒæœ‰ 4 çµ„ workflow yaml æª”æ¡ˆ
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;stage-app1.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;stage-app2.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;main-app1.yml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;main-app1.yml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ³¨æ„äº‹é …&#34;&gt;æ³¨æ„äº‹é …&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;â— &amp;ldquo;You must store workflow files in the .github/workflows directory of your repository.&amp;rdquo;
&lt;ul&gt;
&lt;li&gt;Github Workflow åªæ”¯æ´ç¬¬ä¸€å±¤çš„ workflow yaml æª”æ¡ˆ&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯ï¼Œä»¥ä¸‹åœ–çš„çµæ§‹ä¾†æ”¾ workflow æª”æ¡ˆï¼ŒGithub æ˜¯ä¸æœƒåŸ·è¡Œçš„ä»»ä½• workflow çš„&lt;/li&gt;
&lt;li&gt;&lt;img src=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/inefficient-structure.jpg&#34;
	width=&#34;442&#34;
	height=&#34;82&#34;
	srcset=&#34;https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/inefficient-structure_hu4ca78239c6104ca3c35ff8e64c25b833_8785_480x0_resize_q75_box.jpg 480w, https://yue-jenny.github.io/2023/01/%E5%A6%82%E4%BD%95%E8%A8%AD%E8%A8%88%E8%88%87%E5%AF%A6%E4%BD%9C-monorepo-%E7%9A%84-github-workflow/inefficient-structure_hu4ca78239c6104ca3c35ff8e64c25b833_8785_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;539&#34;
		data-flex-basis=&#34;1293px&#34;
	
&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶èªªæ˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¿ƒå¾—&#34;&gt;å¿ƒå¾—&lt;/h2&gt;
&lt;p&gt;ç¶“éé€™æ¬¡ï¼Œé™¤äº†äº†è§£ monorepo å¤–ï¼Œå°æ–¼ Github Actions çš„ Workflow syntax æ›´å¤šçš„èªè­˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åƒè€ƒè³‡æ–™-&#34;&gt;åƒè€ƒè³‡æ–™ ğŸ‘&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.logrocket.com/creating-separate-monorepo-ci-cd-pipelines-github-actions/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Creating separate monorepo CI/CD pipelines with GitHub Actions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://monorepo.tools/#what-is-a-monorepo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;what-is-a-monorepo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.errorbaker.tw/posts/cwc329/monorepo/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;monorepo ä¹‹æˆ‘è¦‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ›´å¤š workflow syntax ä»‹ç´¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ğŸ€ æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ! âœ¨ âœ¨ âœ¨&lt;/strong&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¦‚ä½•ä½¿ç”¨ Github Workflow å®Œæˆ CI/CD</title>
        <link>https://yue-jenny.github.io/2022/12/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-github-workflow-%E5%AE%8C%E6%88%90-ci/cd/</link>
        <pubDate>Sat, 10 Dec 2022 18:33:05 +0800</pubDate>
        
        <guid>https://yue-jenny.github.io/2022/12/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-github-workflow-%E5%AE%8C%E6%88%90-ci/cd/</guid>
        <description>&lt;h2 id=&#34;github-workflow-ä»‹ç´¹&#34;&gt;Github Workflow ä»‹ç´¹&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;ç‚ºäº†åˆ©ç”¨ Github Workflow å®Œæˆ CI/CDï¼Œåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†å¯«ï¼Œåˆ†åˆ¥æ˜¯&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Github Workflow çš„åŸºæœ¬è¨­å®š&lt;/li&gt;
&lt;li&gt;Github Workflow ä¸­é€²è¡Œ CI&lt;/li&gt;
&lt;li&gt;ç™»å…¥ç™»å‡º AWS ECR èˆ‡ github container registry&lt;/li&gt;
&lt;li&gt;build &amp;amp; upload image&lt;/li&gt;
&lt;li&gt;æ›´æ–° helm value ä¸­çš„ image tagï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸºæœ¬è¨­å®š&#34;&gt;åŸºæœ¬è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;action ç‚º &lt;code&gt;push&lt;/code&gt; çš„æ™‚å€™ï¼Œ&lt;code&gt;æ‰€æœ‰ branch&lt;/code&gt; éƒ½æœƒé€²è¡Œ github workflow&lt;/li&gt;
&lt;li&gt;action ç‚º &lt;code&gt;pull_request&lt;/code&gt; çš„æ™‚å€™ï¼Œåªæœ‰ &lt;code&gt;main branch&lt;/code&gt; æœƒé€²è¡Œ github workflow&lt;/li&gt;
&lt;li&gt;types&lt;/li&gt;
&lt;li&gt;paths&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;on:
  push:
    branches: [&amp;#34;*&amp;#34;]
  pull_request:
    branches: [&amp;#34;main&amp;#34;]
    types:
      - opened
    paths:
      - &amp;#34;**.js&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;env-è¨­å®š&#34;&gt;env è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;env:
  AWS_DEFAULT_REGION: ap-southeast-1
  GIT_USER_NAME: jennyc
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;permissions-è¨­å®š&#34;&gt;permissions è¨­å®š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šæ–¹å¼å¦‚ä¸‹ï¼Œå¯ä»¥ä¾ç…§è‡ªèº«éœ€æ±‚é€²è¡Œè¨­å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;è‡ªå‹•åŒ–æ¸¬è©¦-ci&#34;&gt;è‡ªå‹•åŒ–æ¸¬è©¦ CI&lt;/h2&gt;
&lt;h3 id=&#34;checkout-repository&#34;&gt;checkout repository&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;actions/checkout@v3&lt;/code&gt; é€²è¡Œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Checkout repository
  uses: actions/checkout@v3
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŸ·è¡Œ-npm-install&#34;&gt;åŸ·è¡Œ npm install&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Install dependencies
  run: npm install
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åŸ·è¡Œ-npm-test&#34;&gt;åŸ·è¡Œ npm test&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Run tests
  run: npm run test
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;build-multi-platform-images-ä¸¦ä¸Šå‚³è‡³-aws-ecr&#34;&gt;Build multi-platform images ä¸¦ä¸Šå‚³è‡³ AWS ECR&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€-1&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;é€™éƒ¨åˆ†éœ€è¦å…ˆè¨­å®š AWS Credential æ‰èƒ½ä½¿ç”¨ AWS ECRï¼Œ&lt;br&gt;
æ¥è‘— build multi-platform image ä¸¦ä¸”ä¸Šå‚³è‡³ AWS ECRã€‚&lt;/p&gt;
&lt;h3 id=&#34;1-è¨­å®š-aws-credential&#34;&gt;1. è¨­å®š AWS Credential&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š AWS Credential&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ GitHub&amp;rsquo;s OIDC provider æ–¹å¼å–å¾— short-lived credentials&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenID Connect (OIDC) è¨­å®šæ–¹å¼å¯ä»¥&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åƒè€ƒå®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡&lt;a class=&#34;link&#34; href=&#34;../how-to-use-oidc-to-auth-aws-services/&#34; &gt;æ–‡ç« &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;env.AWS_DEFAULT_REGION&lt;/code&gt; éœ€è¦ç‰¹åˆ¥è¨­å®šï¼Œèˆ‡ AWS ECR ç›¸åŒçš„ region&lt;/li&gt;
&lt;li&gt;&lt;code&gt;role-to-assume&lt;/code&gt; å¡«å…¥ AWS role&lt;/li&gt;
&lt;li&gt;&lt;code&gt;role-session-name&lt;/code&gt; é è¨­æ˜¯ GitHubActionsï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´åç¨±&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Configure AWS credentials
    uses: aws-actions/configure-aws-credentials@v1
    with:
        role-to-assume: arn:aws:iam::1234567890:role/example-role
        role-session-name: GitHubActionsWithAwsEcrUsingOIDCSession 
        aws-region: ${{env.AWS_DEFAULT_REGION}}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-ç™»å…¥-aws-private-ecr&#34;&gt;2. ç™»å…¥ AWS private ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰å…©ç¨®æ–¹å¼
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Using &lt;code&gt;access key id&lt;/code&gt; and &lt;code&gt;secret access key&lt;/code&gt; to login&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Configure AWS credentials
    uses: aws-actions/configure-aws-credentials@v1
    with:
      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      aws-region: ap-southeast-1
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Using &lt;code&gt;OpenID Connect (OIDC)&lt;/code&gt; to login&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æ¨è–¦ä½¿ç”¨æ­¤æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Login to Amazon ECR
    id: login-ecr
    uses: aws-actions/amazon-ecr-login@v1
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-ç™»å…¥-aws-public-ecr&#34;&gt;3. ç™»å…¥ AWS public ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¯åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://github.com/aws-actions/amazon-ecr-login#login-to-amazon-ecr-public-then-package-and-push-a-helm-chart&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹èªªæ˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4-ç™»å‡º-aws-ecr&#34;&gt;4. ç™»å‡º AWS ECR&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Logout of Amazon ECR
  if: always()
  run: docker logout ${{ steps.login-ecr.outputs.registry }}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;5-è¨­å®š-short-sha-ç‚º-image-tag&#34;&gt;5. è¨­å®š short sha ç‚º image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tagï¼ŒåŸå› å¯ä»¥åƒè€ƒ:
&lt;ul&gt;
&lt;li&gt;7 digits are the Git default for a short SHA&lt;/li&gt;
&lt;li&gt;é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ &lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°‡ output å‡ºå»çš„åƒæ•¸å‘½åç‚º &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Set short sha outputs
        id: vars
        run: echo &amp;#34;sha_short=$(git rev-parse --short HEAD)&amp;#34; &amp;gt;&amp;gt; $GITHUB_OUTPUT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;6-build-multi-platform-images-ä¸¦ä¸Šå‚³-images-åˆ°-aws-ecr&#34;&gt;6. Build multi-platform images ä¸¦ä¸Šå‚³ images åˆ° AWS ECR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å»ºç«‹å¤šå¹³å° docker images çš„&lt;a class=&#34;link&#34; href=&#34;https://docs.docker.com/build/building/multi-platform/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IMAGE_TAG&lt;/code&gt; æœƒå¾&lt;a class=&#34;link&#34; href=&#34;./#5-%e8%a8%ad%e5%ae%9a-short-sha-%e7%82%ba-image-tag&#34; &gt;æ­¥é©Ÿ 5&lt;/a&gt; å–å¾— output çš„è®Šæ•¸ &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--platform&lt;/code&gt; å¯æ¥ä¸Šéœ€è¦çš„ platform åƒè€ƒï¼Œä¾‹å¦‚ linux/amd64, linux/arm64&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Build, tag, and push docker image to Amazon ECR
    env:
        REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        REPOSITORY: pet-app
        IMAGE_TAG: ${{ steps.vars.outputs.sha_short }}
    run: |
        docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
        ( å®˜æ–¹å»ºè­°: docker run --privileged --rm tonistiigi/binfmt --install all )
        docker buildx create --name mybuilder --driver docker-container --bootstrap
        docker buildx use mybuilder
        docker buildx inspect
        docker buildx build --platform linux/amd64,linux/arm64 -t $REGISTRY/$REPOSITORY:$IMAGE_TAG --push .
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‚ºä»€éº¼éœ€è¦ &lt;code&gt;docker run --rm --privileged multiarch/qemu-user-static --reset -p yes&lt;/code&gt;&lt;/strong&gt; ?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ç‚ºé‡åˆ° &lt;code&gt;Error: while loading /usr/local/sbin/node: No such file or directory&lt;/code&gt; å•é¡Œ
&lt;ul&gt;
&lt;li&gt;å…ˆä½¿ç”¨æ–¹å¼ä¸€ : &lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/wmg13178599398/article/details/127605036&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€£æ¥æ–¹å¼&lt;/a&gt;ï¼Œçµæœé‚„æ˜¯æœ‰ç›¸åŒå•é¡Œ
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  ln -s /usr/bin/node /usr/local/sbin/node
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;å¾Œä¾†ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/72167570/docker-buildx-nodejs-fail&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ–¹å¼äºŒ&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ docker buildx æŒ‡ä»¤å‰&lt;strong&gt;å…ˆåŸ·è¡Œä»¥ä¸‹å‘½ä»¤&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/57178788/docker-build-fails-for-arm-images/57183566#57183566&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è©³ç´°åŸå› çš„ Stack Overflow åŸå§‹æ–‡ç« åœ¨é€™é‚Šï¼Œä»¥ä¸‹æ˜¯ç¯€éŒ„éƒ¨åˆ†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;`
When you ask the Linux kernel to run some executable file, it needs to know, how to load this specific file, and whether this file is compatible with current machine, or not. By default, the ELF binary compiled for, say, arm64v8 is rejected by the kernel, running on amd64 hardware.&lt;/p&gt;
&lt;p&gt;However, the binfmt_misc feature of the kernel allows you to tell it, how to handle the executables it cannot usually handle on its own - this includes the cases when the kernel does not know the binary format or considers it incompatible with current machine.&lt;br&gt;
`&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/docker/buildx/issues/495&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;github issue&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹å»ºè­°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£æ±º QEMU binaries å•é¡Œï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://docs.docker.com/build/building/multi-platform/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  docker run --privileged --rm tonistiigi/binfmt --install all
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;æ›´æ–°-helm-value-çš„-image-tag&#34;&gt;æ›´æ–° helm value çš„ image tag&lt;/h2&gt;
&lt;h3 id=&#34;å‰è¨€-2&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;æ‡‰ç”¨æ˜¯ä»¥ terraform æ–¹å¼éƒ¨å±¬ï¼Œä¸¦æ­é…ä½¿ç”¨ helm chartsã€‚è€Œ docker image çš„ tag æ˜¯å¯«åœ¨ helm values å…§ã€‚&lt;br&gt;
ç›®æ¨™æ˜¯æ›´æ–° helm values çš„ docker image tag å€¼ï¼Œå¾ŒçºŒè®“ argocd å¾—ä»¥åµæ¸¬åˆ° helm values çš„è®ŠåŒ–å¾Œï¼Œé€²è¡Œè‡ªå‹•åŒ–éƒ¨å±¬ã€‚&lt;/p&gt;
&lt;p&gt;éœ€åšåˆ°å…©ä»¶äº‹æƒ…:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;checkout ç§æœ‰ repository&lt;/li&gt;
&lt;li&gt;è¨­å®šèˆ‡æ›´æ–° image tag&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;1-å…ˆ-checkout-ç§æœ‰å­˜æ”¾-helm-value-çš„-repository&#34;&gt;1. å…ˆ checkout ç§æœ‰å­˜æ”¾ helm value çš„ repository&lt;/h3&gt;
&lt;p&gt;éœ€è¦å…ˆè¨­å®š credential æ‰èƒ½ fetch private repositoryï¼Œæœ‰å…©ç¨®è¨­å®šçš„æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š deploy key&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ­¥é©Ÿå¦‚ä¸‹ï¼Œå¯åƒè€ƒ&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/60222741/github-actions-and-git-clone-issue&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€™ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Create a new SSH key pair&lt;/a&gt;Â for your repository. Do not set a passphrase.&lt;/li&gt;
&lt;li&gt;Copy the contents of the public key (.pub file) to a new repositoryÂ &lt;a class=&#34;link&#34; href=&#34;https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;deploy key&lt;/a&gt;Â and check the box to &amp;ldquo;Allow write access.&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Add a secret to the repository containing the entire contents of the private key.&lt;/li&gt;
&lt;li&gt;As shown in the example below, configureÂ &lt;code&gt;actions/checkout&lt;/code&gt;Â to use the deploy key you have created.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ssh-key å¡«å…¥ private key çš„ secrets åç¨±&lt;/li&gt;
&lt;li&gt;path è¨­å®š checkout çš„ repo æœƒå­˜åœ¨å“ªä¸€å€‹è³‡æ–™å¤¾å…§&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  - name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}}
    uses: actions/checkout@v3
    with:
      repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}}
      ssh-key: ${{ secrets.SSH_PRIVATE_KEY }}
      path: ${{env.TERRAFORM_REPOSITORY_NAME}}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¨­å®š Personal access token (PAT)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹ PAT çš„æ–¹å¼ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°‡å»ºç«‹å®Œæˆçš„ PAT è¨­å®šåˆ° repository çš„ secrets ä¸­ï¼Œè¨­å®šçš„ secrets åç¨±ç‚º GH_PATï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;workflow è¦æ€éº¼å¯«?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;repository è¨­å®šç‚º &lt;code&gt;owner/repository_name&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;token å¡«å…¥ PAT çš„ secrets åç¨±ï¼Œé€™é‚Šæ˜¯å°‡ secrets åç¨±ç‚º GH_PAT çš„å…§å®¹è¨­å®šç‚º PAT&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;- name: Checkout ${{env.TERRAFORM_REPOSITORY_NAME}} repo and push file to ${{env.TERRAFORM_REPOSITORY_NAME}}
    uses: actions/checkout@v3
    with:
        repository: ${{env.TERRAFORM_REPOSITORY_OWNER_NAME}}/${{env.TERRAFORM_REPOSITORY_NAME}}
        token: ${{ secrets.GH_PAT }}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-è¨­å®š-image-tag&#34;&gt;2. è¨­å®š image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¨­å®šä»¥ 7 digits é•·åº¦çš„ short sha ä½œç‚º image tag
&lt;ul&gt;
&lt;li&gt;7 digits are the Git default for a short SHA&lt;/li&gt;
&lt;li&gt;é™„ä¸Šå…¶ä»–åƒè€ƒæ–‡ä»¶ &lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Set short sha outputs
        id: vars
        run: echo &amp;#34;sha_short=$(git rev-parse --short HEAD)&amp;#34; &amp;gt;&amp;gt; $GITHUB_OUTPUT
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;3-æ›´æ–°-image-tag&#34;&gt;3. æ›´æ–° image tag&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥ yq çš„ github action å·¥å…·ä¿®æ”¹ yaml æª”å…§çš„ image tag å€¼
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://mikefarah.gitbook.io/yq/v/v3.x/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mikefarah/yq&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„ github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€²è¡Œ git æ“ä½œï¼Œè¨­å®š user name, user emailã€commit ä»¥åŠ push&lt;/li&gt;
&lt;li&gt;tag å–ä¸Šä¸€å€‹æ­¥é©Ÿ output çš„åƒæ•¸ &lt;code&gt;sha_short&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Update image tag
        uses: mikefarah/yq@master
        with:
          cmd: yq -i &amp;#39;.pet_app_dashboard_site.image.tag = &amp;#34;${{ steps.vars.outputs.sha_short }}&amp;#34;&amp;#39; ./${{env.TERRAFORM_REPOSITORY_NAME}}/${{env.HELM_FILE_NAME}}
      - run: |
          cd ${{env.TERRAFORM_REPOSITORY_NAME}}
          git config user.name ${{env.GIT_USER_NAME}}
          git config user.email ${{env.GIT_USER_EMAIL}}
          git add ${{env.HELM_FILE_NAME}}
          git commit -m &amp;#34;update image tag to ${{ steps.vars.outputs.sha_short }}&amp;#34;
          git push origin main
&lt;/code&gt;&lt;/pre&gt;&lt;!-- raw HTML omitted --&gt;
&lt;h2 id=&#34;è‹¥è¦å°‡-docker-image-ä¸Šå‚³è‡³-github-container-registry-è©²æ€éº¼åš&#34;&gt;è‹¥è¦å°‡ docker image ä¸Šå‚³è‡³ github container registry è©²æ€éº¼åš?&lt;/h2&gt;
&lt;h3 id=&#34;1-ç™»å…¥èˆ‡ç™»å‡º-github-container-registry&#34;&gt;1. ç™»å…¥èˆ‡ç™»å‡º github container registry&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦è¨­å®š env.REGISTRY ç‚º ghcr.io&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸éœ€è¦å¦å¤–è¨­å®š github.actor èˆ‡ &lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/actions/security-guides/automatic-token-authentication&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GITHUB_TOKEN&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    - name: Login to GitHub Container Registry
      uses: docker/login-action@v2
      with:
      registry: ${{ env.REGISTRY }}
      username: ${{ github.actor }}
      password: ${{ secrets.GITHUB_TOKEN }}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-extract-metadata&#34;&gt;2. Extract metadata&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;3-build-and-push-docker-image&#34;&gt;3. Build and push docker image&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;labels çš„å€¼å¯ä»¥å¾æ­¥é©ŸäºŒå–å‡º outputs labels ä¾†ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;      - name: Build and push Docker image
        uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
        with:
          context: .
          push: true
          tags: ${{ env.REGISTRY }}/${{ env.REPO }}:${{ steps.vars.outputs.sha_short }}
          labels: ${{ steps.meta.outputs.labels }}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;åƒè€ƒè³‡æ–™&#34;&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/actions/checkout&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;actions/checkout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/aws-actions/amazon-ecr-login&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;amazon-ecr-login&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/docker/login-action&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;docker/login-action&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/57178788/docker-build-fails-for-arm-images/57183566#57183566&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;docker-build-fails-for-arm-images&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://mikefarah.gitbook.io/yq/v/v3.x/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mikefarah/yq&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;yq çš„ github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://git-scm.com/book/en/v2/Git-Tools-Revision-Selection#Short-SHA-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chapter 7 of the Pro Git book&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;creating-a-personal-access-token&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;creating-and-using-encrypted-secrets&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æœ€å¾Œï¼Œè‹¥å–œæ­¡æˆ‘çš„åˆ†äº«ï¼Œå¯ä»¥å…è²»å¹«æˆ‘æŒ‰è®šï¼Œæ˜¯å°æˆ‘æœ€å¤§çš„é¼“å‹µ!&lt;/strong&gt;&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
